(function(H,HA){"use strict";var noop=function(){return undefined},Color=H.Color,Series=H.Series,seriesTypes=H.seriesTypes,each=H.each,extend=H.extend,addEvent=HA.addEvent,fireEvent=HA.fireEvent,merge=H.merge,pick=H.pick,wrap=H.wrap,plotOptions=H.getOptions().plotOptions,CHUNK_SIZE=5e4;function eachAsync(arr,fn,callback,chunkSize,i){i=i||0;chunkSize=chunkSize||CHUNK_SIZE;each(arr.slice(i,i+chunkSize),fn);if(i+chunkSize<arr.length){setTimeout(function(){eachAsync(arr,fn,callback,chunkSize,i+chunkSize)})}else if(callback){callback()}}each(["area","arearange","column","line","scatter"],function(type){if(plotOptions[type]){plotOptions[type].boostThreshold=5e3}});each(["translate","generatePoints","drawTracker","drawPoints","render"],function(method){function branch(proceed){var letItPass=this.options.stacking&&(method==="translate"||method==="generatePoints");if((this.processedXData||this.options.data).length<(this.options.boostThreshold||Number.MAX_VALUE)||letItPass){if(method==="render"&&this.image){this.image.attr({href:""});this.animate=null}proceed.call(this)}else if(this[method+"Canvas"]){this[method+"Canvas"]()}}wrap(Series.prototype,method,branch);if(method==="translate"){if(seriesTypes.column){wrap(seriesTypes.column.prototype,method,branch)}if(seriesTypes.arearange){wrap(seriesTypes.arearange.prototype,method,branch)}}});wrap(Series.prototype,"getExtremes",function(proceed){if(!this.hasExtremes()){proceed.apply(this,Array.prototype.slice.call(arguments,1))}});wrap(Series.prototype,"setData",function(proceed){if(!this.hasExtremes(true)){proceed.apply(this,Array.prototype.slice.call(arguments,1))}});wrap(Series.prototype,"processData",function(proceed){if(!this.hasExtremes(true)){proceed.apply(this,Array.prototype.slice.call(arguments,1))}});H.extend(Series.prototype,{pointRange:0,hasExtremes:function(checkX){var options=this.options,data=options.data,xAxis=this.xAxis.options,yAxis=this.yAxis.options;return data.length>(options.boostThreshold||Number.MAX_VALUE)&&typeof yAxis.min==="number"&&typeof yAxis.max==="number"&&(!checkX||typeof xAxis.min==="number"&&typeof xAxis.max==="number")},destroyGraphics:function(){var series=this,points=this.points,point,i;for(i=0;i<points.length;i=i+1){point=points[i];if(point&&point.graphic){point.graphic=point.graphic.destroy()}}each(["graph","area"],function(prop){if(series[prop]){series[prop]=series[prop].destroy()}})},getContext:function(){var width=this.chart.plotWidth,height=this.chart.plotHeight;if(!this.canvas){this.canvas=document.createElement("canvas");this.image=this.chart.renderer.image("",0,0,width,height).add(this.group);this.ctx=this.canvas.getContext("2d")}else{this.ctx.clearRect(0,0,width,height)}this.canvas.setAttribute("width",width);this.canvas.setAttribute("height",height);this.image.attr({width:width,height:height});return this.ctx},canvasToSVG:function(){this.image.attr({href:this.canvas.toDataURL("image/png")})},cvsLineTo:function(ctx,clientX,plotY){ctx.lineTo(clientX,plotY)},renderCanvas:function(){var series=this,options=series.options,chart=series.chart,xAxis=this.xAxis,yAxis=this.yAxis,ctx,i,c=0,xData=series.processedXData,yData=series.processedYData,rawData=options.data,xExtremes=xAxis.getExtremes(),xMin=xExtremes.min,xMax=xExtremes.max,yExtremes=yAxis.getExtremes(),yMin=yExtremes.min,yMax=yExtremes.max,pointTaken={},lastClientX,sampling=!!series.sampling,points,r=options.marker&&options.marker.radius,cvsDrawPoint=this.cvsDrawPoint,cvsLineTo=options.lineWidth?this.cvsLineTo:false,cvsMarker=r<=1?this.cvsMarkerSquare:this.cvsMarkerCircle,enableMouseTracking=options.enableMouseTracking!==false,lastPoint,threshold=options.threshold,yBottom=yAxis.getThreshold(threshold),hasThreshold=typeof threshold==="number",translatedThreshold=yBottom,doFill=this.fill,isRange=series.pointArrayMap&&series.pointArrayMap.join(",")==="low,high",isStacked=!!options.stacking,cropStart=series.cropStart||0,loadingOptions=chart.options.loading,requireSorting=series.requireSorting,wasNull,connectNulls=options.connectNulls,useRaw=!xData,minVal,maxVal,minI,maxI,fillColor=series.fillOpacity?new Color(series.color).setOpacity(pick(options.fillOpacity,.75)).get():series.color,stroke=function(){if(doFill){ctx.fillStyle=fillColor;ctx.fill()}else{ctx.strokeStyle=series.color;ctx.lineWidth=options.lineWidth;ctx.stroke()}},drawPoint=function(clientX,plotY,yBottom){if(c===0){ctx.beginPath()}if(wasNull){ctx.moveTo(clientX,plotY)}else{if(cvsDrawPoint){cvsDrawPoint(ctx,clientX,plotY,yBottom,lastPoint)}else if(cvsLineTo){cvsLineTo(ctx,clientX,plotY)}else if(cvsMarker){cvsMarker(ctx,clientX,plotY,r)}}c=c+1;if(c===1e3){stroke();c=0}lastPoint={clientX:clientX,plotY:plotY,yBottom:yBottom}},addKDPoint=function(clientX,plotY,i){if(enableMouseTracking&&!pointTaken[clientX+","+plotY]){points.push({clientX:clientX,plotX:clientX,plotY:plotY,i:cropStart+i});pointTaken[clientX+","+plotY]=true}};if(this.points){this.destroyGraphics()}series.plotGroup("group","series",series.visible?"visible":"hidden",options.zIndex,chart.seriesGroup);series.getAttribs();series.markerGroup=series.group;addEvent(series,"destroy",function(){series.markerGroup=null});points=this.points=[];ctx=this.getContext();series.buildKDTree=noop;if(rawData.length>99999){chart.options.loading=merge(loadingOptions,{labelStyle:{backgroundColor:"rgba(255,255,255,0.75)",padding:"1em",borderRadius:"0.5em"},style:{backgroundColor:"none",opacity:1}});chart.showLoading("Drawing...");chart.options.loading=loadingOptions;if(chart.loadingShown===true){chart.loadingShown=1}else{chart.loadingShown=chart.loadingShown+1}}i=0;eachAsync(isStacked?series.data:xData||rawData,function(d){var x,y,clientX,plotY,isNull,low,isYInside=true;if(useRaw){x=d[0];y=d[1]}else{x=d;y=yData[i]}if(isRange){if(useRaw){y=d.slice(1,3)}low=y[0];y=y[1]}else if(isStacked){x=d.x;y=d.stackY;low=y-d.y}isNull=y===null;if(!requireSorting){isYInside=y>=yMin&&y<=yMax}if(!isNull&&x>=xMin&&x<=xMax&&isYInside){clientX=Math.round(xAxis.toPixels(x,true));if(sampling){if(minI===undefined||clientX===lastClientX){if(!isRange){low=y}if(maxI===undefined||y>maxVal){maxVal=y;maxI=i}if(minI===undefined||low<minVal){minVal=low;minI=i}}if(clientX!==lastClientX){if(minI!==undefined){plotY=yAxis.toPixels(maxVal,true);yBottom=yAxis.toPixels(minVal,true);drawPoint(clientX,hasThreshold?Math.min(plotY,translatedThreshold):plotY,hasThreshold?Math.max(yBottom,translatedThreshold):yBottom);addKDPoint(clientX,plotY,maxI);if(yBottom!==plotY){addKDPoint(clientX,yBottom,minI)}}minI=maxI=undefined;lastClientX=clientX}}else{plotY=Math.round(yAxis.toPixels(y,true));drawPoint(clientX,plotY,yBottom);addKDPoint(clientX,plotY,i)}}wasNull=isNull&&!connectNulls;i=i+1;if(i%CHUNK_SIZE===0){series.canvasToSVG()}},function(){var loadingDiv=chart.loadingDiv,loadingShown=+chart.loadingShown;stroke();series.canvasToSVG();fireEvent(series,"renderedCanvas");if(loadingShown===1){extend(loadingDiv.style,{transition:"opacity 250ms",opacity:0});chart.loadingShown=false;setTimeout(function(){if(loadingDiv.parentNode){loadingDiv.parentNode.removeChild(loadingDiv)}chart.loadingDiv=chart.loadingSpan=null},250)}if(loadingShown){chart.loadingShown=loadingShown-1}series.directTouch=false;series.options.stickyTracking=true;delete series.buildKDTree;series.buildKDTree()},chart.renderer.forExport?Number.MAX_VALUE:undefined)}});seriesTypes.scatter.prototype.cvsMarkerCircle=function(ctx,clientX,plotY,r){ctx.moveTo(clientX,plotY);ctx.arc(clientX,plotY,r,0,2*Math.PI,false)};seriesTypes.scatter.prototype.cvsMarkerSquare=function(ctx,clientX,plotY,r){ctx.moveTo(clientX,plotY);ctx.rect(clientX-r,plotY-r,r*2,r*2)};seriesTypes.scatter.prototype.fill=true;extend(seriesTypes.area.prototype,{cvsDrawPoint:function(ctx,clientX,plotY,yBottom,lastPoint){if(lastPoint&&clientX!==lastPoint.clientX){ctx.moveTo(lastPoint.clientX,lastPoint.yBottom);ctx.lineTo(lastPoint.clientX,lastPoint.plotY);ctx.lineTo(clientX,plotY);ctx.lineTo(clientX,yBottom)}},fill:true,fillOpacity:true,sampling:true});extend(seriesTypes.column.prototype,{cvsDrawPoint:function(ctx,clientX,plotY,yBottom){ctx.rect(clientX-1,plotY,1,yBottom-plotY)},fill:true,sampling:true});wrap(Series.prototype,"searchPoint",function(proceed,e){var point=proceed.call(this,e),ret=point;if(point&&!(point instanceof this.pointClass)){ret=(new this.pointClass).init(this,this.options.data[point.i]);ret.dist=point.dist;ret.category=ret.x;ret.plotX=point.plotX;ret.plotY=point.plotY}return ret})})(Highcharts,HighchartsAdapter);