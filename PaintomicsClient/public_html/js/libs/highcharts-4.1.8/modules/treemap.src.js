/**
 * @license Highcharts JS v4.1.8 (2015-08-20)
 *
 * (c) 2014 Highsoft AS
 * Authors: Jon Arild Nygard / Oystein Moseng
 *
 * License: www.highcharts.com/license
 */
(function(H){var seriesTypes=H.seriesTypes,merge=H.merge,extend=H.extend,extendClass=H.extendClass,defaultOptions=H.getOptions(),plotOptions=defaultOptions.plotOptions,noop=function(){return},each=H.each,grep=HighchartsAdapter.grep,pick=H.pick,Series=H.Series,Color=H.Color;plotOptions.treemap=merge(plotOptions.scatter,{showInLegend:false,marker:false,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:true,defer:false,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:true},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:false,levelIsConstant:true,states:{hover:{borderColor:"#A0A0A0",brightness:seriesTypes.heatmap?0:.1,shadow:false}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var colorSeriesMixin={pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"borderDashStyle"},pointArrayMap:["value"],axisTypes:seriesTypes.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:noop,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:seriesTypes.heatmap&&seriesTypes.heatmap.prototype.translateColors};seriesTypes.treemap=extendClass(seriesTypes.scatter,merge(colorSeriesMixin,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:extendClass(H.Point,{setState:function(state,move){H.Point.prototype.setState.call(this,state,move);if(state==="hover"){if(this.dataLabel){this.dataLabel.attr({zIndex:1002})}}else{if(this.dataLabel){this.dataLabel.attr({zIndex:this.pointAttr[""].zIndex+1})}}},setVisible:seriesTypes.pie.prototype.pointClass.prototype.setVisible}),handleLayout:function(){var tree=this.tree,seriesArea;if(this.points.length){this.rootNode=pick(this.rootNode,"");tree=this.tree=this.getTree();this.levelMap=this.getLevels();seriesArea=this.getSeriesArea(tree.val);this.calculateChildrenAreas(tree,seriesArea);this.setPointValues()}},getTree:function(){var tree,series=this,parentList=[],allIds=[],key,insertItem=function(key){each(parentList[key],function(item){parentList[""].push(item)})};this.nodeMap=[];each(this.points,function(point,index){var parent="";allIds.push(point.id);if(point.parent!==undefined){parent=point.parent}if(parentList[parent]===undefined){parentList[parent]=[]}parentList[parent].push(index)});for(key in parentList){if(parentList.hasOwnProperty(key)&&key!==""&&HighchartsAdapter.inArray(key,allIds)===-1){insertItem(key);delete parentList[key]}}tree=series.buildNode("",-1,0,parentList,null);this.eachParents(this.nodeMap[this.rootNode],function(node){node.visible=true});this.eachChildren(this.nodeMap[this.rootNode],function(node){node.visible=true});this.setTreeValues(tree);return tree},buildNode:function(id,i,level,list,parent){var series=this,children=[],point=series.points[i],node,child;each(list[id]||[],function(i){child=series.buildNode(series.points[i].id,i,level+1,list,id);children.push(child)});node={id:id,i:i,children:children,level:level,parent:parent,visible:false};series.nodeMap[node.id]=node;if(point){point.node=node}return node},setTreeValues:function(tree){var series=this,childrenTotal=0,sorted=[],val,point=series.points[tree.i];each(tree.children,function(child){child=series.setTreeValues(child);series.insertElementSorted(sorted,child,function(el,el2){return el.val>el2.val});if(!child.ignore){childrenTotal+=child.val}else{series.eachChildren(child,function(node){extend(node,{ignore:true,isLeaf:false,visible:false})})}});val=pick(point&&point.value,childrenTotal);extend(tree,{children:sorted,childrenTotal:childrenTotal,ignore:!(pick(point&&point.visible,true)&&val>0),isLeaf:tree.visible&&!childrenTotal,name:pick(point&&point.name,""),val:val});return tree},eachChildren:function(node,callback){var series=this,children=node.children;callback(node);if(children.length){each(children,function(child){series.eachChildren(child,callback)})}},eachParents:function(node,callback){var parent=this.nodeMap[node.parent];callback(node);if(parent){this.eachParents(parent,callback)}},calculateChildrenAreas:function(parent,area){var series=this,options=series.options,levelNumber=options.levelIsConstant?parent.level:parent.level-this.nodeMap[this.rootNode].level,level=this.levelMap[levelNumber+1],algorithm=pick(series[level&&level.layoutAlgorithm]&&level.layoutAlgorithm,options.layoutAlgorithm),alternate=options.alternateStartingDirection,childrenValues=[],children,point;children=grep(parent.children,function(n){return!n.ignore});if(level&&level.layoutStartingDirection){area.direction=level.layoutStartingDirection==="vertical"?0:1}childrenValues=series[algorithm](area,children);each(children,function(child,index){point=series.points[child.i];point.level=levelNumber+1;child.values=merge(childrenValues[index],{val:child.childrenTotal,direction:alternate?1-area.direction:area.direction});if(child.children.length){series.calculateChildrenAreas(child,child.values)}})},setPointValues:function(){var series=this,xAxis=series.xAxis,yAxis=series.yAxis;series.nodeMap[""].values={x:0,y:0,width:100,height:100};each(series.points,function(point){var node=point.node,values=node.values,x1,x2,y1,y2;if(values){values.x=values.x/series.axisRatio;values.width=values.width/series.axisRatio;x1=Math.round(xAxis.translate(values.x,0,0,0,1));x2=Math.round(xAxis.translate(values.x+values.width,0,0,0,1));y1=Math.round(yAxis.translate(values.y,0,0,0,1));y2=Math.round(yAxis.translate(values.y+values.height,0,0,0,1));point.shapeType="rect";point.shapeArgs={x:Math.min(x1,x2),y:Math.min(y1,y2),width:Math.abs(x2-x1),height:Math.abs(y2-y1)};point.plotX=point.shapeArgs.x+point.shapeArgs.width/2;point.plotY=point.shapeArgs.y+point.shapeArgs.height/2}else{delete point.plotX;delete point.plotY}})},getSeriesArea:function(val){var x=0,y=0,h=100,r=this.axisRatio=this.xAxis.len/this.yAxis.len,w=100*r,d=this.options.layoutStartingDirection==="vertical"?0:1,seriesArea={x:x,y:y,width:w,height:h,direction:d,val:val};this.nodeMap[""].values=seriesArea;return seriesArea},getLevels:function(){var map=[],levels=this.options.levels;if(levels){each(levels,function(level){if(level.level!==undefined){map[level.level]=level}})}return map},setColorRecursive:function(node,color){var series=this,point,level;if(node){point=series.points[node.i];level=series.levelMap[node.level];color=pick(point&&point.options.color,level&&level.color,color);if(point){point.color=color}if(node.children.length){each(node.children,function(child){series.setColorRecursive(child,color)})}}},alg_func_group:function(h,w,d,p){this.height=h;this.width=w;this.plot=p;this.direction=d;this.startDirection=d;this.total=0;this.nW=0;this.lW=0;this.nH=0;this.lH=0;this.elArr=[];this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(w,h){return Math.max(w/h,h/w)}};this.addElement=function(el){this.lP.total=this.elArr[this.elArr.length-1];this.total=this.total+el;if(this.direction===0){this.lW=this.nW;this.lP.lH=this.lP.total/this.lW;this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH);this.nW=this.total/this.height;this.lP.nH=this.lP.total/this.nW;this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)}else{this.lH=this.nH;this.lP.lW=this.lP.total/this.lH;this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH);this.nH=this.total/this.width;this.lP.nW=this.lP.total/this.nH;this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)}this.elArr.push(el)};this.reset=function(){this.nW=0;this.lW=0;this.elArr=[];this.total=0}},alg_func_calcPoints:function(directionChange,last,group,childrenArea){var pX,pY,pW,pH,gW=group.lW,gH=group.lH,plot=group.plot,keep,i=0,end=group.elArr.length-1;if(last){gW=group.nW;gH=group.nH}else{keep=group.elArr[group.elArr.length-1]}each(group.elArr,function(p){if(last||i<end){if(group.direction===0){pX=plot.x;pY=plot.y;pW=gW;pH=p/pW}else{pX=plot.x;pY=plot.y;pH=gH;pW=p/pH}childrenArea.push({x:pX,y:pY,width:pW,height:pH});if(group.direction===0){plot.y=plot.y+pH}else{plot.x=plot.x+pW}}i=i+1});group.reset();if(group.direction===0){group.width=group.width-gW}else{group.height=group.height-gH}plot.y=plot.parent.y+(plot.parent.height-group.height);plot.x=plot.parent.x+(plot.parent.width-group.width);if(directionChange){group.direction=1-group.direction}if(!last){group.addElement(keep)}},alg_func_lowAspectRatio:function(directionChange,parent,children){var childrenArea=[],series=this,pTot,plot={x:parent.x,y:parent.y,parent:parent},direction=parent.direction,i=0,end=children.length-1,group=new this.alg_func_group(parent.height,parent.width,direction,plot);each(children,function(child){pTot=parent.width*parent.height*(child.val/parent.val);group.addElement(pTot);if(group.lP.nR>group.lP.lR){series.alg_func_calcPoints(directionChange,false,group,childrenArea,plot)}if(i===end){series.alg_func_calcPoints(directionChange,true,group,childrenArea,plot)}i=i+1});return childrenArea},alg_func_fill:function(directionChange,parent,children){var childrenArea=[],pTot,direction=parent.direction,x=parent.x,y=parent.y,width=parent.width,height=parent.height,pX,pY,pW,pH;each(children,function(child){pTot=parent.width*parent.height*(child.val/parent.val);pX=x;pY=y;if(direction===0){pH=height;pW=pTot/pH;width=width-pW;x=x+pW}else{pW=width;pH=pTot/pW;height=height-pH;y=y+pH}childrenArea.push({x:pX,y:pY,width:pW,height:pH});if(directionChange){direction=1-direction}});return childrenArea},strip:function(parent,children){return this.alg_func_lowAspectRatio(false,parent,children)},squarified:function(parent,children){return this.alg_func_lowAspectRatio(true,parent,children)},sliceAndDice:function(parent,children){return this.alg_func_fill(true,parent,children)},stripes:function(parent,children){return this.alg_func_fill(false,parent,children)},translate:function(){Series.prototype.translate.call(this);this.handleLayout();if(this.colorAxis){this.translateColors()}else if(!this.options.colorByPoint){this.setColorRecursive(this.tree,undefined)}},drawDataLabels:function(){var series=this,dataLabelsGroup=series.dataLabelsGroup,points=series.points,options,level;each(points,function(point){level=series.levelMap[point.level];options={style:{}};if(!point.node.isLeaf){options.enabled=false}if(level&&level.dataLabels){options=merge(options,level.dataLabels);series._hasPointLabels=true}if(point.shapeArgs){options.style.width=point.shapeArgs.width}point.dlOptions=merge(options,point.options.dataLabels)});this.dataLabelsGroup=this.group;Series.prototype.drawDataLabels.call(this);this.dataLabelsGroup=dataLabelsGroup},alignDataLabel:seriesTypes.column.prototype.alignDataLabel,drawPoints:function(){var series=this,points=series.points,seriesOptions=series.options,attr,hover,level;each(points,function(point){level=series.levelMap[point.level];attr={stroke:seriesOptions.borderColor,"stroke-width":seriesOptions.borderWidth,dashstyle:seriesOptions.borderDashStyle,r:0,fill:pick(point.color,series.color)};if(level){attr.stroke=level.borderColor||attr.stroke;attr["stroke-width"]=level.borderWidth||attr["stroke-width"];attr.dashstyle=level.borderDashStyle||attr.dashstyle}attr.stroke=point.borderColor||attr.stroke;attr["stroke-width"]=point.borderWidth||attr["stroke-width"];attr.dashstyle=point.borderDashStyle||attr.dashstyle;attr.zIndex=1e3-point.level*2;point.pointAttr=merge(point.pointAttr);hover=point.pointAttr.hover;hover.zIndex=1001;hover.fill=Color(attr.fill).brighten(seriesOptions.states.hover.brightness).get();if(!point.node.isLeaf){if(pick(seriesOptions.interactByLeaf,!seriesOptions.allowDrillToNode)){attr.fill="none";delete hover.fill}else{attr.fill=Color(attr.fill).setOpacity(.15).get();hover.fill=Color(hover.fill).setOpacity(.75).get()}}if(point.node.level<=series.nodeMap[series.rootNode].level){attr.fill="none";attr.zIndex=0;delete hover.fill}point.pointAttr[""]=H.extend(point.pointAttr[""],attr);if(point.dataLabel){point.dataLabel.attr({zIndex:point.pointAttr[""].zIndex+1})}});seriesTypes.column.prototype.drawPoints.call(this);each(points,function(point){if(point.graphic){point.graphic.attr(point.pointAttr[""])}});if(seriesOptions.allowDrillToNode){series.drillTo()}},insertElementSorted:function(arr,el,cond){var i=0,inserted=false;if(arr.length!==0){each(arr,function(arrayElement){if(cond(el,arrayElement)&&!inserted){arr.splice(i,0,el);inserted=true}i=i+1})}if(!inserted){arr.push(el)}},drillTo:function(){var series=this,points=series.points;each(points,function(point){var drillId,drillName;H.removeEvent(point,"click.drillTo");if(point.graphic){point.graphic.css({cursor:"default"})}if(series.options.interactByLeaf){drillId=series.drillToByLeaf(point)}else{drillId=series.drillToByGroup(point)}if(drillId){drillName=series.nodeMap[series.rootNode].name||series.rootNode;if(point.graphic){point.graphic.css({cursor:"pointer"})}H.addEvent(point,"click.drillTo",function(){point.setState("");series.drillToNode(drillId);series.showDrillUpButton(drillName)})}})},drillToByGroup:function(point){var series=this,drillId=false;if(point.node.level-series.nodeMap[series.rootNode].level===1&&!point.node.isLeaf){drillId=point.id}return drillId},drillToByLeaf:function(point){var series=this,drillId=false,nodeParent;if(point.node.parent!==series.rootNode&&point.node.isLeaf){nodeParent=point.node;while(!drillId){nodeParent=series.nodeMap[nodeParent.parent];if(nodeParent.parent===series.rootNode){drillId=nodeParent.id}}}return drillId},drillUp:function(){var drillPoint=null,node,parent;if(this.rootNode){node=this.nodeMap[this.rootNode];if(node.parent!==null){drillPoint=this.nodeMap[node.parent]}else{drillPoint=this.nodeMap[""]}}if(drillPoint!==null){this.drillToNode(drillPoint.id);if(drillPoint.id===""){this.drillUpButton=this.drillUpButton.destroy()}else{parent=this.nodeMap[drillPoint.parent];this.showDrillUpButton(parent.name||parent.id)}}},drillToNode:function(id){var node=this.nodeMap[id],val=node.values;this.rootNode=id;this.xAxis.setExtremes(val.x,val.x+val.width,false);this.yAxis.setExtremes(val.y,val.y+val.height,false);this.isDirty=true;this.chart.redraw()},showDrillUpButton:function(name){var series=this,backText=name||"< Back",buttonOptions=series.options.drillUpButton,attr,states;if(buttonOptions.text){backText=buttonOptions.text}if(!this.drillUpButton){attr=buttonOptions.theme;states=attr&&attr.states;this.drillUpButton=this.chart.renderer.button(backText,null,null,function(){series.drillUp()},attr,states&&states.hover,states&&states.select).attr({align:buttonOptions.position.align,zIndex:9}).add().align(buttonOptions.position,false,buttonOptions.relativeTo||"plotBox")}else{this.drillUpButton.attr({text:backText}).align()}},buildKDTree:noop,drawLegendSymbol:H.LegendSymbolMixin.drawRectangle,getExtremes:function(){Series.prototype.getExtremes.call(this,this.colorValueData);this.valueMin=this.dataMin;this.valueMax=this.dataMax;Series.prototype.getExtremes.call(this)},getExtremesFromAll:true,bindAxes:function(){var treeAxis={endOnTick:false,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:false,title:null,tickPositions:[]};Series.prototype.bindAxes.call(this);H.extend(this.yAxis.options,treeAxis);H.extend(this.xAxis.options,treeAxis)}}))})(Highcharts);