/**
 * @license Highcharts JS v4.1.8 (2015-08-20)
 * Client side exporting module
 *
 * (c) 2015 Torstein Honsi / Oystein Moseng
 *
 * License: www.highcharts.com/license
 */
(function(Highcharts){Highcharts.CanVGRenderer={};Highcharts.Chart.prototype.exportChartLocal=function(exportingOptions,chartOptions){var chart=this,options=Highcharts.merge(chart.options.exporting,exportingOptions),webKit=navigator.userAgent.indexOf("WebKit")>-1&&navigator.userAgent.indexOf("Chrome")<0,scale=options.scale||2,chartCopyContainer,domurl=window.URL||window.webkitURL||window,images,imagesEmbedded=0,el,i,l,fallbackToExportServer=function(){if(options.fallbackToExportServer===false){throw"Fallback to export server disabled"}chart.exportChart(options)},imageToDataUrl=function(imageURL,callbackArgs,successCallback,taintedCallback,noCanvasSupportCallback,failedLoadCallback,finallyCallback){var img=new Image;if(!webKit){img.crossOrigin="Anonymous"}img.onload=function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext&&canvas.getContext("2d"),dataURL;if(!ctx){noCanvasSupportCallback(imageURL,callbackArgs)}else{canvas.height=img.height*scale;canvas.width=img.width*scale;ctx.drawImage(img,0,0,canvas.width,canvas.height);try{dataURL=canvas.toDataURL();successCallback(dataURL,callbackArgs)}catch(e){if(e.name==="SecurityError"||e.name==="SECURITY_ERR"||e.message==="SecurityError"){taintedCallback(imageURL,callbackArgs)}else{throw e}}}if(finallyCallback){finallyCallback(imageURL,callbackArgs)}};img.onerror=function(){failedLoadCallback(imageURL,callbackArgs);if(finallyCallback){finallyCallback(imageURL,callbackArgs)}};img.src=imageURL},svgToDataUrl=function(svg){try{if(!webKit){return domurl.createObjectURL(new Blob([svg],{type:"image/svg+xml;charset-utf-16"}))}}catch(e){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(svg)},download=function(dataURL,extension){var a=document.createElement("a"),filename=(options.filename||"chart")+"."+extension,windowRef;if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(dataURL,filename);return}if(typeof a.download!=="undefined"){a.href=dataURL;a.download=filename;a.target="_blank";document.body.appendChild(a);a.click();document.body.removeChild(a)}else{try{windowRef=window.open(dataURL,"chart");if(typeof windowRef==="undefined"||windowRef===null){throw 1}}catch(e){window.location.href=dataURL}}},initiateDownload=function(){var svgurl,blob,svg=chart.sanitizeSVG(chartCopyContainer.innerHTML);if(options&&options.type==="image/svg+xml"){try{if(navigator.msSaveOrOpenBlob){blob=new MSBlobBuilder;blob.append(svg);svgurl=blob.getBlob("image/svg+xml")}else{svgurl=svgToDataUrl(svg)}download(svgurl,"svg")}catch(e){fallbackToExportServer()}}else{svgurl=svgToDataUrl(svg);imageToDataUrl(svgurl,{},function(imageURL){try{download(imageURL,"png")}catch(e){fallbackToExportServer()}},function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),imageWidth=svg.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*scale,imageHeight=svg.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*scale,downloadWithCanVG=function(){ctx.drawSvg(svg,0,0,imageWidth,imageHeight);try{download(navigator.msSaveOrOpenBlob?canvas.msToBlob():canvas.toDataURL("image/png"),"png")}catch(e){fallbackToExportServer()}};canvas.width=imageWidth;canvas.height=imageHeight;if(window.canvg){downloadWithCanVG()}else{chart.showLoading();HighchartsAdapter.getScript(Highcharts.getOptions().global.canvasToolsURL,function(){chart.hideLoading();downloadWithCanVG()})}},fallbackToExportServer,fallbackToExportServer,function(){try{domurl.revokeObjectURL(svgurl)}catch(e){}})}};Highcharts.wrap(Highcharts.Chart.prototype,"getChartHTML",function(proceed){chartCopyContainer=this.container.cloneNode(true);return proceed.apply(this,Array.prototype.slice.call(arguments,1))});chart.getSVGForExport(options,chartOptions);images=chartCopyContainer.getElementsByTagName("image");try{if(!images.length){initiateDownload()}function embeddedSuccess(imageURL,callbackArgs){++imagesEmbedded;callbackArgs.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",imageURL);if(imagesEmbedded===images.length){initiateDownload()}}for(i=0,l=images.length;i<l;++i){el=images[i];imageToDataUrl(el.getAttributeNS("http://www.w3.org/1999/xlink","href"),{imageElement:el},embeddedSuccess,fallbackToExportServer,fallbackToExportServer,fallbackToExportServer)}}catch(e){fallbackToExportServer()}};Highcharts.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:true},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]})(Highcharts);