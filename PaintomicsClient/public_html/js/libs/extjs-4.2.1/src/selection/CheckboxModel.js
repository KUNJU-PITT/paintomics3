Ext.define("Ext.selection.CheckboxModel",{alias:"selection.checkboxmodel",extend:"Ext.selection.RowModel",mode:"MULTI",injectCheckbox:0,checkOnly:false,showHeaderCheckbox:undefined,checkSelector:"."+Ext.baseCSSPrefix+"grid-row-checker",headerWidth:24,checkerOnCls:Ext.baseCSSPrefix+"grid-hd-checker-on",constructor:function(){var me=this;me.callParent(arguments);if(me.mode==="SINGLE"&&me.showHeaderCheckbox!==true){me.showHeaderCheckbox=false}},beforeViewRender:function(view){var me=this,owner;me.callParent(arguments);if(!me.hasLockedHeader()||view.headerCt.lockedCt){if(me.showHeaderCheckbox!==false){view.headerCt.on("headerclick",me.onHeaderClick,me)}me.addCheckbox(view,true);owner=view.ownerCt;if(view.headerCt.lockedCt){owner=owner.ownerCt}me.mon(owner,"reconfigure",me.onReconfigure,me)}},bindComponent:function(view){var me=this;me.sortable=false;me.callParent(arguments)},hasLockedHeader:function(){var views=this.views,vLen=views.length,v;for(v=0;v<vLen;v++){if(views[v].headerCt.lockedCt){return true}}return false},addCheckbox:function(view,initial){var me=this,checkbox=me.injectCheckbox,headerCt=view.headerCt;if(checkbox!==false){if(checkbox=="first"){checkbox=0}else if(checkbox=="last"){checkbox=headerCt.getColumnCount()}Ext.suspendLayouts();if(view.getStore().buffered){me.showHeaderCheckbox=false}headerCt.add(checkbox,me.getHeaderConfig());Ext.resumeLayouts()}if(initial!==true){view.refresh()}},onReconfigure:function(grid,store,columns){if(columns){this.addCheckbox(this.views[0])}},toggleUiHeader:function(isChecked){var view=this.views[0],headerCt=view.headerCt,checkHd=headerCt.child("gridcolumn[isCheckerHd]"),cls=this.checkerOnCls;if(checkHd){if(isChecked){checkHd.addCls(cls)}else{checkHd.removeCls(cls)}}},onHeaderClick:function(headerCt,header,e){if(header.isCheckerHd){e.stopEvent();var me=this,isChecked=header.el.hasCls(Ext.baseCSSPrefix+"grid-hd-checker-on");me.preventFocus=true;if(isChecked){me.deselectAll()}else{me.selectAll()}delete me.preventFocus}},getHeaderConfig:function(){var me=this,showCheck=me.showHeaderCheckbox!==false;return{isCheckerHd:showCheck,text:"&#160;",clickTargetName:"el",width:me.headerWidth,sortable:false,draggable:false,resizable:false,hideable:false,menuDisabled:true,dataIndex:"",cls:showCheck?Ext.baseCSSPrefix+"column-header-checkbox ":"",renderer:Ext.Function.bind(me.renderer,me),editRenderer:me.editRenderer||me.renderEmpty,locked:me.hasLockedHeader()}},renderEmpty:function(){return"&#160;"},refresh:function(){this.callParent(arguments);this.updateHeaderState()},renderer:function(value,metaData,record,rowIndex,colIndex,store,view){var baseCSSPrefix=Ext.baseCSSPrefix;metaData.tdCls=baseCSSPrefix+"grid-cell-special "+baseCSSPrefix+"grid-cell-row-checker";return'<div class="'+baseCSSPrefix+'grid-row-checker">&#160;</div>'},processSelection:function(view,record,item,index,e){var me=this,checker=e.getTarget(me.checkSelector),mode;if(me.checkOnly&&!checker){return}if(checker){mode=me.getSelectionMode();if(mode!=="SINGLE"){me.setSelectionMode("SIMPLE")}me.selectWithEvent(record,e);me.setSelectionMode(mode)}else{me.selectWithEvent(record,e)}},onSelectChange:function(){this.callParent(arguments);if(!this.suspendChange){this.updateHeaderState()}},onStoreLoad:function(){this.callParent(arguments);this.updateHeaderState()},onStoreAdd:function(){this.callParent(arguments);this.updateHeaderState()},onStoreRemove:function(){this.callParent(arguments);this.updateHeaderState()},onStoreRefresh:function(){this.callParent(arguments);this.updateHeaderState()},maybeFireSelectionChange:function(fireEvent){if(fireEvent&&!this.suspendChange){this.updateHeaderState()}this.callParent(arguments)},resumeChanges:function(){this.callParent();if(!this.suspendChange){this.updateHeaderState()}},updateHeaderState:function(){var me=this,store=me.store,storeCount=store.getCount(),views=me.views,hdSelectStatus=false,selectedCount=0,selected,len,i;if(!store.buffered&&storeCount>0){selected=me.selected;hdSelectStatus=true;for(i=0,len=selected.getCount();i<len;++i){if(!me.storeHasSelected(selected.getAt(i))){break}++selectedCount}hdSelectStatus=storeCount===selectedCount}if(views&&views.length){me.toggleUiHeader(hdSelectStatus)}}});