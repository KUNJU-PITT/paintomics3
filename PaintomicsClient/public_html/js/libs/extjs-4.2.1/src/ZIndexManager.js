Ext.define("Ext.ZIndexManager",{alternateClassName:"Ext.WindowGroup",statics:{zBase:9e3},constructor:function(container){var me=this;me.list={};me.zIndexStack=[];me.front=null;if(container){if(container.isContainer){container.on("resize",me._onContainerResize,me);me.zseed=Ext.Number.from(me.rendered?container.getEl().getStyle("zIndex"):undefined,me.getNextZSeed());me.targetEl=container.getTargetEl();me.container=container}else{Ext.EventManager.onWindowResize(me._onContainerResize,me);me.zseed=me.getNextZSeed();me.targetEl=Ext.get(container)}}else{Ext.EventManager.onWindowResize(me._onContainerResize,me);me.zseed=me.getNextZSeed();Ext.onDocumentReady(function(){me.targetEl=Ext.getBody()})}},getNextZSeed:function(){return Ext.ZIndexManager.zBase+=1e4},setBase:function(baseZIndex){this.zseed=baseZIndex;var result=this.assignZIndices();this._activateLast();return result},assignZIndices:function(){var a=this.zIndexStack,len=a.length,i=0,zIndex=this.zseed,comp,topModal;for(;i<len;i++){comp=a[i];if(comp&&!comp.hidden){zIndex=comp.setZIndex(zIndex);if(comp.modal){topModal=comp}}}if(topModal){this._showModalMask(topModal)}return zIndex},_setActiveChild:function(comp,oldFront){var front=this.front,oldPreventFocus=comp.preventFocusOnActivate;if(comp!==front){if(front&&!front.destroying){front.setActive(false,comp)}this.front=comp;if(comp&&comp!=oldFront){comp.preventFocusOnActivate=comp.preventFocusOnActivate||oldFront&&(oldFront.preventFocusOnActivate||!oldFront.focusOnToFront);comp.setActive(true);if(comp.modal){this._showModalMask(comp)}comp.preventFocusOnActivate=oldPreventFocus}}},onComponentHide:function(comp){this._activateLast()},_activateLast:function(){var me=this,stack=me.zIndexStack,i=stack.length-1,comp;for(;i>=0&&stack[i].hidden;--i);if(comp=stack[i]){me._setActiveChild(comp,me.front);if(comp.modal){return}}else{if(me.front&&!me.front.destroying){me.front.setActive(false)}me.front=null}for(;i>=0;--i){comp=stack[i];if(comp.isVisible()&&comp.modal){me._showModalMask(comp);return}}me._hideModalMask()},_showModalMask:function(comp){var me=this,zIndex=comp.el.getStyle("zIndex")-4,maskTarget=comp.floatParent?comp.floatParent.getTargetEl():comp.container,mask=me.mask,shim=me.maskShim,viewSize;if(!mask){if(Ext.isIE6){shim=me.maskShim=Ext.getBody().createChild({tag:"iframe",cls:Ext.baseCSSPrefix+"shim "+Ext.baseCSSPrefix+"mask-shim"});shim.setVisibilityMode(Ext.Element.DISPLAY)}mask=me.mask=Ext.getBody().createChild({cls:Ext.baseCSSPrefix+"mask",style:"height:0;width:0"});mask.setVisibilityMode(Ext.Element.DISPLAY);mask.on("click",me._onMaskClick,me)}mask.maskTarget=maskTarget;viewSize=me.getMaskBox();if(shim){shim.setStyle("zIndex",zIndex);shim.show();shim.setBox(viewSize)}mask.setStyle("zIndex",zIndex);mask.show();mask.setBox(viewSize)},_hideModalMask:function(){var mask=this.mask,maskShim=this.maskShim;if(mask&&mask.isVisible()){mask.maskTarget=undefined;mask.hide();if(maskShim){maskShim.hide()}}},_onMaskClick:function(){if(this.front){this.front.focus()}},getMaskBox:function(){var maskTarget=this.mask.maskTarget;if(maskTarget.dom===document.body){return{height:Math.max(document.body.scrollHeight,Ext.dom.Element.getDocumentHeight()),width:Math.max(document.body.scrollWidth,document.documentElement.clientWidth),x:0,y:0}}else{return maskTarget.getBox()}},_onContainerResize:function(){var me=this,mask=me.mask,maskShim=me.maskShim,viewSize;if(mask&&mask.isVisible()){mask.hide();if(maskShim){maskShim.hide()}viewSize=me.getMaskBox();if(maskShim){maskShim.setSize(viewSize);maskShim.show()}mask.setSize(viewSize);mask.show()}},register:function(comp){var me=this,compAfterHide=comp.afterHide;if(comp.zIndexManager){comp.zIndexManager.unregister(comp)}comp.zIndexManager=me;me.list[comp.id]=comp;me.zIndexStack.push(comp);comp.afterHide=function(){compAfterHide.apply(comp,arguments);me.onComponentHide(comp)}},unregister:function(comp){var me=this,list=me.list;delete comp.zIndexManager;if(list&&list[comp.id]){delete list[comp.id];delete comp.afterHide;Ext.Array.remove(me.zIndexStack,comp);me._activateLast()}},get:function(id){return id.isComponent?id:this.list[id]},bringToFront:function(comp,preventFocus){var me=this,result=false,zIndexStack=me.zIndexStack;comp=me.get(comp);if(comp!==me.front){Ext.Array.remove(zIndexStack,comp);if(comp.preventBringToFront){zIndexStack.unshift(comp)}else{zIndexStack.push(comp)}me.assignZIndices();if(!preventFocus){me._activateLast()}result=true;me.front=comp;if(comp.modal){me._showModalMask(comp)}}return result},sendToBack:function(comp){var me=this;comp=me.get(comp);Ext.Array.remove(me.zIndexStack,comp);me.zIndexStack.unshift(comp);me.assignZIndices();this._activateLast();return comp},hideAll:function(){var list=this.list,item,id;for(id in list){if(list.hasOwnProperty(id)){item=list[id];if(item.isComponent&&item.isVisible()){item.hide()}}}},hide:function(){var i=0,stack=this.zIndexStack,len=stack.length,comp;this.tempHidden=[];for(;i<len;i++){comp=stack[i];if(comp.isVisible()){this.tempHidden.push(comp);comp.el.hide();comp.hidden=true}}},show:function(){var i=0,tempHidden=this.tempHidden,len=tempHidden?tempHidden.length:0,comp;for(;i<len;i++){comp=tempHidden[i];comp.el.show();comp.hidden=false;comp.setPosition(comp.x,comp.y)}delete this.tempHidden},getActive:function(){return this.front},getBy:function(fn,scope){var r=[],i=0,stack=this.zIndexStack,len=stack.length,comp;for(;i<len;i++){comp=stack[i];if(fn.call(scope||comp,comp)!==false){r.push(comp)}}return r},each:function(fn,scope){var list=this.list,id,comp;for(id in list){if(list.hasOwnProperty(id)){comp=list[id];if(comp.isComponent&&fn.call(scope||comp,comp)===false){return}}}},eachBottomUp:function(fn,scope){var stack=this.zIndexStack,i=0,len=stack.length,comp;for(;i<len;i++){comp=stack[i];if(comp.isComponent&&fn.call(scope||comp,comp)===false){return}}},eachTopDown:function(fn,scope){var stack=this.zIndexStack,i=stack.length,comp;for(;i-- >0;){comp=stack[i];if(comp.isComponent&&fn.call(scope||comp,comp)===false){return}}},destroy:function(){var me=this,list=me.list,comp,id;for(id in list){if(list.hasOwnProperty(id)){comp=list[id];if(comp.isComponent){comp.destroy()}}}delete me.zIndexStack;delete me.list;delete me.container;delete me.targetEl}},function(){Ext.WindowManager=Ext.WindowMgr=new this});