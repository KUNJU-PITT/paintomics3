Ext.define("Ext.container.AbstractContainer",{extend:"Ext.Component",requires:["Ext.util.MixedCollection","Ext.layout.container.Auto","Ext.ZIndexManager"],mixins:{queryable:"Ext.Queryable"},renderTpl:"{%this.renderContainer(out,values)%}",suspendLayout:false,autoDestroy:true,defaultType:"panel",detachOnRemove:true,isContainer:true,layoutCounter:0,baseCls:Ext.baseCSSPrefix+"container",defaultLayoutType:"auto",initComponent:function(){var me=this;me.addEvents("afterlayout","beforeadd","beforeremove","add","remove");me.callParent();me.getLayout();me.initItems()},initItems:function(){var me=this,items=me.items;me.items=new Ext.util.AbstractMixedCollection(false,me.getComponentId);me.floatingItems=new Ext.util.MixedCollection(false,me.getComponentId);if(items){if(!Ext.isArray(items)){items=[items]}me.add(items)}},getFocusEl:function(){return this.getTargetEl()},finishRenderChildren:function(){this.callParent();var layout=this.getLayout();if(layout){layout.finishRender()}},beforeRender:function(){var me=this,layout=me.getLayout(),targetCls;me.callParent();if(!layout.initialized){layout.initLayout()}targetCls=layout.targetCls;if(targetCls){me.applyTargetCls(targetCls)}},applyTargetCls:function(targetCls){this.addCls(targetCls)},afterComponentLayout:function(){var floaters=this.floatingItems.items,floaterCount=floaters.length,i,floater;this.callParent(arguments);for(i=0;i<floaterCount;i++){floater=floaters[i];if(!floater.rendered&&floater.autoShow){floater.show()}}},onPosition:function(){this.callParent(arguments);this.repositionFloatingItems()},onResize:function(){this.callParent(arguments);this.repositionFloatingItems()},repositionFloatingItems:function(){var floaters=this.floatingItems.items,floaterCount=floaters.length,i,floater;for(i=0;i<floaterCount;i++){floater=floaters[i];if(floater.el&&!floater.hidden){floater.setPosition(floater.x,floater.y)}}},setupRenderTpl:function(renderTpl){this.callParent(arguments);this.getLayout().setupRenderTpl(renderTpl)},getDefaultContentTarget:function(){return this.el},getContentTarget:function(){return this.getLayout().getContentTarget()},setLayout:function(layout){var currentLayout=this.layout;if(currentLayout&&currentLayout.isLayout&&currentLayout!=layout){currentLayout.setOwner(null)}this.layout=layout;layout.setOwner(this)},getLayout:function(){var me=this;if(!me.layout||!me.layout.isLayout){me.setLayout(Ext.layout.Layout.create(me.layout,me.self.prototype.layout||me.defaultLayoutType))}return me.layout},doLayout:function(){this.updateLayout();return this},afterLayout:function(layout){var me=this;++me.layoutCounter;if(me.hasListeners.afterlayout){me.fireEvent("afterlayout",me,layout)}},prepareItems:function(items,applyDefaults){if(Ext.isArray(items)){items=items.slice()}else{items=[items]}var me=this,i=0,len=items.length,item;for(;i<len;i++){item=items[i];if(item==null){Ext.Array.erase(items,i,1);--i;--len}else{if(applyDefaults){item=this.applyDefaults(item)}item.isContained=me;items[i]=me.lookupComponent(item);delete item.isContained;delete items[i].isContained}}return items},applyDefaults:function(config){var defaults=this.defaults;if(defaults){if(Ext.isFunction(defaults)){defaults=defaults.call(this,config)}if(Ext.isString(config)){config=Ext.ComponentManager.get(config)}Ext.applyIf(config,defaults)}return config},lookupComponent:function(comp){return typeof comp=="string"?Ext.ComponentManager.get(comp):Ext.ComponentManager.create(comp,this.defaultType)},getComponentId:function(comp){return comp.getItemId&&comp.getItemId()},add:function(){var me=this,args=Ext.Array.slice(arguments),index=typeof args[0]=="number"?args.shift():-1,layout=me.getLayout(),addingArray,items,i,length,item,pos,ret;if(args.length==1&&Ext.isArray(args[0])){items=args[0];addingArray=true}else{items=args}if(me.rendered){Ext.suspendLayouts()}ret=items=me.prepareItems(items,true);length=items.length;if(!addingArray&&length==1){ret=items[0]}for(i=0;i<length;i++){item=items[i];if(!item){Ext.Error.raise("Cannot add null item to Container with itemId/id: "+me.getItemId())}pos=index<0?me.items.length:index+i;if(item.floating){me.floatingItems.add(item);item.onAdded(me,pos);if(me.hasListeners.add){me.fireEvent("add",me,item,pos)}}else if((!me.hasListeners.beforeadd||me.fireEvent("beforeadd",me,item,pos)!==false)&&me.onBeforeAdd(item)!==false){me.items.insert(pos,item);item.onAdded(me,pos);me.onAdd(item,pos);layout.onAdd(item,pos);if(me.hasListeners.add){me.fireEvent("add",me,item,pos)}}}me.updateLayout();if(me.rendered){Ext.resumeLayouts(true)}return ret},onAdd:Ext.emptyFn,onRemove:Ext.emptyFn,insert:function(index,comp){var compIdx;if(comp&&comp.isComponent){compIdx=this.items.indexOf(comp);if(compIdx!==-1){return this.move(compIdx,index)}}return this.add(index,comp)},move:function(fromIdx,toIdx){var items=this.items,item;if(fromIdx.isComponent){fromIdx=items.indexOf(fromIdx)}item=items.removeAt(fromIdx);if(item===false){return false}items.insert(toIdx,item);this.onMove(item,fromIdx,toIdx);this.updateLayout();return item},onMove:Ext.emptyFn,onBeforeAdd:function(item){if(item.ownerCt&&item.ownerCt!==this){item.ownerCt.remove(item,false)}},remove:function(comp,autoDestroy){var me=this,c=me.getComponent(comp);if(Ext.isDefined(Ext.global.console)&&!c){Ext.global.console.warn("Attempted to remove a component that does not exist. Ext.container.Container: remove takes an argument of the component to remove. cmp.remove() is incorrect usage.")}if(c&&(!me.hasListeners.beforeremove||me.fireEvent("beforeremove",me,c)!==false)){me.doRemove(c,autoDestroy);if(me.hasListeners.remove){me.fireEvent("remove",me,c)}if(!me.destroying&&!c.floating){me.updateLayout()}}return c},doRemove:function(component,doDestroy){doDestroy=doDestroy===true||doDestroy!==false&&this.autoDestroy;var me=this,layout=me.layout,hasLayout=layout&&me.rendered,isDestroying=component.destroying||doDestroy,floating=component.floating;if(floating){me.floatingItems.remove(component)}else{me.items.remove(component)}if(hasLayout&&!floating){if(layout.running){Ext.AbstractComponent.cancelLayout(component,isDestroying)}layout.onRemove(component,isDestroying)}component.onRemoved(isDestroying);me.onRemove(component,isDestroying);if(doDestroy){component.destroy()}else{if(hasLayout&&!floating){layout.afterRemove(component)}if(me.detachOnRemove&&component.rendered){me.detachComponent(component)}}},detachComponent:function(component){Ext.getDetachedBody().appendChild(component.getEl())},removeAll:function(autoDestroy){var me=this,removeItems=me.items.items.slice().concat(me.floatingItems.items),items=[],i=0,len=removeItems.length,item;me.suspendLayouts();for(;i<len;i++){item=removeItems[i];me.remove(item,autoDestroy);if(item.ownerCt!==me){items.push(item)}}me.resumeLayouts(!!len);return items},getRefItems:function(deep){var me=this,items=me.items.items,len=items.length,i=0,item,result=[];for(;i<len;i++){item=items[i];result[result.length]=item;if(deep&&item.getRefItems){result.push.apply(result,item.getRefItems(true))}}items=me.floatingItems.items;len=items.length;for(i=0;i<len;i++){item=items[i];result[result.length]=item;if(deep&&item.getRefItems){result.push.apply(result,item.getRefItems(true))}}return result},cascade:function(fn,scope,origArgs){var me=this,cs=me.items?me.items.items:[],len=cs.length,i=0,c,args=origArgs?origArgs.concat(me):[me],componentIndex=args.length-1;if(fn.apply(scope||me,args)!==false){for(;i<len;i++){c=cs[i];if(c.cascade){c.cascade(fn,scope,origArgs)}else{args[componentIndex]=c;fn.apply(scope||cs,args)}}}return this},isAncestor:function(possibleDescendant){while(possibleDescendant){if(possibleDescendant.ownerCt===this){return true}possibleDescendant=possibleDescendant.ownerCt}},getComponent:function(comp){if(Ext.isObject(comp)){comp=comp.getItemId()}var c=this.items.get(comp);if(!c&&typeof comp!="number"){c=this.floatingItems.get(comp)}return c},contains:function(comp,deep){var result=false;if(deep){this.cascade(function(c){if(c.contains&&c.contains(comp)){result=true;return false}});return result}else{return this.items.contains(comp)||this.floatingItems.contains(comp)}},nextChild:function(child,selector){var me=this,result,childIndex=me.items.indexOf(child);if(childIndex!==-1){result=selector?Ext.ComponentQuery(selector,me.items.items.slice(childIndex+1)):me.items.getAt(childIndex+1);if(!result&&me.ownerCt){result=me.ownerCt.nextChild(me,selector)}}return result},prevChild:function(child,selector){var me=this,result,childIndex=me.items.indexOf(child);if(childIndex!==-1){result=selector?Ext.ComponentQuery(selector,me.items.items.slice(childIndex+1)):me.items.getAt(childIndex+1);if(!result&&me.ownerCt){result=me.ownerCt.nextChild(me,selector)}}return result},enable:function(){this.callParent(arguments);var itemsToDisable=this.getChildItemsToDisable(),length=itemsToDisable.length,item,i;for(i=0;i<length;i++){item=itemsToDisable[i];if(item.resetDisable){item.enable()}}return this},disable:function(){this.callParent(arguments);var itemsToDisable=this.getChildItemsToDisable(),length=itemsToDisable.length,item,i;for(i=0;i<length;i++){item=itemsToDisable[i];if(item.resetDisable!==false&&!item.disabled){item.disable();item.resetDisable=true}}return this},getChildItemsToDisable:function(){return this.query("[isFormField],button")},beforeDestroy:function(){var me=this,items=me.items,floatingItems=me.floatingItems,c;if(items){while(c=items.first()){me.doRemove(c,true)}}if(floatingItems){while(c=floatingItems.first()){me.doRemove(c,true)}}Ext.destroy(me.layout);me.callParent()}});