Ext.define("Ext.util.MixedCollection",{extend:"Ext.util.AbstractMixedCollection",mixins:{sortable:"Ext.util.Sortable"},constructor:function(){var me=this;me.callParent(arguments);me.addEvents("sort");me.mixins.sortable.initSortable.call(me)},doSort:function(sorterFn){this.sortBy(sorterFn)},_sort:function(property,dir,fn){var me=this,i,len,dsc=String(dir).toUpperCase()=="DESC"?-1:1,c=[],keys=me.keys,items=me.items,o;fn=fn||function(a,b){return a-b};for(i=0,len=items.length;i<len;i++){c[c.length]={key:keys[i],value:items[i],index:i}}Ext.Array.sort(c,function(a,b){return fn(a[property],b[property])*dsc||(a.index<b.index?-1:1)});for(i=0,len=c.length;i<len;i++){o=c[i];items[i]=o.value;keys[i]=o.key;me.indexMap[o.key]=i}me.generation++;me.indexGeneration=me.generation;me.fireEvent("sort",me)},sortBy:function(sorterFn){var me=this,items=me.items,item,keys=me.keys,key,length=items.length,i;for(i=0;i<length;i++){items[i].$extCollectionIndex=i}Ext.Array.sort(items,function(a,b){return sorterFn(a,b)||(a.$extCollectionIndex<b.$extCollectionIndex?-1:1)});for(i=0;i<length;i++){item=items[i];key=me.getKey(item);keys[i]=key;me.indexMap[key]=i;delete items.$extCollectionIndex}me.generation++;me.indexGeneration=me.generation;me.fireEvent("sort",me,items,keys)},findInsertionIndex:function(newItem,sorterFn){var me=this,items=me.items,start=0,end=items.length-1,middle,comparison;if(!sorterFn){sorterFn=me.generateComparator()}while(start<=end){middle=start+end>>1;comparison=sorterFn(newItem,items[middle]);if(comparison>=0){start=middle+1}else if(comparison<0){end=middle-1}}return start},reorder:function(mapping){var me=this,items=me.items,index=0,length=items.length,order=[],remaining=[],oldIndex;me.suspendEvents();for(oldIndex in mapping){order[mapping[oldIndex]]=items[oldIndex]}for(index=0;index<length;index++){if(mapping[index]==undefined){remaining.push(items[index])}}for(index=0;index<length;index++){if(order[index]==undefined){order[index]=remaining.shift()}}me.clear();me.addAll(order);me.resumeEvents();me.fireEvent("sort",me)},sortByKey:function(dir,fn){this._sort("key",dir,fn||function(a,b){var v1=String(a).toUpperCase(),v2=String(b).toUpperCase();return v1>v2?1:v1<v2?-1:0})}});