Ext.define("Ext.util.KeyMap",{alternateClassName:"Ext.KeyMap",eventName:"keydown",constructor:function(config){var me=this;if(arguments.length!==1||typeof config==="string"||config.dom||config.tagName||config===document||config.isComponent){me.legacyConstructor.apply(me,arguments);return}Ext.apply(me,config);me.bindings=[];if(!me.target.isComponent){me.target=Ext.get(me.target)}if(me.binding){me.addBinding(me.binding)}else if(config.key){me.addBinding(config)}me.enable()},legacyConstructor:function(el,binding,eventName){var me=this;Ext.apply(me,{target:Ext.get(el),eventName:eventName||me.eventName,bindings:[]});if(binding){me.addBinding(binding)}me.enable()},addBinding:function(binding){var me=this,keyCode=binding.key,i,len;if(me.processing){me.bindings=bindings.slice(0)}if(Ext.isArray(binding)){for(i=0,len=binding.length;i<len;i++){me.addBinding(binding[i])}return}me.bindings.push(Ext.apply({keyCode:me.processKeys(keyCode)},binding))},removeBinding:function(binding){var me=this,bindings=me.bindings,len=bindings.length,i,item,keys;if(me.processing){me.bindings=bindings.slice(0)}keys=me.processKeys(binding.key);for(i=0;i<len;++i){item=bindings[i];if(item.fn===binding.fn&&item.scope===binding.scope){if(binding.alt==item.alt&&binding.crtl==item.crtl&&binding.shift==item.shift){if(Ext.Array.equals(item.keyCode,keys)){Ext.Array.erase(me.bindings,i,1);return}}}}},processKeys:function(keyCode){var processed=false,key,keys,keyString,len,i;if(Ext.isString(keyCode)){keys=[];keyString=keyCode.toUpperCase();for(i=0,len=keyString.length;i<len;++i){keys.push(keyString.charCodeAt(i))}keyCode=keys;processed=true}if(!Ext.isArray(keyCode)){keyCode=[keyCode]}if(!processed){for(i=0,len=keyCode.length;i<len;++i){key=keyCode[i];if(Ext.isString(key)){keyCode[i]=key.toUpperCase().charCodeAt(0)}}}return keyCode},handleTargetEvent:function(){var tagRe=/input|textarea/i;return function(event){var me=this,bindings,i,len,target,contentEditable;if(me.enabled){bindings=me.bindings;i=0;len=bindings.length;event=me.processEvent.apply(me||me.processEventScope,arguments);if(me.ignoreInputFields){target=event.target;contentEditable=target.contentEditable;if(tagRe.test(target.tagName)||(contentEditable===""||contentEditable==="true")){return}}if(!event.getKey){return event}me.processing=true;for(;i<len;++i){me.processBinding(bindings[i],event)}me.processing=false}}}(),processEvent:Ext.identityFn,processBinding:function(binding,event){if(this.checkModifiers(binding,event)){var key=event.getKey(),handler=binding.fn||binding.handler,scope=binding.scope||this,keyCode=binding.keyCode,defaultEventAction=binding.defaultEventAction,i,len,keydownEvent=new Ext.EventObjectImpl(event);for(i=0,len=keyCode.length;i<len;++i){if(key===keyCode[i]){if(handler.call(scope,key,event)!==true&&defaultEventAction){keydownEvent[defaultEventAction]()}break}}}},checkModifiers:function(binding,e){var keys=["shift","ctrl","alt"],i=0,len=keys.length,val,key;for(;i<len;++i){key=keys[i];val=binding[key];if(!(val===undefined||val===e[key+"Key"])){return false}}return true},on:function(key,fn,scope){var keyCode,shift,ctrl,alt;if(Ext.isObject(key)&&!Ext.isArray(key)){keyCode=key.key;shift=key.shift;ctrl=key.ctrl;alt=key.alt}else{keyCode=key}this.addBinding({key:keyCode,shift:shift,ctrl:ctrl,alt:alt,fn:fn,scope:scope})},un:function(key,fn,scope){var keyCode,shift,ctrl,alt;if(Ext.isObject(key)&&!Ext.isArray(key)){keyCode=key.key;shift=key.shift;ctrl=key.ctrl;alt=key.alt}else{keyCode=key}this.removeBinding({key:keyCode,shift:shift,ctrl:ctrl,alt:alt,fn:fn,scope:scope})},isEnabled:function(){return this.enabled},enable:function(){var me=this;if(!me.enabled){me.target.on(me.eventName,me.handleTargetEvent,me);me.enabled=true}},disable:function(){var me=this;if(me.enabled){me.target.removeListener(me.eventName,me.handleTargetEvent,me);me.enabled=false}},setDisabled:function(disabled){if(disabled){this.disable()}else{this.enable()}},destroy:function(removeTarget){var me=this,target=me.target;me.bindings=[];me.disable();if(removeTarget===true){if(target.isComponent){target.destroy()}else{target.remove()}}delete me.target}});