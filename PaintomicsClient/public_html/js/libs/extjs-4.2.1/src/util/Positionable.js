Ext.define("Ext.util.Positionable",{_positionTopLeft:["position","top","left"],_alignRe:/^([a-z]+)-([a-z]+)(\?)?$/,afterSetPosition:Ext.emptyFn,getAnchorToXY:function(){Ext.Error.raise("getAnchorToXY is not implemented in "+this.$className)},getBorderPadding:function(){Ext.Error.raise("getBorderPadding is not implemented in "+this.$className)},getLocalX:function(){Ext.Error.raise("getLocalX is not implemented in "+this.$className)},getLocalXY:function(){Ext.Error.raise("getLocalXY is not implemented in "+this.$className)},getLocalY:function(){Ext.Error.raise("getLocalY is not implemented in "+this.$className)},getX:function(){Ext.Error.raise("getX is not implemented in "+this.$className)},getXY:function(){Ext.Error.raise("getXY is not implemented in "+this.$className)},getY:function(){Ext.Error.raise("getY is not implemented in "+this.$className)},setLocalX:function(){Ext.Error.raise("setLocalX is not implemented in "+this.$className)},setLocalXY:function(){Ext.Error.raise("setLocalXY is not implemented in "+this.$className)},setLocalY:function(){Ext.Error.raise("setLocalY is not implemented in "+this.$className)},setX:function(){Ext.Error.raise("setX is not implemented in "+this.$className)},setXY:function(){Ext.Error.raise("setXY is not implemented in "+this.$className)},setY:function(){Ext.Error.raise("setY is not implemented in "+this.$className)},adjustForConstraints:function(xy,parent){var vector=this.getConstrainVector(parent,xy);if(vector){xy[0]+=vector[0];xy[1]+=vector[1]}return xy},alignTo:function(element,position,offsets,animate){var me=this,el=me.el;return me.setXY(me.getAlignToXY(element,position,offsets),el.anim&&!!animate?el.anim(animate):false)},anchorTo:function(anchorToEl,alignment,offsets,animate,monitorScroll,callback){var me=this,scroll=!Ext.isEmpty(monitorScroll),action=function(){me.alignTo(anchorToEl,alignment,offsets,animate);Ext.callback(callback,me)},anchor=me.getAnchor();me.removeAnchor();Ext.apply(anchor,{fn:action,scroll:scroll});Ext.EventManager.onWindowResize(action,null);if(scroll){Ext.EventManager.on(window,"scroll",action,null,{buffer:!isNaN(monitorScroll)?monitorScroll:50})}action();return me},calculateAnchorXY:function(anchor,extraX,extraY,mySize){var me=this,el=me.el,doc=document,isViewport=el.dom==doc.body||el.dom==doc,round=Math.round,xy,myWidth,myHeight;anchor=(anchor||"tl").toLowerCase();mySize=mySize||{};myWidth=mySize.width||isViewport?Ext.Element.getViewWidth():me.getWidth();myHeight=mySize.height||isViewport?Ext.Element.getViewHeight():me.getHeight();switch(anchor){case"tl":xy=[0,0];break;case"bl":xy=[0,myHeight];break;case"tr":xy=[myWidth,0];break;case"c":xy=[round(myWidth*.5),round(myHeight*.5)];break;case"t":xy=[round(myWidth*.5),0];break;case"l":xy=[0,round(myHeight*.5)];break;case"r":xy=[myWidth,round(myHeight*.5)];break;case"b":xy=[round(myWidth*.5),myHeight];break;case"tc":xy=[round(myWidth*.5),0];break;case"bc":xy=[round(myWidth*.5),myHeight];break;case"br":xy=[myWidth,myHeight]}return[xy[0]+extraX,xy[1]+extraY]},convertPositionSpec:Ext.identityFn,getAlignToXY:function(alignToEl,posSpec,offset){var me=this,viewportWidth=Ext.Element.getViewWidth()-10,viewportHeight=Ext.Element.getViewHeight()-10,doc=document,docElement=doc.documentElement,docBody=doc.body,scrollX=docElement.scrollLeft||docBody.scrollLeft||0,scrollY=docElement.scrollTop||docBody.scrollTop||0,alignMatch,myPosition,alignToElPosition,myWidth,myHeight,alignToElRegion,swapY,swapX,constrain,align1,align2,p1y,p1x,p2y,p2x,x,y;alignToEl=Ext.get(alignToEl.el||alignToEl);if(!alignToEl||!alignToEl.dom){Ext.Error.raise({sourceClass:"Ext.util.Positionable",sourceMethod:"getAlignToXY",msg:"Attempted to align an element that doesn't exist"})}offset=offset||[0,0];posSpec=(!posSpec||posSpec=="?"?"tl-bl?":!/-/.test(posSpec)&&posSpec!==""?"tl-"+posSpec:posSpec||"tl-bl").toLowerCase();posSpec=me.convertPositionSpec(posSpec);alignMatch=posSpec.match(me._alignRe);if(!alignMatch){Ext.Error.raise({sourceClass:"Ext.util.Positionable",sourceMethod:"getAlignToXY",el:alignToEl,position:posSpec,offset:offset,msg:'Attemmpted to align an element with an invalid position: "'+posSpec+'"'})}align1=alignMatch[1];align2=alignMatch[2];constrain=!!alignMatch[3];myPosition=me.getAnchorXY(align1,true);alignToElPosition=me.getAnchorToXY(alignToEl,align2,false);x=alignToElPosition[0]-myPosition[0]+offset[0];y=alignToElPosition[1]-myPosition[1]+offset[1];if(constrain){myWidth=me.getWidth();myHeight=me.getHeight();alignToElRegion=alignToEl.getRegion();p1y=align1.charAt(0);p1x=align1.charAt(align1.length-1);p2y=align2.charAt(0);p2x=align2.charAt(align2.length-1);swapY=p1y=="t"&&p2y=="b"||p1y=="b"&&p2y=="t";swapX=p1x=="r"&&p2x=="l"||p1x=="l"&&p2x=="r";if(x+myWidth>viewportWidth+scrollX){x=swapX?alignToElRegion.left-myWidth:viewportWidth+scrollX-myWidth}if(x<scrollX){x=swapX?alignToElRegion.right:scrollX}if(y+myHeight>viewportHeight+scrollY){y=swapY?alignToElRegion.top-myHeight:viewportHeight+scrollY-myHeight}if(y<scrollY){y=swapY?alignToElRegion.bottom:scrollY}}return[x,y]},getAnchor:function(){var el=this.el,data=(el.$cache||el.getCache()).data,anchor;if(!el.dom){return}anchor=data._anchor;if(!anchor){anchor=data._anchor={}}return anchor},getAnchorXY:function(anchor,local,mySize){var me=this,myPos=me.getXY(),el=me.el,doc=document,isViewport=el.dom==doc.body||el.dom==doc,scroll=el.getScroll(),extraX=isViewport?scroll.left:local?0:myPos[0],extraY=isViewport?scroll.top:local?0:myPos[1];return me.calculateAnchorXY(anchor,extraX,extraY,mySize)},getBox:function(contentBox,local){var me=this,xy=local?me.getLocalXY():me.getXY(),x=xy[0],y=xy[1],w=me.getWidth(),h=me.getHeight(),borderPadding,beforeX,beforeY;if(contentBox){borderPadding=me.getBorderPadding();beforeX=borderPadding.beforeX;beforeY=borderPadding.beforeY;x+=beforeX;y+=beforeY;w-=beforeX+borderPadding.afterX;h-=beforeY+borderPadding.afterY}return{x:x,left:x,0:x,y:y,top:y,1:y,width:w,height:h,right:x+w,bottom:y+h}},calculateConstrainedPosition:function(constrainTo,proposedPosition,local,proposedSize){var me=this,vector,fp=me.floatParent,parentNode=fp?fp.getTargetEl():null,parentOffset,borderPadding,proposedConstrainPosition,xy=false;if(local&&fp){parentOffset=parentNode.getXY();borderPadding=parentNode.getBorderPadding();parentOffset[0]+=borderPadding.beforeX;parentOffset[1]+=borderPadding.beforeY;if(proposedPosition){proposedConstrainPosition=[proposedPosition[0]+parentOffset[0],proposedPosition[1]+parentOffset[1]]}}else{proposedConstrainPosition=proposedPosition}constrainTo=constrainTo||me.constrainTo||parentNode||me.container||me.el.parent();vector=(me.constrainHeader?me.header:me).getConstrainVector(constrainTo,proposedConstrainPosition,proposedSize);if(vector){xy=proposedPosition||me.getPosition(local);xy[0]+=vector[0];xy[1]+=vector[1]}return xy},getConstrainVector:function(constrainTo,proposedPosition,proposedSize){var thisRegion=this.getRegion(),vector=[0,0],shadowSize=this.shadow&&this.constrainShadow&&!this.shadowDisabled?this.shadow.getShadowSize():undefined,overflowed=false,constraintInsets=this.constraintInsets;if(!(constrainTo instanceof Ext.util.Region)){constrainTo=Ext.get(constrainTo.el||constrainTo).getViewRegion()}if(constraintInsets){constraintInsets=Ext.isObject(constraintInsets)?constraintInsets:Ext.Element.parseBox(constraintInsets);constrainTo.adjust(constraintInsets.top,constraintInsets.right,constraintInsets.bottom,constraintInsets.length)}if(proposedPosition){thisRegion.translateBy(proposedPosition[0]-thisRegion.x,proposedPosition[1]-thisRegion.y)}if(proposedSize){thisRegion.right=thisRegion.left+proposedSize[0];thisRegion.bottom=thisRegion.top+proposedSize[1]}if(shadowSize){constrainTo.adjust(shadowSize[0],-shadowSize[1],-shadowSize[2],shadowSize[3])}if(thisRegion.right>constrainTo.right){overflowed=true;vector[0]=constrainTo.right-thisRegion.right}if(thisRegion.left+vector[0]<constrainTo.left){overflowed=true;vector[0]=constrainTo.left-thisRegion.left}if(thisRegion.bottom>constrainTo.bottom){overflowed=true;vector[1]=constrainTo.bottom-thisRegion.bottom}if(thisRegion.top+vector[1]<constrainTo.top){overflowed=true;vector[1]=constrainTo.top-thisRegion.top}return overflowed?vector:false},getOffsetsTo:function(offsetsTo){var o=this.getXY(),e=Ext.fly(offsetsTo.el||offsetsTo,"_internal").getXY();return[o[0]-e[0],o[1]-e[1]]},getRegion:function(){var box=this.getBox();return new Ext.util.Region(box.top,box.right,box.bottom,box.left)},getViewRegion:function(){var me=this,el=me.el,isBody=el.dom.nodeName==="BODY",borderPadding,scroll,pos,top,left,width,height;if(isBody){scroll=el.getScroll();left=scroll.left;top=scroll.top;width=Ext.dom.AbstractElement.getViewportWidth();height=Ext.dom.AbstractElement.getViewportHeight()}else{borderPadding=me.getBorderPadding();pos=me.getXY();left=pos[0]+borderPadding.beforeX;top=pos[1]+borderPadding.beforeY;width=me.getWidth(true);height=me.getHeight(true)}return new Ext.util.Region(top,left+width,top+height,left)},move:function(direction,distance,animate){var me=this,xy=me.getXY(),x=xy[0],y=xy[1],left=[x-distance,y],right=[x+distance,y],top=[x,y-distance],bottom=[x,y+distance],hash={l:left,left:left,r:right,right:right,t:top,top:top,up:top,b:bottom,bottom:bottom,down:bottom};direction=direction.toLowerCase();me.setXY([hash[direction][0],hash[direction][1]],animate)},removeAnchor:function(){var anchor=this.getAnchor();if(anchor&&anchor.fn){Ext.EventManager.removeResizeListener(anchor.fn);if(anchor.scroll){Ext.EventManager.un(window,"scroll",anchor.fn)}delete anchor.fn}return this},setBox:function(box,animate){var me=this,el=me.el,x=box.x,y=box.y,xy=[x,y],w=box.width,h=box.height,doConstrain=me.constrain||me.constrainHeader,constrainedPos=doConstrain&&me.calculateConstrainedPosition(null,[x,y],false,[w,h]);if(constrainedPos){x=constrainedPos[0];y=constrainedPos[1]}if(!animate||!el.anim){me.setSize(w,h);me.setXY([x,y]);me.afterSetPosition(x,y)}else{me.animate(Ext.applyIf({to:{x:x,y:y,width:el.adjustWidth(w),height:el.adjustHeight(h)},listeners:{afteranimate:Ext.Function.bind(me.afterSetPosition,me,[x,y])}},animate))}return me},setRegion:function(region,animate){return this.setBox({x:region.left,y:region.top,width:region.right-region.left,height:region.bottom-region.top},animate)},translatePoints:function(x,y){var pos=this.translateXY(x,y);return{left:pos.x,top:pos.y}},translateXY:function(x,y){var me=this,el=me.el,styles=el.getStyle(me._positionTopLeft),relative=styles.position=="relative",left=parseFloat(styles.left),top=parseFloat(styles.top),xy=me.getXY();if(Ext.isArray(x)){y=x[1];x=x[0]}if(isNaN(left)){left=relative?0:el.dom.offsetLeft}if(isNaN(top)){top=relative?0:el.dom.offsetTop}left=typeof x=="number"?x-xy[0]+left:undefined;top=typeof y=="number"?y-xy[1]+top:undefined;return{x:left,y:top}}});