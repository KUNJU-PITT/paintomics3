Ext.define("Ext.tip.ToolTip",{extend:"Ext.tip.Tip",alias:"widget.tooltip",alternateClassName:"Ext.ToolTip",autoHide:true,showDelay:500,hideDelay:200,dismissDelay:5e3,trackMouse:false,anchorToTarget:true,anchorOffset:0,targetCounter:0,quickShowInterval:250,initComponent:function(){var me=this;me.callParent(arguments);me.lastActive=new Date;me.setTarget(me.target);me.origAnchor=me.anchor},onRender:function(ct,position){var me=this;me.callParent(arguments);me.anchorCls=Ext.baseCSSPrefix+"tip-anchor-"+me.getAnchorPosition();me.anchorEl=me.el.createChild({cls:Ext.baseCSSPrefix+"tip-anchor "+me.anchorCls})},setTarget:function(target){var me=this,t=Ext.get(target),tg;if(me.target){tg=Ext.get(me.target);me.mun(tg,"mouseover",me.onTargetOver,me);me.mun(tg,"mouseout",me.onTargetOut,me);me.mun(tg,"mousemove",me.onMouseMove,me)}me.target=t;if(t){me.mon(t,{freezeEvent:true,mouseover:me.onTargetOver,mouseout:me.onTargetOut,mousemove:me.onMouseMove,scope:me})}if(me.anchor){me.anchorTarget=me.target}},onMouseMove:function(e){var me=this,t=me.delegate?e.getTarget(me.delegate):me.triggerElement=true,xy;if(t){me.targetXY=e.getXY();if(t===me.triggerElement){if(!me.hidden&&me.trackMouse){xy=me.getTargetXY();if(me.constrainPosition){xy=me.el.adjustForConstraints(xy,me.el.parent())}me.setPagePosition(xy)}}else{me.hide();me.lastActive=new Date(0);me.onTargetOver(e)}}else if(!me.closable&&me.isVisible()&&me.autoHide!==false){me.hide()}},getTargetXY:function(){var me=this,mouseOffset,offsets,xy,dw,dh,de,bd,scrollX,scrollY,axy,sz,constrainPosition;if(me.delegate){me.anchorTarget=me.triggerElement}if(me.anchor){me.targetCounter++;offsets=me.getOffsets();xy=me.anchorToTarget&&!me.trackMouse?me.getAlignToXY(me.anchorTarget,me.getAnchorAlign()):me.targetXY;dw=Ext.Element.getViewWidth()-5;dh=Ext.Element.getViewHeight()-5;de=document.documentElement;bd=document.body;scrollX=(de.scrollLeft||bd.scrollLeft||0)+5;scrollY=(de.scrollTop||bd.scrollTop||0)+5;axy=[xy[0]+offsets[0],xy[1]+offsets[1]];sz=me.getSize();constrainPosition=me.constrainPosition;me.anchorEl.removeCls(me.anchorCls);if(me.targetCounter<2&&constrainPosition){if(axy[0]<scrollX){if(me.anchorToTarget){me.defaultAlign="l-r";if(me.mouseOffset){me.mouseOffset[0]*=-1}}me.anchor="left";return me.getTargetXY()}if(axy[0]+sz.width>dw){if(me.anchorToTarget){me.defaultAlign="r-l";if(me.mouseOffset){me.mouseOffset[0]*=-1}}me.anchor="right";return me.getTargetXY()}if(axy[1]<scrollY){if(me.anchorToTarget){me.defaultAlign="t-b";if(me.mouseOffset){me.mouseOffset[1]*=-1}}me.anchor="top";return me.getTargetXY()}if(axy[1]+sz.height>dh){if(me.anchorToTarget){me.defaultAlign="b-t";if(me.mouseOffset){me.mouseOffset[1]*=-1}}me.anchor="bottom";return me.getTargetXY()}}me.anchorCls=Ext.baseCSSPrefix+"tip-anchor-"+me.getAnchorPosition();me.anchorEl.addCls(me.anchorCls);me.targetCounter=0;return axy}else{mouseOffset=me.getMouseOffset();return me.targetXY?[me.targetXY[0]+mouseOffset[0],me.targetXY[1]+mouseOffset[1]]:mouseOffset}},getMouseOffset:function(){var me=this,offset=me.anchor?[0,0]:[15,18];if(me.mouseOffset){offset[0]+=me.mouseOffset[0];offset[1]+=me.mouseOffset[1]}return offset},getAnchorPosition:function(){var me=this,m;if(me.anchor){me.tipAnchor=me.anchor.charAt(0)}else{m=me.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){Ext.Error.raise('The AnchorTip.defaultAlign value "'+me.defaultAlign+'" is invalid.')}me.tipAnchor=m[1].charAt(0)}switch(me.tipAnchor){case"t":return"top";case"b":return"bottom";case"r":return"right"}return"left"},getAnchorAlign:function(){switch(this.anchor){case"top":return"tl-bl";case"left":return"tl-tr";case"right":return"tr-tl";default:return"bl-tl"}},getOffsets:function(){var me=this,mouseOffset,offsets,ap=me.getAnchorPosition().charAt(0);if(me.anchorToTarget&&!me.trackMouse){switch(ap){case"t":offsets=[0,9];break;case"b":offsets=[0,-13];break;case"r":offsets=[-13,0];break;default:offsets=[9,0];break}}else{switch(ap){case"t":offsets=[-15-me.anchorOffset,30];break;case"b":offsets=[-19-me.anchorOffset,-13-me.el.dom.offsetHeight];break;case"r":offsets=[-15-me.el.dom.offsetWidth,-13-me.anchorOffset];break;default:offsets=[25,-13-me.anchorOffset];break}}mouseOffset=me.getMouseOffset();offsets[0]+=mouseOffset[0];offsets[1]+=mouseOffset[1];return offsets},onTargetOver:function(e){var me=this,delegate=me.delegate,t;if(me.disabled||e.within(me.target.dom,true)){return}t=delegate?e.getTarget(delegate):true;if(t){me.triggerElement=t;me.triggerEvent=e;me.clearTimer("hide");me.targetXY=e.getXY();me.delayShow()}},delayShow:function(){var me=this;if(me.hidden&&!me.showTimer){if(Ext.Date.getElapsed(me.lastActive)<me.quickShowInterval){me.show()}else{me.showTimer=Ext.defer(me.showFromDelay,me.showDelay,me)}}else if(!me.hidden&&me.autoHide!==false){me.show()}},showFromDelay:function(){this.fromDelayShow=true;this.show();delete this.fromDelayShow},onShowVeto:function(){this.callParent();delete this.triggerElement;this.clearTimer("show")},onTargetOut:function(e){var me=this,triggerEl=me.triggerElement,target=triggerEl===true?me.target:triggerEl;if(me.disabled||!triggerEl||e.within(target,true)){return}if(me.showTimer){me.clearTimer("show");me.triggerElement=null}if(me.autoHide!==false){me.delayHide()}},delayHide:function(){var me=this;if(!me.hidden&&!me.hideTimer){me.hideTimer=Ext.defer(me.hide,me.hideDelay,me)}},hide:function(){var me=this;me.clearTimer("dismiss");me.lastActive=new Date;if(me.anchorEl){me.anchorEl.hide()}me.callParent(arguments);delete me.triggerElement},show:function(){var me=this;this.callParent();if(this.hidden===false){me.setPagePosition(-1e4,-1e4);if(me.anchor){me.anchor=me.origAnchor}if(!me.calledFromShowAt){me.showAt(me.getTargetXY())}if(me.anchor){me.syncAnchor();me.anchorEl.show()}else{me.anchorEl.hide()}}},showAt:function(xy){var me=this;me.lastActive=new Date;me.clearTimers();me.calledFromShowAt=true;if(!me.isVisible()){this.callParent(arguments)}if(me.isVisible()){me.setPagePosition(xy[0],xy[1]);if(me.constrainPosition||me.constrain){me.doConstrain()}me.toFront(true);me.el.sync(true);if(me.dismissDelay&&me.autoHide!==false){me.dismissTimer=Ext.defer(me.hide,me.dismissDelay,me)}if(me.anchor){me.syncAnchor();if(!me.anchorEl.isVisible()){me.anchorEl.show()}}else{me.anchorEl.hide()}}delete me.calledFromShowAt},syncAnchor:function(){var me=this,anchorPos,targetPos,offset;switch(me.tipAnchor.charAt(0)){case"t":anchorPos="b";targetPos="tl";offset=[20+me.anchorOffset,1];break;case"r":anchorPos="l";targetPos="tr";offset=[-1,12+me.anchorOffset];break;case"b":anchorPos="t";targetPos="bl";offset=[20+me.anchorOffset,-1];break;default:anchorPos="r";targetPos="tl";offset=[1,12+me.anchorOffset];break}me.anchorEl.alignTo(me.el,anchorPos+"-"+targetPos,offset);me.anchorEl.setStyle("z-index",parseInt(me.el.getZIndex(),10)||0+1).setVisibilityMode(Ext.Element.DISPLAY)},setPagePosition:function(x,y){var me=this;me.callParent(arguments);if(me.anchor){me.syncAnchor()}},_timerNames:{},clearTimer:function(name){var me=this,names=me._timerNames,propName=names[name]||(names[name]=name+"Timer"),timer=me[propName];if(timer){clearTimeout(timer);me[propName]=null}},clearTimers:function(){var me=this;me.clearTimer("show");me.clearTimer("dismiss");me.clearTimer("hide")},onShow:function(){var me=this;me.callParent();me.mon(Ext.getDoc(),"mousedown",me.onDocMouseDown,me)},onHide:function(){var me=this;me.callParent();me.mun(Ext.getDoc(),"mousedown",me.onDocMouseDown,me)},onDocMouseDown:function(e){var me=this;if(!me.closable&&!e.within(me.el.dom)){me.disable();Ext.defer(me.doEnable,100,me)}},doEnable:function(){if(!this.isDestroyed){this.enable()}},onDisable:function(){this.callParent();this.clearTimers();this.hide()},beforeDestroy:function(){var me=this;me.clearTimers();Ext.destroy(me.anchorEl);delete me.anchorEl;delete me.target;delete me.anchorTarget;delete me.triggerElement;me.callParent()},onDestroy:function(){Ext.getDoc().un("mousedown",this.onDocMouseDown,this);this.callParent()}});