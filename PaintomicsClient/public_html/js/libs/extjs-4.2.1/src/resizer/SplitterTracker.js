Ext.define("Ext.resizer.SplitterTracker",{extend:"Ext.dd.DragTracker",requires:["Ext.util.Region"],enabled:true,overlayCls:Ext.baseCSSPrefix+"resizable-overlay",createDragOverlay:function(){var overlay;overlay=this.overlay=Ext.getBody().createChild({cls:this.overlayCls,html:"&#160;"});overlay.unselectable();overlay.setSize(Ext.Element.getViewWidth(true),Ext.Element.getViewHeight(true));overlay.show()},getPrevCmp:function(){var splitter=this.getSplitter();return splitter.previousSibling(":not([hidden])")},getNextCmp:function(){var splitter=this.getSplitter();return splitter.nextSibling(":not([hidden])")},onBeforeStart:function(e){var me=this,prevCmp=me.getPrevCmp(),nextCmp=me.getNextCmp(),collapseEl=me.getSplitter().collapseEl,target=e.getTarget(),box;if(!prevCmp||!nextCmp){return false}if(collapseEl&&target===me.getSplitter().collapseEl.dom){return false}if(nextCmp.collapsed||prevCmp.collapsed){return false}me.prevBox=prevCmp.getEl().getBox();me.nextBox=nextCmp.getEl().getBox();me.constrainTo=box=me.calculateConstrainRegion();if(!box){return false}return box},onStart:function(e){var splitter=this.getSplitter();this.createDragOverlay();splitter.addCls(splitter.baseCls+"-active")},calculateConstrainRegion:function(){var me=this,splitter=me.getSplitter(),splitWidth=splitter.getWidth(),defaultMin=splitter.defaultSplitMin,orient=splitter.orientation,prevBox=me.prevBox,prevCmp=me.getPrevCmp(),nextBox=me.nextBox,nextCmp=me.getNextCmp(),prevConstrainRegion,nextConstrainRegion,constrainOptions;if(orient==="vertical"){constrainOptions={prevCmp:prevCmp,nextCmp:nextCmp,prevBox:prevBox,nextBox:nextBox,defaultMin:defaultMin,splitWidth:splitWidth};prevConstrainRegion=new Ext.util.Region(prevBox.y,me.getVertPrevConstrainRight(constrainOptions),prevBox.bottom,me.getVertPrevConstrainLeft(constrainOptions));nextConstrainRegion=new Ext.util.Region(nextBox.y,me.getVertNextConstrainRight(constrainOptions),nextBox.bottom,me.getVertNextConstrainLeft(constrainOptions))}else{prevConstrainRegion=new Ext.util.Region(prevBox.y+(prevCmp.minHeight||defaultMin),prevBox.right,(prevCmp.maxHeight?prevBox.y+prevCmp.maxHeight:nextBox.bottom-(nextCmp.minHeight||defaultMin))+splitWidth,prevBox.x);nextConstrainRegion=new Ext.util.Region((nextCmp.maxHeight?nextBox.bottom-nextCmp.maxHeight:prevBox.y+(prevCmp.minHeight||defaultMin))-splitWidth,nextBox.right,nextBox.bottom-(nextCmp.minHeight||defaultMin),nextBox.x)}return prevConstrainRegion.intersect(nextConstrainRegion)},performResize:function(e,offset){var me=this,splitter=me.getSplitter(),orient=splitter.orientation,prevCmp=me.getPrevCmp(),nextCmp=me.getNextCmp(),owner=splitter.ownerCt,flexedSiblings=owner.query(">[flex]"),len=flexedSiblings.length,vertical=orient==="vertical",i=0,dimension=vertical?"width":"height",totalFlex=0,item,size;for(;i<len;i++){item=flexedSiblings[i];size=vertical?item.getWidth():item.getHeight();totalFlex+=size;item.flex=size}offset=vertical?offset[0]:offset[1];if(prevCmp){size=me.prevBox[dimension]+offset;if(prevCmp.flex){prevCmp.flex=size}else{prevCmp[dimension]=size}}if(nextCmp){size=me.nextBox[dimension]-offset;if(nextCmp.flex){nextCmp.flex=size}else{nextCmp[dimension]=size}}owner.updateLayout()},endDrag:function(){var me=this;if(me.overlay){me.overlay.remove();delete me.overlay}me.callParent(arguments)},onEnd:function(e){var me=this,splitter=me.getSplitter();splitter.removeCls(splitter.baseCls+"-active");me.performResize(e,me.getResizeOffset())},onDrag:function(e){var me=this,offset=me.getOffset("dragTarget"),splitter=me.getSplitter(),splitEl=splitter.getEl(),orient=splitter.orientation;if(orient==="vertical"){splitEl.setX(me.startRegion.left+offset[0])}else{splitEl.setY(me.startRegion.top+offset[1])}},getSplitter:function(){return this.splitter},getVertPrevConstrainRight:function(o){return(o.prevCmp.maxWidth?o.prevBox.x+o.prevCmp.maxWidth:o.nextBox.right-(o.nextCmp.minWidth||o.defaultMin))+o.splitWidth},getVertPrevConstrainLeft:function(o){return o.prevBox.x+(o.prevCmp.minWidth||o.defaultMin)},getVertNextConstrainRight:function(o){return o.nextBox.right-(o.nextCmp.minWidth||o.defaultMin)},getVertNextConstrainLeft:function(o){return(o.nextCmp.maxWidth?o.nextBox.right-o.nextCmp.maxWidth:o.prevBox.x+(o.prevBox.minWidth||o.defaultMin))-o.splitWidth},getResizeOffset:function(){return this.getOffset("dragTarget")}});