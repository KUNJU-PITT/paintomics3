Ext.define("Ext.layout.container.Box",{alias:["layout.box"],extend:"Ext.layout.container.Container",alternateClassName:"Ext.layout.BoxLayout",requires:["Ext.layout.container.boxOverflow.None","Ext.layout.container.boxOverflow.Menu","Ext.layout.container.boxOverflow.Scroller","Ext.util.Format","Ext.dd.DragDropManager"],defaultMargins:{top:0,right:0,bottom:0,left:0},padding:0,pack:"start",flex:undefined,stretchMaxPartner:undefined,alignRoundingMethod:"round",type:"box",scrollOffset:0,itemCls:Ext.baseCSSPrefix+"box-item",targetCls:Ext.baseCSSPrefix+"box-layout-ct",targetElCls:Ext.baseCSSPrefix+"box-target",innerCls:Ext.baseCSSPrefix+"box-inner",availableSpaceOffset:0,reserveOffset:true,manageMargins:true,createsInnerCt:true,childEls:["innerCt","targetEl"],renderTpl:["{%var oc,l=values.$comp.layout,oh=l.overflowHandler;","if (oh.getPrefixConfig!==Ext.emptyFn) {","if(oc=oh.getPrefixConfig())dh.generateMarkup(oc, out)","}%}",'<div id="{ownerId}-innerCt" class="{[l.innerCls]} {[oh.getOverflowCls()]}" role="presentation">','<div id="{ownerId}-targetEl" class="{targetElCls}">',"{%this.renderBody(out, values)%}","</div>","</div>","{%if (oh.getSuffixConfig!==Ext.emptyFn) {","if(oc=oh.getSuffixConfig())dh.generateMarkup(oc, out)","}%}",{disableFormats:true,definitions:"var dh=Ext.DomHelper;"}],constructor:function(config){var me=this,type;me.callParent(arguments);me.flexSortFn=Ext.Function.bind(me.flexSort,me);me.initOverflowHandler();type=typeof me.padding;if(type=="string"||type=="number"){me.padding=Ext.util.Format.parseBox(me.padding);me.padding.height=me.padding.top+me.padding.bottom;me.padding.width=me.padding.left+me.padding.right}},_percentageRe:/^\s*(\d+(?:\.\d*)?)\s*[%]\s*$/,getItemSizePolicy:function(item,ownerSizeModel){var me=this,policy=me.sizePolicy,align=me.align,flex=item.flex,key=align,names=me.names,width=item[names.width],height=item[names.height],percentageRe=me._percentageRe,percentageWidth=percentageRe.test(width),isStretch=align=="stretch",isStretchMax=align=="stretchmax",constrain=me.constrainAlign;if(!ownerSizeModel&&(isStretch||flex||percentageWidth||constrain&&!isStretchMax)){ownerSizeModel=me.owner.getSizeModel()}if(isStretch){if(!percentageRe.test(height)&&ownerSizeModel[names.height].shrinkWrap){key="stretchmax"}}else if(!isStretchMax){if(percentageRe.test(height)){key="stretch"}else if(constrain&&!ownerSizeModel[names.height].shrinkWrap){key="stretchmax"}else{key=""}}if(flex||percentageWidth){if(!ownerSizeModel[names.width].shrinkWrap){policy=policy.flex}}return policy[key]},flexSort:function(a,b){var maxWidthName=this.names.maxWidth,minWidthName=this.names.minWidth,infiniteValue=Infinity,aTarget=a.target,bTarget=b.target,result=0,aMin,bMin,aMax,bMax,hasMin,hasMax;aMax=aTarget[maxWidthName]||infiniteValue;bMax=bTarget[maxWidthName]||infiniteValue;aMin=aTarget[minWidthName]||0;bMin=bTarget[minWidthName]||0;hasMin=isFinite(aMin)||isFinite(bMin);hasMax=isFinite(aMax)||isFinite(bMax);if(hasMin||hasMax){if(hasMax){result=aMax-bMax}if(result===0&&hasMin){result=bMin-aMin}}return result},isItemBoxParent:function(itemContext){return true},isItemShrinkWrap:function(item){return true},roundFlex:function(width){return Math.ceil(width)},beginCollapse:function(child){var me=this;if(me.direction==="vertical"&&child.collapsedVertical()){child.collapseMemento.capture(["flex"]);delete child.flex}else if(me.direction==="horizontal"&&child.collapsedHorizontal()){child.collapseMemento.capture(["flex"]);delete child.flex}},beginExpand:function(child){child.collapseMemento.restore(["flex"])},beginLayout:function(ownerContext){var me=this,owner=me.owner,smp=owner.stretchMaxPartner,style=me.innerCt.dom.style,names=me.names;ownerContext.boxNames=names;me.overflowHandler.beginLayout(ownerContext);if(typeof smp==="string"){smp=Ext.getCmp(smp)||owner.query(smp)[0]}ownerContext.stretchMaxPartner=smp&&ownerContext.context.getCmp(smp);me.callParent(arguments);ownerContext.innerCtContext=ownerContext.getEl("innerCt",me);me.scrollParallel=owner.scrollFlags[names.x];me.scrollPerpendicular=owner.scrollFlags[names.y];if(me.scrollParallel){me.scrollPos=owner.getTargetEl().dom[names.scrollLeft]}style.width="";style.height=""},beginLayoutCycle:function(ownerContext,firstCycle){var me=this,align=me.align,names=ownerContext.boxNames,pack=me.pack,heightModelName=names.heightModel;me.overflowHandler.beginLayoutCycle(ownerContext,firstCycle);me.callParent(arguments);ownerContext.parallelSizeModel=ownerContext[names.widthModel];ownerContext.perpendicularSizeModel=ownerContext[heightModelName];ownerContext.boxOptions={align:align={stretch:align=="stretch",stretchmax:align=="stretchmax",center:align==names.center,bottom:align==names.afterY},pack:pack={center:pack=="center",end:pack=="end"}};if(align.stretch&&ownerContext.perpendicularSizeModel.shrinkWrap){align.stretchmax=true;align.stretch=false}align.nostretch=!(align.stretch||align.stretchmax);if(ownerContext.parallelSizeModel.shrinkWrap){pack.center=pack.end=false}me.cacheFlexes(ownerContext);me.targetEl.setWidth(2e4)},cacheFlexes:function(ownerContext){var me=this,names=ownerContext.boxNames,widthModelName=names.widthModel,heightModelName=names.heightModel,nostretch=ownerContext.boxOptions.align.nostretch,totalFlex=0,childItems=ownerContext.childItems,i=childItems.length,flexedItems=[],minWidth=0,minWidthName=names.minWidth,percentageRe=me._percentageRe,percentageWidths=0,percentageHeights=0,child,childContext,flex,match;while(i--){childContext=childItems[i];child=childContext.target;if(childContext[widthModelName].calculated){childContext.flex=flex=child.flex;if(flex){totalFlex+=flex;flexedItems.push(childContext);minWidth+=child[minWidthName]||0}else{match=percentageRe.exec(child[names.width]);childContext.percentageParallel=parseFloat(match[1])/100;++percentageWidths}}if(nostretch&&childContext[heightModelName].calculated){match=percentageRe.exec(child[names.height]);childContext.percentagePerpendicular=parseFloat(match[1])/100;++percentageHeights}}ownerContext.flexedItems=flexedItems;ownerContext.flexedMinSize=minWidth;ownerContext.totalFlex=totalFlex;ownerContext.percentageWidths=percentageWidths;ownerContext.percentageHeights=percentageHeights;Ext.Array.sort(flexedItems,me.flexSortFn)},calculate:function(ownerContext){var me=this,targetSize=me.getContainerSize(ownerContext),names=ownerContext.boxNames,state=ownerContext.state,plan=state.boxPlan||(state.boxPlan={}),targetContext=ownerContext.targetContext;plan.targetSize=targetSize;if(!ownerContext.parallelSizeModel.shrinkWrap&&!targetSize[names.gotWidth]){me.done=false;return}if(!state.parallelDone){state.parallelDone=me.calculateParallel(ownerContext,names,plan)}if(!state.perpendicularDone){state.perpendicularDone=me.calculatePerpendicular(ownerContext,names,plan)}if(state.parallelDone&&state.perpendicularDone){if(me.owner.dock&&(Ext.isIE7m||Ext.isIEQuirks)&&!me.owner.width&&!me.horizontal){plan.isIEVerticalDock=true;plan.calculatedWidth=plan.maxSize+ownerContext.getPaddingInfo().width+ownerContext.getFrameInfo().width;if(targetContext!==ownerContext){plan.calculatedWidth+=targetContext.getPaddingInfo().width}}me.publishInnerCtSize(ownerContext,me.reserveOffset?me.availableSpaceOffset:0);if(me.done&&(ownerContext.childItems.length>1||ownerContext.stretchMaxPartner)&&ownerContext.boxOptions.align.stretchmax&&!state.stretchMaxDone){me.calculateStretchMax(ownerContext,names,plan);state.stretchMaxDone=true}me.overflowHandler.calculate(ownerContext)}else{me.done=false}},calculateParallel:function(ownerContext,names,plan){var me=this,widthName=names.width,childItems=ownerContext.childItems,beforeXName=names.beforeX,afterXName=names.afterX,setWidthName=names.setWidth,childItemsLength=childItems.length,flexedItems=ownerContext.flexedItems,flexedItemsLength=flexedItems.length,pack=ownerContext.boxOptions.pack,padding=me.padding,containerWidth=plan.targetSize[widthName],totalMargin=0,left=padding[beforeXName],nonFlexWidth=left+padding[afterXName]+me.scrollOffset+(me.reserveOffset?me.availableSpaceOffset:0),scrollbarWidth=Ext.getScrollbarSize()[names.width],i,childMargins,remainingWidth,remainingFlex,childContext,flex,flexedWidth,contentWidth,mayNeedScrollbarAdjust,childWidth,percentageSpace;if(scrollbarWidth&&me.scrollPerpendicular&&ownerContext.parallelSizeModel.shrinkWrap&&!ownerContext.boxOptions.align.stretch&&!ownerContext.perpendicularSizeModel.shrinkWrap){if(!ownerContext.state.perpendicularDone){return false}mayNeedScrollbarAdjust=true}for(i=0;i<childItemsLength;++i){childContext=childItems[i];childMargins=childContext.marginInfo||childContext.getMarginInfo();totalMargin+=childMargins[widthName];if(!childContext[names.widthModel].calculated){childWidth=childContext.getProp(widthName);nonFlexWidth+=childWidth;if(isNaN(nonFlexWidth)){return false}}}nonFlexWidth+=totalMargin;if(ownerContext.percentageWidths){percentageSpace=containerWidth-totalMargin;if(isNaN(percentageSpace)){return false}for(i=0;i<childItemsLength;++i){childContext=childItems[i];if(childContext.percentageParallel){childWidth=Math.ceil(percentageSpace*childContext.percentageParallel);childWidth=childContext.setWidth(childWidth);nonFlexWidth+=childWidth}}}if(ownerContext.parallelSizeModel.shrinkWrap){plan.availableSpace=0;plan.tooNarrow=false}else{plan.availableSpace=containerWidth-nonFlexWidth;plan.tooNarrow=plan.availableSpace<ownerContext.flexedMinSize;if(plan.tooNarrow&&Ext.getScrollbarSize()[names.height]&&me.scrollParallel&&ownerContext.state.perpendicularDone){ownerContext.state.perpendicularDone=false;for(i=0;i<childItemsLength;++i){childItems[i].invalidate()}}}contentWidth=nonFlexWidth;remainingWidth=plan.availableSpace;remainingFlex=ownerContext.totalFlex;for(i=0;i<flexedItemsLength;i++){childContext=flexedItems[i];flex=childContext.flex;flexedWidth=me.roundFlex(flex/remainingFlex*remainingWidth);flexedWidth=childContext[setWidthName](flexedWidth);contentWidth+=flexedWidth;remainingWidth=Math.max(0,remainingWidth-flexedWidth);remainingFlex-=flex}if(pack.center){left+=remainingWidth/2;if(left<0){left=0}}else if(pack.end){left+=remainingWidth}for(i=0;i<childItemsLength;++i){childContext=childItems[i];childMargins=childContext.marginInfo;left+=childMargins[beforeXName];childContext.setProp(names.x,left);left+=childMargins[afterXName]+childContext.props[widthName]}contentWidth+=ownerContext.targetContext.getPaddingInfo()[widthName];ownerContext.state.contentWidth=contentWidth;if(mayNeedScrollbarAdjust&&ownerContext.peek(names.contentHeight)>plan.targetSize[names.height]){contentWidth+=scrollbarWidth;ownerContext[names.hasOverflowY]=true;ownerContext.target.componentLayout[names.setWidthInDom]=true;ownerContext[names.invalidateScrollY]=Ext.isStrict&&Ext.isIE8}ownerContext[names.setContentWidth](contentWidth);return true},calculatePerpendicular:function(ownerContext,names,plan){var me=this,heightShrinkWrap=ownerContext.perpendicularSizeModel.shrinkWrap,targetSize=plan.targetSize,childItems=ownerContext.childItems,childItemsLength=childItems.length,mmax=Math.max,heightName=names.height,setHeightName=names.setHeight,beforeYName=names.beforeY,topPositionName=names.y,padding=me.padding,top=padding[beforeYName],availHeight=targetSize[heightName]-top-padding[names.afterY],align=ownerContext.boxOptions.align,isStretch=align.stretch,isStretchMax=align.stretchmax,isCenter=align.center,isBottom=align.bottom,constrain=me.constrainAlign,maxHeight=0,hasPercentageSizes=0,onBeforeInvalidateChild=me.onBeforeConstrainInvalidateChild,onAfterInvalidateChild=me.onAfterConstrainInvalidateChild,scrollbarHeight=Ext.getScrollbarSize().height,childTop,i,childHeight,childMargins,diff,height,childContext,stretchMaxPartner,stretchMaxChildren,shrinkWrapParallelOverflow,percentagePerpendicular;if(isStretch||(isCenter||isBottom)&&!heightShrinkWrap){if(isNaN(availHeight)){return false}}if(me.scrollParallel&&plan.tooNarrow){if(heightShrinkWrap){shrinkWrapParallelOverflow=true}else{availHeight-=scrollbarHeight;plan.targetSize[heightName]-=scrollbarHeight}}if(isStretch){height=availHeight}else{for(i=0;i<childItemsLength;i++){childContext=childItems[i];childMargins=(childContext.marginInfo||childContext.getMarginInfo())[heightName];if(!(percentagePerpendicular=childContext.percentagePerpendicular)){childHeight=childContext.getProp(heightName)}else{++hasPercentageSizes;if(heightShrinkWrap){continue}else{childHeight=percentagePerpendicular*availHeight-childMargins;childHeight=childContext[names.setHeight](childHeight)}}if(!heightShrinkWrap&&constrain&&childContext[names.heightModel].shrinkWrap&&childHeight>availHeight){childContext.invalidate({before:onBeforeInvalidateChild,after:onAfterInvalidateChild,layout:me,childHeight:availHeight,names:names});ownerContext.state.parallelDone=false}if(isNaN(maxHeight=mmax(maxHeight,childHeight+childMargins,childContext.target[names.minHeight]||0))){return false}}if(shrinkWrapParallelOverflow){maxHeight+=scrollbarHeight;ownerContext[names.hasOverflowX]=true;ownerContext.target.componentLayout[names.setHeightInDom]=true;ownerContext[names.invalidateScrollX]=Ext.isStrict&&Ext.isIE8}stretchMaxPartner=ownerContext.stretchMaxPartner;if(stretchMaxPartner){ownerContext.setProp("maxChildHeight",maxHeight);stretchMaxChildren=stretchMaxPartner.childItems;if(stretchMaxChildren&&stretchMaxChildren.length){maxHeight=mmax(maxHeight,stretchMaxPartner.getProp("maxChildHeight"));if(isNaN(maxHeight)){return false}}}ownerContext[names.setContentHeight](maxHeight+me.padding[heightName]+ownerContext.targetContext.getPaddingInfo()[heightName]);if(shrinkWrapParallelOverflow){maxHeight-=scrollbarHeight}plan.maxSize=maxHeight;if(isStretchMax){height=maxHeight}else if(isCenter||isBottom||hasPercentageSizes){if(constrain){height=heightShrinkWrap?maxHeight:availHeight}else{height=heightShrinkWrap?maxHeight:mmax(availHeight,maxHeight)}height-=ownerContext.innerCtContext.getBorderInfo()[heightName]}}for(i=0;i<childItemsLength;i++){childContext=childItems[i];childMargins=childContext.marginInfo||childContext.getMarginInfo();childTop=top+childMargins[beforeYName];if(isStretch){childContext[setHeightName](height-childMargins[heightName])}else{percentagePerpendicular=childContext.percentagePerpendicular;if(heightShrinkWrap&&percentagePerpendicular){childMargins=childContext.marginInfo||childContext.getMarginInfo();childHeight=percentagePerpendicular*height-childMargins[heightName];childHeight=childContext.setHeight(childHeight)}if(isCenter){diff=height-childContext.props[heightName];if(diff>0){childTop=top+Math[me.alignRoundingMethod](diff/2)}}else if(isBottom){childTop=mmax(0,height-childTop-childContext.props[heightName])}}childContext.setProp(topPositionName,childTop)}return true},onBeforeConstrainInvalidateChild:function(childContext,options){var heightModelName=options.names.heightModel;if(!childContext[heightModelName].constrainedMin){childContext[heightModelName]=Ext.layout.SizeModel.calculated}},onAfterConstrainInvalidateChild:function(childContext,options){var names=options.names;childContext.setProp(names.beforeY,0);if(childContext[names.heightModel].calculated){childContext[names.setHeight](options.childHeight)}},calculateStretchMax:function(ownerContext,names,plan){var me=this,heightName=names.height,widthName=names.width,childItems=ownerContext.childItems,length=childItems.length,height=plan.maxSize,onBeforeStretchMaxInvalidateChild=me.onBeforeStretchMaxInvalidateChild,onAfterStretchMaxInvalidateChild=me.onAfterStretchMaxInvalidateChild,childContext,props,i,childHeight;for(i=0;i<length;++i){childContext=childItems[i];props=childContext.props;childHeight=height-childContext.getMarginInfo()[heightName];if(childHeight!=props[heightName]||childContext[names.heightModel].constrained){childContext.invalidate({before:onBeforeStretchMaxInvalidateChild,after:onAfterStretchMaxInvalidateChild,layout:me,childWidth:props[widthName],childHeight:childHeight,childX:props.x,childY:props.y,names:names})}}},onBeforeStretchMaxInvalidateChild:function(childContext,options){var heightModelName=options.names.heightModel;if(!childContext[heightModelName].constrainedMax){childContext[heightModelName]=Ext.layout.SizeModel.calculated}},onAfterStretchMaxInvalidateChild:function(childContext,options){var names=options.names,childHeight=options.childHeight,childWidth=options.childWidth;childContext.setProp("x",options.childX);childContext.setProp("y",options.childY);if(childContext[names.heightModel].calculated){childContext[names.setHeight](childHeight)}if(childContext[names.widthModel].calculated){childContext[names.setWidth](childWidth)}},completeLayout:function(ownerContext){var me=this,names=ownerContext.boxNames,invalidateScrollX=ownerContext.invalidateScrollX,invalidateScrollY=ownerContext.invalidateScrollY,dom,el,overflowX,overflowY,styles;me.overflowHandler.completeLayout(ownerContext);if(invalidateScrollX||invalidateScrollY){el=me.getTarget();dom=el.dom;styles=dom.style;if(invalidateScrollX){overflowX=el.getStyle("overflowX");if(overflowX=="auto"){overflowX=styles.overflowX;styles.overflowX="scroll"}else{invalidateScrollX=false}}if(invalidateScrollY){overflowY=el.getStyle("overflowY");if(overflowY=="auto"){overflowY=styles.overflowY;styles.overflowY="scroll"}else{invalidateScrollY=false}}if(invalidateScrollX||invalidateScrollY){dom.scrollWidth;if(invalidateScrollX){styles.overflowX=overflowX}if(invalidateScrollY){styles.overflowY=overflowY}}}if(me.scrollParallel){me.owner.getTargetEl().dom[names.scrollLeft]=me.scrollPos}},finishedLayout:function(ownerContext){this.overflowHandler.finishedLayout(ownerContext);this.callParent(arguments);this.targetEl.setWidth(ownerContext.innerCtContext.props.width)},publishInnerCtSize:function(ownerContext,reservedSpace){var me=this,names=ownerContext.boxNames,heightName=names.height,widthName=names.width,align=ownerContext.boxOptions.align,dock=me.owner.dock,padding=me.padding,plan=ownerContext.state.boxPlan,targetSize=plan.targetSize,height=targetSize[heightName],innerCtContext=ownerContext.innerCtContext,innerCtWidth=(ownerContext.parallelSizeModel.shrinkWrap||plan.tooNarrow&&me.scrollParallel?ownerContext.state.contentWidth-ownerContext.targetContext.getPaddingInfo()[widthName]:targetSize[widthName])-(reservedSpace||0),innerCtHeight;if(align.stretch){innerCtHeight=height}else{innerCtHeight=plan.maxSize+padding[names.beforeY]+padding[names.afterY]+innerCtContext.getBorderInfo()[heightName];if(!ownerContext.perpendicularSizeModel.shrinkWrap&&(align.center||align.bottom)){innerCtHeight=Math.max(height,innerCtHeight)}}innerCtContext[names.setWidth](innerCtWidth);innerCtContext[names.setHeight](innerCtHeight);if(isNaN(innerCtWidth+innerCtHeight)){me.done=false}if(plan.calculatedWidth&&(dock=="left"||dock=="right")){ownerContext.setWidth(plan.calculatedWidth,true,true)}},onRemove:function(comp){var me=this;me.callParent(arguments);if(me.overflowHandler){me.overflowHandler.onRemove(comp)}if(comp.layoutMarginCap==me.id){delete comp.layoutMarginCap}},initOverflowHandler:function(){var me=this,handler=me.overflowHandler,handlerType,constructor;if(typeof handler=="string"){handler={type:handler}}handlerType="None";if(handler&&handler.type!==undefined){handlerType=handler.type}constructor=Ext.layout.container.boxOverflow[handlerType];if(constructor[me.type]){constructor=constructor[me.type]}me.overflowHandler=Ext.create("Ext.layout.container.boxOverflow."+handlerType,me,handler)},getRenderTarget:function(){return this.targetEl},getElementTarget:function(){return this.innerCt},calculateChildBox:Ext.deprecated(),calculateChildBoxes:Ext.deprecated(),updateChildBoxes:Ext.deprecated(),destroy:function(){Ext.destroy(this.innerCt,this.overflowHandler);this.callParent(arguments)},getRenderData:function(){var data=this.callParent();data.targetElCls=this.targetElCls;return data}});