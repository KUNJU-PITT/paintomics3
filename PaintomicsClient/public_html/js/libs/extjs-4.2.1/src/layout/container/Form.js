Ext.define("Ext.layout.container.Form",{alias:"layout.form",extend:"Ext.layout.container.Container",alternateClassName:"Ext.layout.FormLayout",tableCls:Ext.baseCSSPrefix+"form-layout-table",type:"form",createsInnerCt:true,manageOverflow:true,lastOverflowAdjust:{width:0,height:0},childEls:["formTable"],padRow:'<tr><td class="'+Ext.baseCSSPrefix+'form-item-pad" colspan="3"></td></tr>',renderTpl:['<table id="{ownerId}-formTable" class="{tableCls}" style="width:100%" cellpadding="0">',"{%this.renderBody(out,values)%}","</table>","{%this.renderPadder(out,values)%}"],getRenderData:function(){var data=this.callParent();data.tableCls=this.tableCls;return data},calculate:function(ownerContext){var me=this,containerSize=me.getContainerSize(ownerContext,true),tableWidth,childItems,i=0,length,shrinkwrapHeight=ownerContext.sizeModel.height.shrinkWrap;if(shrinkwrapHeight){if(ownerContext.hasDomProp("containerChildrenSizeDone")){ownerContext.setProp("contentHeight",me.formTable.dom.offsetHeight+ownerContext.targetContext.getPaddingInfo().height)}else{me.done=false}}if(containerSize.gotWidth){tableWidth=me.formTable.dom.offsetWidth;childItems=ownerContext.childItems;for(length=childItems.length;i<length;++i){childItems[i].setWidth(tableWidth,false)}}else{me.done=false}},getRenderTarget:function(){return this.formTable},getRenderTree:function(){var me=this,result=me.callParent(arguments),i,len;for(i=0,len=result.length;i<len;i++){result[i]=me.transformItemRenderTree(result[i])}return result},transformItemRenderTree:function(item){if(item.tag&&item.tag=="table"){item.tag="tbody";delete item.cellspacing;delete item.cellpadding;if(Ext.isIE6){item.cn=this.padRow}return item}return{tag:"tbody",cn:{tag:"tr",cn:{tag:"td",colspan:3,style:"width:100%",cn:item}}}},isValidParent:function(item,target,position){return true},isItemShrinkWrap:function(item){return(item.shrinkWrap===true?3:item.shrinkWrap||0)&2},getItemSizePolicy:function(item){return{setsWidth:1,setsHeight:0}},beginLayoutCycle:function(ownerContext,firstCycle){var padEl=this.overflowPadderEl;if(padEl){padEl.setStyle("display","none")}if(!ownerContext.state.overflowAdjust){ownerContext.state.overflowAdjust=this.lastOverflowAdjust}},calculateOverflow:function(ownerContext,containerSize,dimensions){var me=this,targetContext=ownerContext.targetContext,manageOverflow=me.manageOverflow,state=ownerContext.state,overflowAdjust=state.overflowAdjust,padWidth,padHeight,padElContext,padding,scrollRangeFlags,scrollbarSize,contentW,contentH,ownerW,ownerH,scrollbars,xauto,yauto;if(manageOverflow&&!state.secondPass&&!me.reserveScrollbar){xauto=me.getOverflowXStyle(ownerContext)==="auto";yauto=me.getOverflowYStyle(ownerContext)==="auto";if(!containerSize.gotWidth){xauto=false}if(!containerSize.gotHeight){yauto=false}if(xauto||yauto){scrollbarSize=Ext.getScrollbarSize();contentW=ownerContext.peek("contentWidth");contentH=ownerContext.peek("contentHeight");padding=targetContext.getPaddingInfo();contentW-=padding.width;contentH-=padding.height;ownerW=containerSize.width;ownerH=containerSize.height;scrollbars=me.getScrollbarsNeeded(ownerW,ownerH,contentW,contentH);state.overflowState=scrollbars;if(typeof dimensions=="number"){scrollbars&=~dimensions}overflowAdjust={width:xauto&&scrollbars&2?scrollbarSize.width:0,height:yauto&&scrollbars&1?scrollbarSize.height:0};if(overflowAdjust.width!==me.lastOverflowAdjust.width||overflowAdjust.height!==me.lastOverflowAdjust.height){me.done=false;ownerContext.invalidate({state:{overflowAdjust:overflowAdjust,overflowState:state.overflowState,secondPass:true}})}}}if(!me.done){return}padElContext=ownerContext.padElContext||(ownerContext.padElContext=ownerContext.getEl("overflowPadderEl",me));if(padElContext){scrollbars=state.overflowState;padWidth=ownerContext.peek("contentWidth");padHeight=1;if(scrollbars){padding=targetContext.getPaddingInfo();scrollRangeFlags=me.scrollRangeFlags;if(scrollbars&2&&scrollRangeFlags&1){padHeight+=padding.bottom}if(scrollbars&1&&scrollRangeFlags&4){padWidth+=padding.right}padElContext.setProp("display","");padElContext.setSize(padWidth,padHeight)}else{padElContext.setProp("display","none")}}},completeLayout:function(ownerContext){this.lastOverflowAdjust=ownerContext.state.overflowAdjust},doRenderPadder:function(out,renderData){var me=renderData.$layout,owner=me.owner,scrollRangeFlags=me.getScrollRangeFlags();if(me.manageOverflow){if(scrollRangeFlags&5){out.push('<div id="',owner.id,'-overflowPadderEl" ','style="font-size: 1px; height: 1px; margin-top: -1px; position: relative; z-index: -99999');out.push('"></div>');me.scrollRangeFlags=scrollRangeFlags}}},getContainerSize:function(ownerContext,inDom,ignoreOverflow){var targetContext=ownerContext.targetContext,frameInfo=targetContext.getFrameInfo(),padding=targetContext.getPaddingInfo(),got=0,needed=0,overflowAdjust=ignoreOverflow?null:ownerContext.state.overflowAdjust,gotWidth,gotHeight,width,height;if(!ownerContext.widthModel.shrinkWrap){++needed;width=inDom?targetContext.getDomProp("width"):targetContext.getProp("width");gotWidth=typeof width=="number";if(gotWidth){++got;width-=frameInfo.width+padding.width;if(overflowAdjust){width-=overflowAdjust.width}}}if(!ownerContext.heightModel.shrinkWrap){++needed;height=inDom?targetContext.getDomProp("height"):targetContext.getProp("height");gotHeight=typeof height=="number";if(gotHeight){++got;height-=frameInfo.height+padding.height;if(overflowAdjust){height-=overflowAdjust.height}}}return{width:width,height:height,needed:needed,got:got,gotAll:got==needed,gotWidth:gotWidth,gotHeight:gotHeight}},getOverflowXStyle:function(ownerContext){var me=this;return me.overflowXStyle||(me.overflowXStyle=me.owner.scrollFlags.overflowX||ownerContext.targetContext.getStyle("overflow-x"))},getOverflowYStyle:function(ownerContext){var me=this;return me.overflowYStyle||(me.overflowYStyle=me.owner.scrollFlags.overflowY||ownerContext.targetContext.getStyle("overflow-y"))},getScrollRangeFlags:function(){var flags=-1;return function(){if(flags<0){var div=Ext.getBody().createChild({cls:Ext.baseCSSPrefix+"border-box",style:{width:"100px",height:"100px",padding:"10px",overflow:"auto"},children:[{style:{border:"1px solid red",width:"150px",height:"150px",margin:"0 5px 5px 0"}}]}),scrollHeight=div.dom.scrollHeight,scrollWidth=div.dom.scrollWidth,heightFlags={175:0,165:1,170:2,160:3},widthFlags={175:0,165:4,170:8,160:12};flags=(heightFlags[scrollHeight]||0)|(widthFlags[scrollWidth]||0);div.remove()}return flags}}(),initLayout:function(){var me=this,scrollbarWidth=Ext.getScrollbarSize().width;me.callParent();if(scrollbarWidth&&me.manageOverflow&&!me.hasOwnProperty("lastOverflowAdjust")){if(me.owner.scrollFlags.y||me.reserveScrollbar){me.lastOverflowAdjust={width:scrollbarWidth,height:0}}}},setupRenderTpl:function(renderTpl){this.callParent(arguments);renderTpl.renderPadder=this.doRenderPadder}});