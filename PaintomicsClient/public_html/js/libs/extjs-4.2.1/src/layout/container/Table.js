Ext.define("Ext.layout.container.Table",{alias:["layout.table"],extend:"Ext.layout.container.Container",alternateClassName:"Ext.layout.TableLayout",monitorResize:false,type:"table",createsInnerCt:true,targetCls:Ext.baseCSSPrefix+"table-layout-ct",tableCls:Ext.baseCSSPrefix+"table-layout",cellCls:Ext.baseCSSPrefix+"table-layout-cell",tableAttrs:null,getItemSizePolicy:function(item){return this.autoSizePolicy},initHierarchyState:function(hierarchyStateInner){hierarchyStateInner.inShrinkWrapTable=true},getLayoutItems:function(){var me=this,result=[],items=me.callParent(),item,len=items.length,i;for(i=0;i<len;i++){item=items[i];if(!item.hidden){result.push(item)}}return result},getHiddenItems:function(){var result=[],items=this.owner.items.items,len=items.length,i=0,item;for(;i<len;++i){item=items[i];if(item.rendered&&item.hidden){result.push(item)}}return result},renderChildren:function(){var me=this,items=me.getLayoutItems(),tbody=me.owner.getTargetEl().child("table",true).tBodies[0],rows=tbody.rows,i=0,len=items.length,hiddenItems=me.getHiddenItems(),cells,curCell,rowIdx,cellIdx,item,trEl,tdEl,itemCt,el;cells=me.calculateCells(items);for(;i<len;i++){curCell=cells[i];rowIdx=curCell.rowIdx;cellIdx=curCell.cellIdx;item=items[i];trEl=rows[rowIdx];if(!trEl){trEl=tbody.insertRow(rowIdx);if(me.trAttrs){trEl.set(me.trAttrs)}}itemCt=tdEl=Ext.get(trEl.cells[cellIdx]||trEl.insertCell(cellIdx));if(me.needsDivWrap()){itemCt=tdEl.first()||tdEl.createChild({tag:"div"});itemCt.setWidth(null)}if(!item.rendered){me.renderItem(item,itemCt,0)}else if(!me.isValidParent(item,itemCt,rowIdx,cellIdx,tbody)){me.moveItem(item,itemCt,0)}if(me.tdAttrs){tdEl.set(me.tdAttrs)}if(item.tdAttrs){tdEl.set(item.tdAttrs)}tdEl.set({colSpan:item.colspan||1,rowSpan:item.rowspan||1,id:item.cellId||"",cls:me.cellCls+" "+(item.cellCls||"")});if(!cells[i+1]||cells[i+1].rowIdx!==rowIdx){cellIdx++;while(trEl.cells[cellIdx]){trEl.deleteCell(cellIdx)}}}rowIdx++;while(tbody.rows[rowIdx]){tbody.deleteRow(rowIdx)}for(i=0,len=hiddenItems.length;i<len;++i){me.ensureInDocument(hiddenItems[i].getEl())}},ensureInDocument:function(el){var dom=el.dom.parentNode;while(dom){if(dom.tagName.toUpperCase()=="BODY"){return}dom=dom.parentNode}Ext.getDetachedBody().appendChild(el)},calculate:function(ownerContext){if(!ownerContext.hasDomProp("containerChildrenSizeDone")){this.done=false}else{var targetContext=ownerContext.targetContext,widthShrinkWrap=ownerContext.widthModel.shrinkWrap,heightShrinkWrap=ownerContext.heightModel.shrinkWrap,shrinkWrap=heightShrinkWrap||widthShrinkWrap,table=shrinkWrap&&targetContext.el.child("table",true),targetPadding=shrinkWrap&&targetContext.getPaddingInfo();if(widthShrinkWrap){ownerContext.setContentWidth(table.offsetWidth+targetPadding.width,true)}if(heightShrinkWrap){ownerContext.setContentHeight(table.offsetHeight+targetPadding.height,true)}}},finalizeLayout:function(){if(this.needsDivWrap()){var items=this.getLayoutItems(),i,iLen=items.length,item;for(i=0;i<iLen;i++){item=items[i];Ext.fly(item.el.dom.parentNode).setWidth(item.getWidth())}}if(Ext.isIE6||Ext.isIEQuirks){this.owner.getTargetEl().child("table").repaint()}},calculateCells:function(items){var cells=[],rowIdx=0,colIdx=0,cellIdx=0,totalCols=this.columns||Infinity,rowspans=[],i=0,j,len=items.length,item;for(;i<len;i++){item=items[i];while(colIdx>=totalCols||rowspans[colIdx]>0){if(colIdx>=totalCols){colIdx=0;cellIdx=0;rowIdx++;for(j=0;j<totalCols;j++){if(rowspans[j]>0){rowspans[j]--}}}else{colIdx++}}cells.push({rowIdx:rowIdx,cellIdx:cellIdx});for(j=item.colspan||1;j;--j){rowspans[colIdx]=item.rowspan||1;++colIdx}++cellIdx}return cells},getRenderTree:function(){var me=this,items=me.getLayoutItems(),cells,rows=[],result=Ext.apply({tag:"table",role:"presentation",cls:me.tableCls,cellspacing:0,cellpadding:0,cn:{tag:"tbody",cn:rows}},me.tableAttrs),tdAttrs=me.tdAttrs,needsDivWrap=me.needsDivWrap(),i,len=items.length,item,curCell,tr,rowIdx,cellIdx,cell;cells=me.calculateCells(items);for(i=0;i<len;i++){item=items[i];curCell=cells[i];rowIdx=curCell.rowIdx;cellIdx=curCell.cellIdx;tr=rows[rowIdx];if(!tr){tr=rows[rowIdx]={tag:"tr",cn:[]};if(me.trAttrs){Ext.apply(tr,me.trAttrs)}}cell=tr.cn[cellIdx]={tag:"td"};if(tdAttrs){Ext.apply(cell,tdAttrs)}Ext.apply(cell,{colSpan:item.colspan||1,rowSpan:item.rowspan||1,id:item.cellId||"",cls:me.cellCls+" "+(item.cellCls||"")});if(needsDivWrap){cell=cell.cn={tag:"div"}}me.configureItem(item);cell.cn=item.getRenderTree()}return result},isValidParent:function(item,target,rowIdx,cellIdx){var tbody,correctCell,table;if(arguments.length===3){table=item.el.up("table");return table&&table.dom.parentNode===target.dom}tbody=this.owner.getTargetEl().child("table",true).tBodies[0];correctCell=tbody.rows[rowIdx].cells[cellIdx];return item.el.dom.parentNode===correctCell},needsDivWrap:function(){return Ext.isOpera10_5}});