Ext.define("Ext.layout.container.Anchor",{alias:"layout.anchor",extend:"Ext.layout.container.Auto",alternateClassName:"Ext.layout.AnchorLayout",type:"anchor",defaultAnchor:"100%",parseAnchorRE:/^(r|right|b|bottom)$/i,manageOverflow:true,beginLayoutCycle:function(ownerContext){var me=this,dimensions=0,anchorSpec,childContext,childItems,i,length,target;me.callParent(arguments);childItems=ownerContext.childItems;length=childItems.length;for(i=0;i<length;++i){childContext=childItems[i];anchorSpec=childContext.target.anchorSpec;if(anchorSpec){if(childContext.widthModel.calculated&&anchorSpec.right){dimensions|=1}if(childContext.heightModel.calculated&&anchorSpec.bottom){dimensions|=2}if(dimensions==3){break}}}ownerContext.anchorDimensions=dimensions;me.sanityCheck(ownerContext)},calculateItems:function(ownerContext,containerSize){var me=this,childItems=ownerContext.childItems,length=childItems.length,gotHeight=containerSize.gotHeight,gotWidth=containerSize.gotWidth,ownerHeight=containerSize.height,ownerWidth=containerSize.width,knownDimensions=(gotWidth?1:0)|(gotHeight?2:0),anchorDimensions=ownerContext.anchorDimensions,anchorSpec,childContext,childMargins,height,i,width;if(!anchorDimensions){return true}for(i=0;i<length;i++){childContext=childItems[i];childMargins=childContext.getMarginInfo();anchorSpec=childContext.target.anchorSpec;if(gotWidth&&childContext.widthModel.calculated){width=anchorSpec.right(ownerWidth)-childMargins.width;width=me.adjustWidthAnchor(width,childContext);childContext.setWidth(width)}if(gotHeight&&childContext.heightModel.calculated){height=anchorSpec.bottom(ownerHeight)-childMargins.height;height=me.adjustHeightAnchor(height,childContext);childContext.setHeight(height)}}return(knownDimensions&anchorDimensions)===anchorDimensions},sanityCheck:function(ownerContext){var shrinkWrapWidth=ownerContext.widthModel.shrinkWrap,shrinkWrapHeight=ownerContext.heightModel.shrinkWrap,children=ownerContext.childItems,anchorSpec,comp,childContext,i,length;for(i=0,length=children.length;i<length;++i){childContext=children[i];comp=childContext.target;anchorSpec=comp.anchorSpec;if(anchorSpec){if(childContext.widthModel.calculated&&anchorSpec.right){if(shrinkWrapWidth){Ext.log({level:"warn",msg:"Right anchor on "+comp.id+" in shrinkWrap width container"})}}if(childContext.heightModel.calculated&&anchorSpec.bottom){if(shrinkWrapHeight){Ext.log({level:"warn",msg:"Bottom anchor on "+comp.id+" in shrinkWrap height container"})}}}}},anchorFactory:{offset:function(delta){return function(v){return v+delta}},ratio:function(ratio){return function(v){return Math.floor(v*ratio)}},standard:function(diff){return function(v){return v-diff}}},parseAnchor:function(a,start,cstart){if(a&&a!="none"){var factory=this.anchorFactory,delta;if(this.parseAnchorRE.test(a)){return factory.standard(cstart-start)}if(a.indexOf("%")!=-1){return factory.ratio(parseFloat(a.replace("%",""))*.01)}delta=parseInt(a,10);if(!isNaN(delta)){return factory.offset(delta)}}return null},adjustWidthAnchor:function(value,childContext){return value},adjustHeightAnchor:function(value,childContext){return value},configureItem:function(item){var me=this,owner=me.owner,anchor=item.anchor,anchorsArray,anchorWidth,anchorHeight;me.callParent(arguments);if(!item.anchor&&item.items&&!Ext.isNumber(item.width)&&!(Ext.isIE6&&Ext.isStrict)){item.anchor=anchor=me.defaultAnchor}if(owner.anchorSize){if(typeof owner.anchorSize=="number"){anchorWidth=owner.anchorSize}else{anchorWidth=owner.anchorSize.width;anchorHeight=owner.anchorSize.height}}else{anchorWidth=owner.initialConfig.width;anchorHeight=owner.initialConfig.height}if(anchor){anchorsArray=anchor.split(" ");item.anchorSpec={right:me.parseAnchor(anchorsArray[0],item.initialConfig.width,anchorWidth),bottom:me.parseAnchor(anchorsArray[1],item.initialConfig.height,anchorHeight)}}},sizePolicy:{$:{readsWidth:1,readsHeight:1,setsWidth:0,setsHeight:0},b:{readsWidth:1,readsHeight:0,setsWidth:0,setsHeight:1},r:{$:{readsWidth:0,readsHeight:1,setsWidth:1,setsHeight:0},b:{readsWidth:0,readsHeight:0,setsWidth:1,setsHeight:1}}},getItemSizePolicy:function(item){var anchorSpec=item.anchorSpec,key="$",policy=this.sizePolicy,sizeModel;if(anchorSpec){sizeModel=this.owner.getSizeModel();if(anchorSpec.right&&!sizeModel.width.shrinkWrap){policy=policy.r}if(anchorSpec.bottom&&!sizeModel.height.shrinkWrap){key="b"}}return policy[key]}});