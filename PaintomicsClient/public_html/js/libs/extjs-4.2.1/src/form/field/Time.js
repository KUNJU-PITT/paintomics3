Ext.define("Ext.form.field.Time",{extend:"Ext.form.field.ComboBox",alias:"widget.timefield",requires:["Ext.form.field.Date","Ext.picker.Time","Ext.view.BoundListKeyNav","Ext.Date"],alternateClassName:["Ext.form.TimeField","Ext.form.Time"],triggerCls:Ext.baseCSSPrefix+"form-time-trigger",minText:"The time in this field must be equal to or after {0}",maxText:"The time in this field must be equal to or before {0}",invalidText:"{0} is not a valid time",format:"g:i A",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H|gi a|hi a|giA|hiA|gi A|hi A",increment:15,pickerMaxHeight:300,selectOnTab:true,snapToIncrement:false,initDate:"1/1/2008",initDateFormat:"j/n/Y",ignoreSelection:0,queryMode:"local",displayField:"disp",valueField:"date",initComponent:function(){var me=this,min=me.minValue,max=me.maxValue;if(min){me.setMinValue(min)}if(max){me.setMaxValue(max)}me.displayTpl=new Ext.XTemplate('<tpl for=".">'+'{[typeof values === "string" ? values : this.formatDate(values["'+me.displayField+'"])]}'+'<tpl if="xindex < xcount">'+me.delimiter+"</tpl>"+"</tpl>",{formatDate:Ext.Function.bind(me.formatDate,me)});this.callParent()},transformOriginalValue:function(value){if(Ext.isString(value)){return this.rawToValue(value)}return value},isEqual:function(v1,v2){return Ext.Date.isEqual(v1,v2)},setMinValue:function(value){var me=this,picker=me.picker;me.setLimit(value,true);if(picker){picker.setMinValue(me.minValue)}},setMaxValue:function(value){var me=this,picker=me.picker;me.setLimit(value,false);if(picker){picker.setMaxValue(me.maxValue)}},setLimit:function(value,isMin){var me=this,d,val;if(Ext.isString(value)){d=me.parseDate(value)}else if(Ext.isDate(value)){d=value}if(d){val=Ext.Date.clearTime(new Date(me.initDate));val.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())}else{val=null}me[isMin?"minValue":"maxValue"]=val},rawToValue:function(rawValue){return this.parseDate(rawValue)||rawValue||null},valueToRaw:function(value){return this.formatDate(this.parseDate(value))},getErrors:function(value){var me=this,format=Ext.String.format,errors=me.callParent(arguments),minValue=me.minValue,maxValue=me.maxValue,date;value=me.formatDate(value||me.processRawValue(me.getRawValue()));if(value===null||value.length<1){return errors}date=me.parseDate(value);if(!date){errors.push(format(me.invalidText,value,Ext.Date.unescapeFormat(me.format)));return errors}if(minValue&&date<minValue){errors.push(format(me.minText,me.formatDate(minValue)))}if(maxValue&&date>maxValue){errors.push(format(me.maxText,me.formatDate(maxValue)))}return errors},formatDate:function(){return Ext.form.field.Date.prototype.formatDate.apply(this,arguments)},parseDate:function(value){var me=this,val=value,altFormats=me.altFormats,altFormatsArray=me.altFormatsArray,i=0,len;if(value&&!Ext.isDate(value)){val=me.safeParse(value,me.format);if(!val&&altFormats){altFormatsArray=altFormatsArray||altFormats.split("|");len=altFormatsArray.length;for(;i<len&&!val;++i){val=me.safeParse(value,altFormatsArray[i])}}}if(val&&me.snapToIncrement){val=new Date(Ext.Number.snap(val.getTime(),me.increment*60*1e3))}return val},safeParse:function(value,format){var me=this,utilDate=Ext.Date,parsedDate,result=null;if(utilDate.formatContainsDateInfo(format)){result=utilDate.parse(value,format)}else{parsedDate=utilDate.parse(me.initDate+" "+value,me.initDateFormat+" "+format);if(parsedDate){result=parsedDate}}return result},getSubmitValue:function(){var me=this,format=me.submitFormat||me.format,value=me.getValue();return value?Ext.Date.format(value,format):null},createPicker:function(){var me=this,picker;me.listConfig=Ext.apply({xtype:"timepicker",selModel:{mode:"SINGLE"},cls:undefined,minValue:me.minValue,maxValue:me.maxValue,increment:me.increment,format:me.format,maxHeight:me.pickerMaxHeight},me.listConfig);picker=me.callParent();me.bindStore(picker.store);return picker},onItemClick:function(picker,record){var me=this,selected=picker.getSelectionModel().getSelection();if(selected.length>0){selected=selected[0];if(selected&&Ext.Date.isEqual(record.get("date"),selected.get("date"))){me.collapse()}}},onListSelectionChange:function(list,recordArray){if(recordArray.length){var me=this,val=recordArray[0].get("date");if(!me.ignoreSelection){me.skipSync=true;me.setValue(val);me.skipSync=false;me.fireEvent("select",me,val);me.picker.clearHighlight();me.collapse();me.inputEl.focus()}}},syncSelection:function(){var me=this,picker=me.picker,toSelect,selModel,value,data,d,dLen,rec;if(picker&&!me.skipSync){picker.clearHighlight();value=me.getValue();selModel=picker.getSelectionModel();me.ignoreSelection++;if(value===null){selModel.deselectAll()}else if(Ext.isDate(value)){data=picker.store.data.items;dLen=data.length;for(d=0;d<dLen;d++){rec=data[d];if(Ext.Date.isEqual(rec.get("date"),value)){toSelect=rec;break}}selModel.select(toSelect)}me.ignoreSelection--}},postBlur:function(){var me=this,val=me.getValue();me.callParent(arguments);if(me.wasValid&&val){me.setRawValue(me.formatDate(val))}},setValue:function(){this.getPicker();return this.callParent(arguments)},getValue:function(){return this.parseDate(this.callParent(arguments))}});