Ext.define("Ext.form.field.Picker",{extend:"Ext.form.field.Trigger",alias:"widget.pickerfield",alternateClassName:"Ext.form.Picker",requires:["Ext.util.KeyNav"],matchFieldWidth:true,pickerAlign:"tl-bl?",openCls:Ext.baseCSSPrefix+"pickerfield-open",editable:true,initComponent:function(){this.callParent();this.addEvents("expand","collapse","select")},initEvents:function(){var me=this;me.callParent();me.keyNav=new Ext.util.KeyNav(me.inputEl,{down:me.onDownArrow,esc:{handler:me.onEsc,scope:me,defaultEventAction:false},scope:me,forceKeyDown:true});if(!me.editable){me.mon(me.inputEl,"click",me.onTriggerClick,me)}if(Ext.isGecko){me.inputEl.dom.setAttribute("autocomplete","off")}},onEsc:function(e){if(Ext.isIE){e.preventDefault()}if(this.isExpanded){this.collapse();e.stopEvent()}},onDownArrow:function(e){if(!this.isExpanded){this.onTriggerClick()}},expand:function(){var me=this,bodyEl,picker,collapseIf;if(me.rendered&&!me.isExpanded&&!me.isDestroyed){me.expanding=true;bodyEl=me.bodyEl;picker=me.getPicker();collapseIf=me.collapseIf;picker.show();me.isExpanded=true;me.alignPicker();bodyEl.addCls(me.openCls);me.mon(Ext.getDoc(),{mousewheel:collapseIf,mousedown:collapseIf,scope:me});Ext.EventManager.onWindowResize(me.alignPicker,me);me.fireEvent("expand",me);me.onExpand();delete me.expanding}},onExpand:Ext.emptyFn,alignPicker:function(){var me=this,picker=me.getPicker();if(me.isExpanded){if(me.matchFieldWidth){picker.setWidth(me.bodyEl.getWidth())}if(picker.isFloating()){me.doAlign()}}},doAlign:function(){var me=this,picker=me.picker,aboveSfx="-above",isAbove;me.picker.alignTo(me.triggerWrap,me.pickerAlign,me.pickerOffset);isAbove=picker.el.getY()<me.inputEl.getY();me.bodyEl[isAbove?"addCls":"removeCls"](me.openCls+aboveSfx);picker[isAbove?"addCls":"removeCls"](picker.baseCls+aboveSfx)},collapse:function(){if(this.isExpanded&&!this.isDestroyed){var me=this,openCls=me.openCls,picker=me.picker,doc=Ext.getDoc(),collapseIf=me.collapseIf,aboveSfx="-above";picker.hide();me.isExpanded=false;me.bodyEl.removeCls([openCls,openCls+aboveSfx]);picker.el.removeCls(picker.baseCls+aboveSfx);doc.un("mousewheel",collapseIf,me);doc.un("mousedown",collapseIf,me);Ext.EventManager.removeResizeListener(me.alignPicker,me);me.fireEvent("collapse",me);me.onCollapse()}},onCollapse:Ext.emptyFn,collapseIf:function(e){var me=this;if(!me.isDestroyed&&!e.within(me.bodyEl,false,true)&&!e.within(me.picker.el,false,true)&&!me.isEventWithinPickerLoadMask(e)){me.collapse()}},getPicker:function(){var me=this;return me.picker||(me.picker=me.createPicker())},createPicker:Ext.emptyFn,onTriggerClick:function(){var me=this;if(!me.readOnly&&!me.disabled){if(me.isExpanded){me.collapse()}else{me.expand()}me.inputEl.focus()}},triggerBlur:function(){var picker=this.picker;this.callParent(arguments);if(picker&&picker.isVisible()){picker.hide()}},mimicBlur:function(e){var me=this,picker=me.picker;if(!picker||!e.within(picker.el,false,true)&&!me.isEventWithinPickerLoadMask(e)){me.callParent(arguments)}},onDestroy:function(){var me=this,picker=me.picker;Ext.EventManager.removeResizeListener(me.alignPicker,me);Ext.destroy(me.keyNav);if(picker){delete picker.pickerField;picker.destroy()}me.callParent()},isEventWithinPickerLoadMask:function(e){var loadMask=this.picker.loadMask;return loadMask?e.within(loadMask.maskEl,false,true)||e.within(loadMask.el,false,true):false}});