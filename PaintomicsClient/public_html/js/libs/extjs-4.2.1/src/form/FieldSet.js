Ext.define("Ext.form.FieldSet",{extend:"Ext.container.Container",mixins:{fieldAncestor:"Ext.form.FieldAncestor"},alias:"widget.fieldset",uses:["Ext.form.field.Checkbox","Ext.panel.Tool","Ext.layout.container.Anchor","Ext.layout.component.FieldSet"],collapsed:false,toggleOnTitleClick:true,baseCls:Ext.baseCSSPrefix+"fieldset",layout:"anchor",componentLayout:"fieldset",autoEl:"fieldset",childEls:["body"],renderTpl:["{%this.renderLegend(out,values);%}",'<div id="{id}-body" class="{baseCls}-body {bodyTargetCls}"<tpl if="bodyStyle"> style="{bodyStyle}"</tpl>>',"{%this.renderContainer(out,values);%}","</div>"],stateEvents:["collapse","expand"],maskOnDisable:false,beforeDestroy:function(){var me=this,legend=me.legend;if(legend){delete legend.ownerCt;legend.destroy();me.legend=null}me.callParent()},initComponent:function(){var me=this,baseCls=me.baseCls;me.initFieldAncestor();me.callParent();me.layout.managePadding=me.layout.manageOverflow=false;me.addEvents("beforeexpand","beforecollapse","expand","collapse");if(me.collapsed){me.addCls(baseCls+"-collapsed");me.collapse()}if(me.title||me.checkboxToggle||me.collapsible){me.addTitleClasses();me.legend=Ext.widget(me.createLegendCt())}me.initMonitor()},initPadding:function(targetEl){var me=this,body=me.getProtoBody(),padding=me.padding,bodyPadding;if(padding!==undefined){if(Ext.isIEQuirks||Ext.isIE8m){padding=me.parseBox(padding);bodyPadding=Ext.Element.parseBox(0);bodyPadding.top=padding.top;padding.top=0;body.setStyle("padding",me.unitizeBox(bodyPadding))}targetEl.setStyle("padding",me.unitizeBox(padding))}},getProtoBody:function(){var me=this,body=me.protoBody;if(!body){me.protoBody=body=new Ext.util.ProtoElement({styleProp:"bodyStyle",styleIsText:true})}return body},initRenderData:function(){var me=this,data=me.callParent();data.bodyTargetCls=me.bodyTargetCls;me.protoBody.writeTo(data);delete me.protoBody;return data},getState:function(){var state=this.callParent();state=this.addPropertyToState(state,"collapsed");return state},afterCollapse:Ext.emptyFn,afterExpand:Ext.emptyFn,collapsedHorizontal:function(){return true},collapsedVertical:function(){return true},createLegendCt:function(){var me=this,items=[],legend={xtype:"container",baseCls:me.baseCls+"-header",id:me.id+"-legend",autoEl:"legend",items:items,ownerCt:me,shrinkWrap:true,ownerLayout:me.componentLayout};if(me.checkboxToggle){items.push(me.createCheckboxCmp())}else if(me.collapsible){items.push(me.createToggleCmp())}items.push(me.createTitleCmp());return legend},createTitleCmp:function(){var me=this,cfg={xtype:"component",html:me.title,cls:me.baseCls+"-header-text",id:me.id+"-legendTitle"};if(me.collapsible&&me.toggleOnTitleClick){cfg.listeners={click:{element:"el",scope:me,fn:me.toggle}};cfg.cls+=" "+me.baseCls+"-header-text-collapsible"}return me.titleCmp=Ext.widget(cfg)},createCheckboxCmp:function(){var me=this,suffix="-checkbox";me.checkboxCmp=Ext.widget({xtype:"checkbox",hideEmptyLabel:true,name:me.checkboxName||me.id+suffix,cls:me.baseCls+"-header"+suffix,id:me.id+"-legendChk",checked:!me.collapsed,listeners:{change:me.onCheckChange,scope:me}});return me.checkboxCmp},createToggleCmp:function(){var me=this;me.toggleCmp=Ext.widget({xtype:"tool",height:15,width:15,type:"toggle",handler:me.toggle,id:me.id+"-legendToggle",scope:me});return me.toggleCmp},doRenderLegend:function(out,renderData){var me=renderData.$comp,legend=me.legend,tree;if(legend){legend.ownerLayout.configureItem(legend);tree=legend.getRenderTree();Ext.DomHelper.generateMarkup(tree,out)}},finishRender:function(){var legend=this.legend;this.callParent();if(legend){legend.finishRender()}},getCollapsed:function(){return this.collapsed?"top":false},getCollapsedDockedItems:function(){var legend=this.legend;return legend?[legend]:[]},setTitle:function(title){var me=this,legend=me.legend,baseCls=me.baseCls;me.title=title;if(me.rendered){if(!legend){me.legend=legend=Ext.widget(me.createLegendCt());me.addTitleClasses();legend.ownerLayout.configureItem(legend);legend.render(me.el,0)}me.titleCmp.update(title)}else if(legend){me.titleCmp.update(title)}else{me.addTitleClasses();me.legend=Ext.widget(me.createLegendCt())}return me},addTitleClasses:function(){var me=this,title=me.title,baseCls=me.baseCls;if(title){me.addCls(baseCls+"-with-title")}if(title||me.checkboxToggle||me.collapsible){me.addCls(baseCls+"-with-header")}},applyTargetCls:function(targetCls){this.bodyTargetCls=targetCls},getTargetEl:function(){return this.body||this.frameBody||this.el},getDefaultContentTarget:function(){return this.body},expand:function(){return this.setExpanded(true)},collapse:function(){return this.setExpanded(false)},setExpanded:function(expanded){var me=this,checkboxCmp=me.checkboxCmp,operation=expanded?"expand":"collapse";if(!me.rendered||me.fireEvent("before"+operation,me)!==false){expanded=!!expanded;if(checkboxCmp){checkboxCmp.setValue(expanded)}if(expanded){me.removeCls(me.baseCls+"-collapsed")}else{me.addCls(me.baseCls+"-collapsed")}me.collapsed=!expanded;if(expanded){delete me.getHierarchyState().collapsed}else{me.getHierarchyState().collapsed=true}if(me.rendered){me.updateLayout({isRoot:false});me.fireEvent(operation,me)}}return me},getRefItems:function(deep){var refItems=this.callParent(arguments),legend=this.legend;if(legend){refItems.unshift(legend);if(deep){refItems.unshift.apply(refItems,legend.getRefItems(true))}}return refItems},toggle:function(){this.setExpanded(!!this.collapsed)},onCheckChange:function(cmp,checked){this.setExpanded(checked)},setupRenderTpl:function(renderTpl){this.callParent(arguments);renderTpl.renderLegend=this.doRenderLegend}});