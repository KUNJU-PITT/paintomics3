Ext.define("Ext.data.proxy.JsonP",{extend:"Ext.data.proxy.Server",alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],requires:["Ext.data.JsonP"],defaultWriterType:"base",callbackKey:"callback",recordParam:"records",autoAppendParams:true,constructor:function(){this.addEvents("exception");this.callParent(arguments)},doRequest:function(operation,callback,scope){var me=this,request=me.buildRequest(operation),params=request.params;Ext.apply(request,{callbackKey:me.callbackKey,timeout:me.timeout,scope:me,disableCaching:false,callback:me.createRequestCallback(request,operation,callback,scope)});if(me.autoAppendParams){request.params={}}request.jsonp=Ext.data.JsonP.request(request);request.params=params;operation.setStarted();me.lastRequest=request;return request},createRequestCallback:function(request,operation,callback,scope){var me=this;return function(success,response,errorType){delete me.lastRequest;me.processResponse(success,operation,request,response,callback,scope)}},setException:function(operation,response){operation.setException(operation.request.jsonp.errorType)},buildUrl:function(request){var me=this,url=me.callParent(arguments),records=request.records,writer=me.getWriter(),params,filters,filter,i;if(writer&&request.operation.allowWrite()){request=writer.write(request)}params=request.params;filters=params.filters,delete params.filters;if(filters&&filters.length){for(i=0;i<filters.length;i++){filter=filters[i];if(filter.value){params[filter.property]=filter.value}}}if((!writer||!writer.encode)&&Ext.isArray(records)&&records.length>0){params[me.recordParam]=me.encodeRecords(records)}if(me.autoAppendParams){url=Ext.urlAppend(url,Ext.Object.toQueryString(params))}return url},abort:function(){var lastRequest=this.lastRequest;if(lastRequest){Ext.data.JsonP.abort(lastRequest.jsonp)}},encodeRecords:function(records){var encoded=[],i=0,len=records.length;for(;i<len;i++){encoded.push(Ext.encode(records[i].getData()))}return encoded}});