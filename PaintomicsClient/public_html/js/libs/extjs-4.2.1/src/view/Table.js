Ext.define("Ext.view.Table",{extend:"Ext.view.View",alias:"widget.tableview",requires:["Ext.grid.CellContext","Ext.view.TableLayout","Ext.view.NodeCache","Ext.util.DelayedTask","Ext.util.MixedCollection"],componentLayout:"tableview",baseCls:Ext.baseCSSPrefix+"grid-view",firstCls:Ext.baseCSSPrefix+"grid-cell-first",lastCls:Ext.baseCSSPrefix+"grid-cell-last",headerRowSelector:"tr."+Ext.baseCSSPrefix+"grid-header-row",selectedItemCls:Ext.baseCSSPrefix+"grid-row-selected",beforeSelectedItemCls:Ext.baseCSSPrefix+"grid-row-before-selected",selectedCellCls:Ext.baseCSSPrefix+"grid-cell-selected",focusedItemCls:Ext.baseCSSPrefix+"grid-row-focused",beforeFocusedItemCls:Ext.baseCSSPrefix+"grid-row-before-focused",tableFocusedFirstCls:Ext.baseCSSPrefix+"grid-table-focused-first",tableSelectedFirstCls:Ext.baseCSSPrefix+"grid-table-selected-first",tableOverFirstCls:Ext.baseCSSPrefix+"grid-table-over-first",overItemCls:Ext.baseCSSPrefix+"grid-row-over",beforeOverItemCls:Ext.baseCSSPrefix+"grid-row-before-over",altRowCls:Ext.baseCSSPrefix+"grid-row-alt",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",rowClsRe:new RegExp("(?:^|\\s*)"+Ext.baseCSSPrefix+"grid-row-(first|last|alt)(?:\\s+|$)","g"),cellRe:new RegExp(Ext.baseCSSPrefix+"grid-cell-([^\\s]+) ",""),positionBody:true,trackOver:true,getRowClass:null,stripeRows:true,markDirty:true,tpl:"{%values.view.tableTpl.applyOut(values, out)%}",tableTpl:["{%",'var view=values.view,tableCls=["'+Ext.baseCSSPrefix+'" + view.id + "-table '+Ext.baseCSSPrefix+'grid-table"];',"if (view.columnLines) tableCls[tableCls.length]=view.ownerCt.colLinesCls;","if (view.rowLines) tableCls[tableCls.length]=view.ownerCt.rowLinesCls;","%}",'<table role="presentation" id="{view.id}-table" class="{[tableCls.join(" ")]}" border="0" cellspacing="0" cellpadding="0" style="{tableStyle}" tabIndex="-1">',"{[view.renderColumnSizer(out)]}","{[view.renderTHead(values, out)]}","{[view.renderTFoot(values, out)]}",'<tbody id="{view.id}-body">',"{%","view.renderRows(values.rows, values.viewStartIndex, out);","%}","</tbody>","</table>",{priority:0}],rowTpl:["{%",'var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-data-row";',"%}",'<tr role="row" {[values.rowId ? ("id=\\"" + values.rowId + "\\"") : ""]} ','data-boundView="{view.id}" ','data-recordId="{record.internalId}" ','data-recordIndex="{recordIndex}" ','class="{[values.itemClasses.join(" ")]} {[values.rowClasses.join(" ")]}{[dataRowCls]}" ','{rowAttr:attributes} tabIndex="-1">','<tpl for="columns">'+"{%","parent.view.renderCell(values, parent.record, parent.recordIndex, xindex - 1, out, parent)","%}","</tpl>","</tr>",{priority:0}],cellTpl:['<td role="gridcell" class="{tdCls}" {tdAttr} id="{[Ext.id()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}"','style="text-align:{align};<tpl if="style">{style}</tpl>">{value}</div>',"</td>",{priority:0}],refreshSelmodelOnRefresh:false,tableValues:{},rowValues:{itemClasses:[],rowClasses:[]},cellValues:{classes:[Ext.baseCSSPrefix+"grid-cell "+Ext.baseCSSPrefix+"grid-td"]},renderBuffer:document.createElement("div"),constructor:function(config){if(config.grid.isTree){config.baseCls=Ext.baseCSSPrefix+"tree-view"}this.callParent([config])},initComponent:function(){var me=this,scroll=me.scroll;this.addEvents("beforecellclick","cellclick","beforecelldblclick","celldblclick","beforecellcontextmenu","cellcontextmenu","beforecellmousedown","cellmousedown","beforecellmouseup","cellmouseup","beforecellkeydown","cellkeydown");me.body=new Ext.dom.Element.Fly;me.body.id=me.id+"gridBody";me.autoScroll=undefined;if(!me.trackOver){me.overItemCls=null;me.beforeOverItemCls=null}if(scroll===true||scroll==="both"){me.autoScroll=true}else if(scroll==="horizontal"){me.overflowX="auto"}else if(scroll==="vertical"){me.overflowY="auto"}me.selModel.view=me;me.headerCt.view=me;me.grid.view=me;me.initFeatures(me.grid);delete me.grid;me.tpl=me.getTpl("tpl");me.itemSelector=me.getItemSelector();me.all=new Ext.view.NodeCache(me);me.callParent()},moveColumn:function(fromIdx,toIdx,colsToMove){var me=this,fragment=colsToMove>1?document.createDocumentFragment():undefined,destinationCellIdx=toIdx,colCount=me.getGridColumns().length,lastIndex=colCount-1,doFirstLastClasses=(me.firstCls||me.lastCls)&&(toIdx===0||toIdx==colCount||fromIdx===0||fromIdx==lastIndex),i,j,rows,len,tr,cells,tables;if(me.rendered&&toIdx!==fromIdx){rows=me.el.query(me.getDataRowSelector());if(toIdx>fromIdx&&fragment){destinationCellIdx-=colsToMove}for(i=0,len=rows.length;i<len;i++){tr=rows[i];cells=tr.childNodes;if(doFirstLastClasses){if(cells.length===1){Ext.fly(cells[0]).addCls(me.firstCls);Ext.fly(cells[0]).addCls(me.lastCls);continue}if(fromIdx===0){Ext.fly(cells[0]).removeCls(me.firstCls);Ext.fly(cells[1]).addCls(me.firstCls)}else if(fromIdx===lastIndex){Ext.fly(cells[lastIndex]).removeCls(me.lastCls);Ext.fly(cells[lastIndex-1]).addCls(me.lastCls)}if(toIdx===0){Ext.fly(cells[0]).removeCls(me.firstCls);Ext.fly(cells[fromIdx]).addCls(me.firstCls)}else if(toIdx===colCount){Ext.fly(cells[lastIndex]).removeCls(me.lastCls);Ext.fly(cells[fromIdx]).addCls(me.lastCls)}}if(fragment){for(j=0;j<colsToMove;j++){fragment.appendChild(cells[fromIdx])}tr.insertBefore(fragment,cells[destinationCellIdx]||null)}else{tr.insertBefore(cells[fromIdx],cells[destinationCellIdx]||null)}}tables=me.el.query(me.getBodySelector());for(i=0,len=tables.length;i<len;i++){tr=tables[i];if(fragment){for(j=0;j<colsToMove;j++){fragment.appendChild(tr.childNodes[fromIdx])}tr.insertBefore(fragment,tr.childNodes[destinationCellIdx]||null)}else{tr.insertBefore(tr.childNodes[fromIdx],tr.childNodes[destinationCellIdx]||null)}}}},scrollToTop:Ext.emptyFn,addElListener:function(eventName,fn,scope){this.mon(this,eventName,fn,scope,{element:"el"})},getGridColumns:function(){return this.ownerCt.columnManager.getColumns()},getHeaderAtIndex:function(index){return this.ownerCt.columnManager.getHeaderAtIndex(index)},getCell:function(record,column){var row=this.getNode(record,true);return Ext.fly(row).down(column.getCellSelector())},getFeature:function(id){var features=this.featuresMC;if(features){return features.get(id)}},findFeature:function(ftype){if(this.features){return Ext.Array.findBy(this.features,function(feature){if(feature.ftype===ftype){return true}})}},initFeatures:function(grid){var me=this,i,features,feature,len;me.tableTpl=Ext.XTemplate.getTpl(this,"tableTpl");me.rowTpl=Ext.XTemplate.getTpl(this,"rowTpl");me.cellTpl=Ext.XTemplate.getTpl(this,"cellTpl");me.featuresMC=new Ext.util.MixedCollection;features=me.features=me.constructFeatures();len=features?features.length:0;for(i=0;i<len;i++){feature=features[i];feature.view=me;feature.grid=grid;me.featuresMC.add(feature);feature.init(grid)}},renderTHead:function(values,out){var headers=values.view.headerFns,len,i;if(headers){for(i=0,len=headers.length;i<len;++i){headers[i].call(this,values,out)}}},addHeaderFn:function(){var headers=this.headerFns;if(!headers){headers=this.headerFns=[]}headers.push(fn)},renderTFoot:function(values,out){var footers=values.view.footerFns,len,i;if(footers){for(i=0,len=footers.length;i<len;++i){footers[i].call(this,values,out)}}},addFooterFn:function(fn){var footers=this.footerFns;if(!footers){footers=this.footerFns=[]}footers.push(fn)},addTableTpl:function(newTpl){return this.addTpl("tableTpl",newTpl)},addRowTpl:function(newTpl){return this.addTpl("rowTpl",newTpl)},addCellTpl:function(newTpl){return this.addTpl("cellTpl",newTpl)},addTpl:function(which,newTpl){var me=this,tpl,prevTpl;newTpl=Ext.Object.chain(newTpl);if(!newTpl.isTemplate){newTpl.applyOut=me.tplApplyOut}for(tpl=me[which];newTpl.priority<tpl.priority;tpl=tpl.nextTpl){prevTpl=tpl}if(prevTpl){prevTpl.nextTpl=newTpl}else{me[which]=newTpl}newTpl.nextTpl=tpl;return newTpl},tplApplyOut:function(values,out){if(this.before){if(this.before(values,out)===false){return}}this.nextTpl.applyOut(values,out);if(this.after){this.after(values,out)}},constructFeatures:function(){var me=this,features=me.features,feature,result,i=0,len;if(features){result=[];len=features.length;for(;i<len;i++){feature=features[i];if(!feature.isFeature){feature=Ext.create("feature."+feature.ftype,feature)}result[i]=feature}}return result},beforeRender:function(){var me=this;me.callParent();if(!me.enableTextSelection){me.protoEl.unselectable()}},onViewScroll:function(e,t){this.callParent(arguments);this.fireEvent("bodyscroll",e,t)},createRowElement:function(record,index){var me=this,div=me.renderBuffer;me.tpl.overwrite(div,me.collectData([record],index));return Ext.fly(div).down(me.getNodeContainerSelector(),true).firstChild},bufferRender:function(records,index){var me=this,div=me.renderBuffer;me.tpl.overwrite(div,me.collectData(records,index));return Ext.Array.toArray(Ext.fly(div).down(me.getNodeContainerSelector(),true).childNodes)},collectData:function(records,startIndex){this.rowValues.view=this;return{view:this,rows:records,viewStartIndex:startIndex,tableStyle:this.bufferedRenderer?"position:absolute;top:"+this.bufferedRenderer.bodyTop:""}},collectNodes:function(targetEl){this.all.fill(this.getNodeContainer().childNodes,this.all.startIndex)},refreshSize:function(){var me=this,grid,bodySelector=me.getBodySelector();if(bodySelector){me.body.attach(me.el.child(bodySelector,true))}if(!me.hasLoadingHeight){grid=me.up("tablepanel");Ext.suspendLayouts();me.callParent();grid.updateLayout();Ext.resumeLayouts(true)}},statics:{getBoundView:function(node){return Ext.getCmp(node.getAttribute("data-boundView"))}},getRecord:function(node){node=this.getNode(node);if(node){var recordIndex=node.getAttribute("data-recordIndex");if(recordIndex){recordIndex=parseInt(recordIndex,10);if(recordIndex>-1){return this.store.data.getAt(recordIndex)}}return this.dataSource.data.get(node.getAttribute("data-recordId"))}},indexOf:function(node){node=this.getNode(node,false);if(!node&&node!==0){return-1}return this.all.indexOf(node)},indexInStore:function(node){node=this.getNode(node,true);if(!node&&node!==0){return-1}var recordIndex=node.getAttribute("data-recordIndex");if(recordIndex){return parseInt(recordIndex,10)}return this.dataSource.indexOf(this.getRecord(node))},renderRows:function(rows,viewStartIndex,out){var rowValues=this.rowValues,rowCount=rows.length,i;rowValues.view=this;rowValues.columns=this.ownerCt.columnManager.getColumns();for(i=0;i<rowCount;i++,viewStartIndex++){rowValues.itemClasses.length=rowValues.rowClasses.length=0;this.renderRow(rows[i],viewStartIndex,out)}rowValues.view=rowValues.columns=rowValues.record=null},renderColumnSizer:function(out){var columns=this.getGridColumns(),len=columns.length,i,column,width;for(i=0;i<len;i++){column=columns[i];width=column.hidden?0:column.lastBox?column.lastBox.width:Ext.grid.header.Container.prototype.defaultWidth;out.push('<colgroup><col class="',Ext.baseCSSPrefix,"grid-cell-",columns[i].getItemId(),'" style="width:'+width+'px"></colgroup>')}},renderRow:function(record,rowIdx,out){var me=this,isMetadataRecord=rowIdx===-1,selModel=me.selModel,rowValues=me.rowValues,itemClasses=rowValues.itemClasses,rowClasses=rowValues.rowClasses,cls,rowTpl=me.rowTpl;rowValues.record=record;rowValues.recordId=record.internalId;rowValues.recordIndex=rowIdx;rowValues.rowId=me.getRowId(record);rowValues.itemCls=rowValues.rowCls="";if(!rowValues.columns){rowValues.columns=me.ownerCt.columnManager.getColumns()}itemClasses.length=rowClasses.length=0;if(!isMetadataRecord){itemClasses[0]=Ext.baseCSSPrefix+"grid-row";if(selModel&&selModel.isRowSelected){if(selModel.isRowSelected(rowIdx+1)){itemClasses.push(me.beforeSelectedItemCls)}if(selModel.isRowSelected(record)){itemClasses.push(me.selectedItemCls)}}if(me.stripeRows&&rowIdx%2!==0){rowClasses.push(me.altRowCls)}if(me.getRowClass){cls=me.getRowClass(record,rowIdx,null,me.dataSource);if(cls){rowClasses.push(cls)}}}if(out){rowTpl.applyOut(rowValues,out)}else{return rowTpl.apply(rowValues)}},renderCell:function(column,record,recordIndex,columnIndex,out){var me=this,selModel=me.selModel,cellValues=me.cellValues,classes=cellValues.classes,fieldValue=record.data[column.dataIndex],cellTpl=me.cellTpl,value,clsInsertPoint;cellValues.record=record;cellValues.column=column;cellValues.recordIndex=recordIndex;cellValues.columnIndex=columnIndex;cellValues.cellIndex=columnIndex;cellValues.align=column.align;cellValues.tdCls=column.tdCls;cellValues.innerCls=column.innerCls;cellValues.style=cellValues.tdAttr="";cellValues.unselectableAttr=me.enableTextSelection?"":'unselectable="on"';if(column.renderer&&column.renderer.call){value=column.renderer.call(column.scope||me.ownerCt,fieldValue,cellValues,record,recordIndex,columnIndex,me.dataSource,me);if(cellValues.css){record.cssWarning=true;cellValues.tdCls+=" "+cellValues.css;delete cellValues.css}}else{value=fieldValue}cellValues.value=value==null||value===""?"&#160;":value;classes[1]=Ext.baseCSSPrefix+"grid-cell-"+column.getItemId();clsInsertPoint=2;if(column.tdCls){classes[clsInsertPoint++]=column.tdCls}if(me.markDirty&&record.isModified(column.dataIndex)){classes[clsInsertPoint++]=me.dirtyCls}if(column.isFirstVisible){classes[clsInsertPoint++]=me.firstCls}if(column.isLastVisible){classes[clsInsertPoint++]=me.lastCls}if(!me.enableTextSelection){classes[clsInsertPoint++]=Ext.baseCSSPrefix+"unselectable"}classes[clsInsertPoint++]=cellValues.tdCls;if(selModel&&selModel.isCellSelected&&selModel.isCellSelected(me,recordIndex,columnIndex)){classes[clsInsertPoint++]=me.selectedCellCls}classes.length=clsInsertPoint;cellValues.tdCls=classes.join(" ");cellTpl.applyOut(cellValues,out);cellValues.column=null},getNode:function(nodeInfo,dataRow){var fly,result=this.callParent(arguments);if(result&&result.tagName){if(dataRow){if(!(fly=Ext.fly(result)).is(this.dataRowSelector)){return fly.down(this.dataRowSelector,true)}}else if(dataRow===false){if(!(fly=Ext.fly(result)).is(this.itemSelector)){return fly.up(this.itemSelector,null,true)}}}return result},getRowId:function(record){return this.id+"-record-"+record.internalId},constructRowId:function(internalId){return this.id+"-record-"+internalId},getNodeById:function(id,dataRow){id=this.constructRowId(id);return this.retrieveNode(id,dataRow)},getNodeByRecord:function(record,dataRow){var id=this.getRowId(record);return this.retrieveNode(id,dataRow)},retrieveNode:function(id,dataRow){var result=this.el.getById(id,true),itemSelector=this.itemSelector,fly;if(dataRow===false&&result){if(!(fly=Ext.fly(result)).is(itemSelector)){return fly.up(itemSelector,null,true)}}return result},updateIndexes:Ext.emptyFn,bodySelector:"table",nodeContainerSelector:"tbody",itemSelector:"tr."+Ext.baseCSSPrefix+"grid-row",dataRowSelector:"tr."+Ext.baseCSSPrefix+"grid-data-row",cellSelector:"td."+Ext.baseCSSPrefix+"grid-cell",sizerSelector:"col."+Ext.baseCSSPrefix+"grid-cell",innerSelector:"div."+Ext.baseCSSPrefix+"grid-cell-inner",getNodeContainer:function(){return this.el.down(this.nodeContainerSelector,true)},getBodySelector:function(){return this.bodySelector+"."+Ext.baseCSSPrefix+this.id+"-table"},getNodeContainerSelector:function(){return this.nodeContainerSelector},getColumnSizerSelector:function(header){return this.sizerSelector+"-"+header.getItemId()},getItemSelector:function(){return this.itemSelector},getDataRowSelector:function(){return this.dataRowSelector},getCellSelector:function(header){var result=this.cellSelector;if(header){result+="-"+header.getItemId()}return result},getCellInnerSelector:function(header){return this.getCellSelector(header)+" "+this.innerSelector},addRowCls:function(rowInfo,cls){var row=this.getNode(rowInfo,false);if(row){Ext.fly(row).addCls(cls)}},removeRowCls:function(rowInfo,cls){var row=this.getNode(rowInfo,false);if(row){Ext.fly(row).removeCls(cls)}},setHighlightedItem:function(item){var me=this,highlighted=me.highlightedItem;if(highlighted&&me.el.isAncestor(highlighted)&&me.isRowStyleFirst(highlighted)){me.getRowStyleTableEl(highlighted).removeCls(me.tableOverFirstCls)}if(item&&me.isRowStyleFirst(item)){me.getRowStyleTableEl(item).addCls(me.tableOverFirstCls)}me.callParent(arguments)},onRowSelect:function(rowIdx){var me=this;me.addRowCls(rowIdx,me.selectedItemCls);if(me.isRowStyleFirst(rowIdx)){me.getRowStyleTableEl(rowIdx).addCls(me.tableSelectedFirstCls)}else{me.addRowCls(rowIdx-1,me.beforeSelectedItemCls)}},onRowDeselect:function(rowIdx){var me=this;me.removeRowCls(rowIdx,[me.selectedItemCls,me.focusedItemCls]);if(me.isRowStyleFirst(rowIdx)){me.getRowStyleTableEl(rowIdx).removeCls([me.tableFocusedFirstCls,me.tableSelectedFirstCls])}else{me.removeRowCls(rowIdx-1,[me.beforeFocusedItemCls,me.beforeSelectedItemCls])}},onCellSelect:function(position){var cell=this.getCellByPosition(position);if(cell){cell.addCls(this.selectedCellCls);this.scrollCellIntoView(cell)}},onCellDeselect:function(position){var cell=this.getCellByPosition(position,true);if(cell){Ext.fly(cell).removeCls(this.selectedCellCls)}},getCellByPosition:function(position,returnDom){if(position){var row=this.getNode(position.row,true),header=this.ownerCt.columnManager.getHeaderAtIndex(position.column);if(header&&row){return Ext.fly(row).down(this.getCellSelector(header),returnDom)}}return false},getFocusEl:function(){var me=this,result;if(me.refreshCounter){result=me.focusedRow;if(!(result&&me.el.contains(result))){if(me.all.getCount()&&(result=me.getNode(me.all.item(0).dom,true))){me.focusRow(result)}else{result=me.body}}}else{return me.el}return Ext.get(result)},onRowFocus:function(rowIdx,highlight,supressFocus){var me=this;if(highlight){me.addRowCls(rowIdx,me.focusedItemCls);if(me.isRowStyleFirst(rowIdx)){me.getRowStyleTableEl(rowIdx).addCls(me.tableFocusedFirstCls)}else{me.addRowCls(rowIdx-1,me.beforeFocusedItemCls)}if(!supressFocus){me.focusRow(rowIdx)}}else{me.removeRowCls(rowIdx,me.focusedItemCls);if(me.isRowStyleFirst(rowIdx)){me.getRowStyleTableEl(rowIdx).removeCls(me.tableFocusedFirstCls)}else{me.removeRowCls(rowIdx-1,me.beforeFocusedItemCls)}}if((Ext.isIE6||Ext.isIE7)&&!me.ownerCt.rowLines){me.repaintRow(rowIdx)}},focus:function(selectText,delay){var me=this,saveScroll=Ext.isIE&&!delay,scrollPos;if(saveScroll){scrollPos=me.el.dom.scrollLeft}this.callParent(arguments);if(saveScroll){me.el.dom.scrollLeft=scrollPos}},focusRow:function(row,delay){var me=this,rowIdx,gridCollapsed=me.ownerCt&&me.ownerCt.collapsed,record;if(me.isVisible(true)&&!gridCollapsed&&(row=me.getNode(row,true))){me.scrollRowIntoView(row);record=me.getRecord(row);rowIdx=me.indexInStore(row);me.selModel.setLastFocused(record);me.focusedRow=row;me.focus(false,delay,function(){me.fireEvent("rowfocus",record,row,rowIdx)})}},scrollRowIntoView:function(row){row=this.getNode(row,true);if(row){Ext.fly(row).scrollIntoView(this.el,false)}},focusCell:function(position){var me=this,cell=me.getCellByPosition(position),record=me.getRecord(position.row);me.focusRow(record);if(cell){me.scrollCellIntoView(cell);me.fireEvent("cellfocus",record,cell,position)}},scrollCellIntoView:function(cell){if(cell.row!=null&&cell.column!=null){cell=this.getCellByPosition(cell)}if(cell){Ext.fly(cell).scrollIntoView(this.el,true)}},scrollByDelta:function(delta,dir){dir=dir||"scrollTop";var elDom=this.el.dom;elDom[dir]=elDom[dir]+=delta},isDataRow:function(row){return Ext.fly(row).hasCls(Ext.baseCSSPrefix+"grid-data-row")},syncRowHeights:function(firstRow,secondRow){firstRow=Ext.get(firstRow);secondRow=Ext.get(secondRow);firstRow.dom.style.height=secondRow.dom.style.height="";var me=this,rowTpl=me.rowTpl,firstRowHeight=firstRow.dom.offsetHeight,secondRowHeight=secondRow.dom.offsetHeight;if(firstRowHeight!==secondRowHeight){while(rowTpl){if(rowTpl.syncRowHeights){if(rowTpl.syncRowHeights(firstRow,secondRow)===false){break}}rowTpl=rowTpl.nextTpl}firstRowHeight=firstRow.dom.offsetHeight;secondRowHeight=secondRow.dom.offsetHeight;if(firstRowHeight!==secondRowHeight){firstRow=firstRow.down("[data-recordId]")||firstRow;secondRow=secondRow.down("[data-recordId]")||secondRow;if(firstRow&&secondRow){firstRow.dom.style.height=secondRow.dom.style.height="";firstRowHeight=firstRow.dom.offsetHeight;secondRowHeight=secondRow.dom.offsetHeight;if(firstRowHeight>secondRowHeight){firstRow.setHeight(firstRowHeight);secondRow.setHeight(firstRowHeight)}else if(secondRowHeight>firstRowHeight){firstRow.setHeight(secondRowHeight);secondRow.setHeight(secondRowHeight)}}}}},onIdChanged:function(store,rec,oldId,newId,oldInternalId){var me=this,rowDom;if(me.viewReady){rowDom=me.getNodeById(oldInternalId);if(rowDom){rowDom.setAttribute("data-recordId",rec.internalId);rowDom.id=me.getRowId(rec)}}},onUpdate:function(store,record,operation,changedFieldNames){var me=this,rowTpl=me.rowTpl,index,oldRow,oldRowDom,newRowDom,newAttrs,attLen,attName,attrIndex,overItemCls,beforeOverItemCls,focusedItemCls,beforeFocusedItemCls,selectedItemCls,beforeSelectedItemCls,columns;if(me.viewReady){oldRowDom=me.getNodeByRecord(record,false);if(oldRowDom){overItemCls=me.overItemCls;beforeOverItemCls=me.overItemCls;focusedItemCls=me.focusedItemCls;beforeFocusedItemCls=me.beforeFocusedItemCls;selectedItemCls=me.selectedItemCls;beforeSelectedItemCls=me.beforeSelectedItemCls;index=me.indexInStore(record);oldRow=Ext.fly(oldRowDom,"_internal");newRowDom=me.createRowElement(record,index);if(oldRow.hasCls(overItemCls)){Ext.fly(newRowDom).addCls(overItemCls)}if(oldRow.hasCls(beforeOverItemCls)){Ext.fly(newRowDom).addCls(beforeOverItemCls)}if(oldRow.hasCls(focusedItemCls)){Ext.fly(newRowDom).addCls(focusedItemCls)}if(oldRow.hasCls(beforeFocusedItemCls)){Ext.fly(newRowDom).addCls(beforeFocusedItemCls)}if(oldRow.hasCls(selectedItemCls)){Ext.fly(newRowDom).addCls(selectedItemCls)}if(oldRow.hasCls(beforeSelectedItemCls)){Ext.fly(newRowDom).addCls(beforeSelectedItemCls)}columns=me.ownerCt.columnManager.getColumns();if(Ext.isIE9m&&oldRowDom.mergeAttributes){oldRowDom.mergeAttributes(newRowDom,true)}else{newAttrs=newRowDom.attributes;attLen=newAttrs.length;for(attrIndex=0;attrIndex<attLen;attrIndex++){attName=newAttrs[attrIndex].name;if(attName!=="id"){oldRowDom.setAttribute(attName,newAttrs[attrIndex].value)}}}if(columns.length){me.updateColumns(record,me.getNode(oldRowDom,true),me.getNode(newRowDom,true),columns,changedFieldNames)}while(rowTpl){if(rowTpl.syncContent){if(rowTpl.syncContent(oldRowDom,newRowDom)===false){break}}rowTpl=rowTpl.nextTpl}me.fireEvent("itemupdate",record,index,oldRowDom);me.refreshSize()}}},updateColumns:function(record,oldRowDom,newRowDom,columns,changedFieldNames){var me=this,newAttrs,attLen,attName,attrIndex,colCount=columns.length,colIndex,column,oldCell,newCell,row,editingPlugin=me.editingPlugin||me.lockingPartner&&me.ownerCt.ownerLockable.view.editingPlugin,isEditing=editingPlugin&&editingPlugin.editing,cellSelector=me.getCellSelector();if(oldRowDom.mergeAttributes){oldRowDom.mergeAttributes(newRowDom,true)}else{newAttrs=newRowDom.attributes;attLen=newAttrs.length;for(attrIndex=0;attrIndex<attLen;attrIndex++){attName=newAttrs[attrIndex].name;if(attName!=="id"){oldRowDom.setAttribute(attName,newAttrs[attrIndex].value)}}}for(colIndex=0;colIndex<colCount;colIndex++){column=columns[colIndex];if(me.shouldUpdateCell(record,column,changedFieldNames)){cellSelector=me.getCellSelector(column);oldCell=Ext.DomQuery.selectNode(cellSelector,oldRowDom);newCell=Ext.DomQuery.selectNode(cellSelector,newRowDom);if(isEditing){Ext.fly(oldCell).syncContent(newCell)}else{row=oldCell.parentNode;row.insertBefore(newCell,oldCell);row.removeChild(oldCell)}}}},shouldUpdateCell:function(record,column,changedFieldNames){if(column.hasCustomRenderer||!changedFieldNames){return true}if(changedFieldNames){var len=changedFieldNames.length,i,field;for(i=0;i<len;++i){field=changedFieldNames[i];if(field===column.dataIndex||field===record.idProperty){return true}}}return false},refresh:function(){var me=this,hasFocus=me.el&&me.el.isAncestor(Ext.Element.getActiveElement());me.callParent(arguments);me.headerCt.setSortState();if(me.el&&!me.all.getCount()&&me.headerCt&&me.headerCt.tooNarrow){me.el.createChild({style:"position:absolute;height:1px;width:1px;left:"+(me.headerCt.getFullWidth()-1)+"px"})}if(hasFocus){me.selModel.onLastFocusChanged(null,me.selModel.lastFocused)}},processItemEvent:function(record,row,rowIndex,e){if(this.indexInStore(row)!==-1){var me=this,cell=e.getTarget(me.getCellSelector(),row),cellIndex,map=me.statics().EventMap,selModel=me.getSelectionModel(),type=e.type,features=me.features,len=features.length,i,result,feature,header;if(type=="keydown"&&!cell&&selModel.getCurrentPosition){cell=me.getCellByPosition(selModel.getCurrentPosition(),true)}if(cell){if(!cell.parentNode){return false}header=me.getHeaderByCell(cell);cellIndex=Ext.Array.indexOf(me.getGridColumns(),header)}else{cellIndex=-1}result=me.fireEvent("uievent",type,me,cell,rowIndex,cellIndex,e,record,row);if(result===false||me.callParent(arguments)===false){me.selModel.onVetoUIEvent(type,me,cell,rowIndex,cellIndex,e,record,row);return false}for(i=0;i<len;++i){feature=features[i];if(feature.wrapsItem){if(feature.vetoEvent(record,row,rowIndex,e)===false){me.processSpecialEvent(e);return false}}}if(type=="mouseover"||type=="mouseout"){return true}if(!cell){return true}return!(me["onBeforeCell"+map[type]](cell,cellIndex,record,row,rowIndex,e)===false||me.fireEvent("beforecell"+type,me,cell,cellIndex,record,row,rowIndex,e)===false||me["onCell"+map[type]](cell,cellIndex,record,row,rowIndex,e)===false||me.fireEvent("cell"+type,me,cell,cellIndex,record,row,rowIndex,e)===false)}else{this.processSpecialEvent(e);return false}},processSpecialEvent:function(e){var me=this,features=me.features,ln=features.length,type=e.type,i,feature,prefix,featureTarget,beforeArgs,args,panel=me.ownerCt;me.callParent(arguments);if(type=="mouseover"||type=="mouseout"){return}for(i=0;i<ln;i++){feature=features[i];if(feature.hasFeatureEvent){featureTarget=e.getTarget(feature.eventSelector,me.getTargetEl());if(featureTarget){prefix=feature.eventPrefix;beforeArgs=feature.getFireEventArgs("before"+prefix+type,me,featureTarget,e);args=feature.getFireEventArgs(prefix+type,me,featureTarget,e);if(me.fireEvent.apply(me,beforeArgs)===false||panel.fireEvent.apply(panel,beforeArgs)===false||me.fireEvent.apply(me,args)===false||panel.fireEvent.apply(panel,args)===false){return false}}}}return true},onCellMouseDown:Ext.emptyFn,onCellMouseUp:Ext.emptyFn,onCellClick:Ext.emptyFn,onCellDblClick:Ext.emptyFn,onCellContextMenu:Ext.emptyFn,onCellKeyDown:Ext.emptyFn,onBeforeCellMouseDown:Ext.emptyFn,onBeforeCellMouseUp:Ext.emptyFn,onBeforeCellClick:Ext.emptyFn,onBeforeCellDblClick:Ext.emptyFn,onBeforeCellContextMenu:Ext.emptyFn,onBeforeCellKeyDown:Ext.emptyFn,expandToFit:function(header){this.autoSizeColumn(header)},autoSizeColumn:function(header){if(Ext.isNumber(header)){header=this.getGridColumns[header]}if(header){if(header.isGroupHeader){header.autoSize();return}delete header.flex;header.setWidth(this.getMaxContentWidth(header))}},getMaxContentWidth:function(header){var me=this,cells=me.el.query(header.getCellInnerSelector()),originalWidth=header.getWidth(),i=0,ln=cells.length,hasPaddingBug=Ext.supports.ScrollWidthInlinePaddingBug,columnSizer=me.body.select(me.getColumnSizerSelector(header)),max=Math.max,paddingAdjust,maxWidth;if(hasPaddingBug&&ln>0){paddingAdjust=me.getCellPaddingAfter(cells[0])}columnSizer.setWidth(1);maxWidth=header.textEl.dom.offsetWidth+header.titleEl.getPadding("lr");for(;i<ln;i++){maxWidth=max(maxWidth,cells[i].scrollWidth)}if(hasPaddingBug){maxWidth+=paddingAdjust}maxWidth=max(maxWidth,40);columnSizer.setWidth(originalWidth);return maxWidth},getPositionByEvent:function(e){var me=this,cellNode=e.getTarget(me.cellSelector),rowNode=e.getTarget(me.itemSelector),record=me.getRecord(rowNode),header=me.getHeaderByCell(cellNode);return me.getPosition(record,header)},getHeaderByCell:function(cell){if(cell){var match=cell.className.match(this.cellRe);if(match&&match[1]){return this.ownerCt.columnManager.getHeaderById(match[1])}}return false},walkCells:function(pos,direction,e,preventWrap,verifierFn,scope){if(!pos){return false}var me=this,row=pos.row,column=pos.column,rowCount=me.dataSource.getCount(),lastCol=me.ownerCt.columnManager.getColumns().length-1,newRow=row,newColumn=column,activeHeader=me.ownerCt.columnManager.getHeaderAtIndex(column);if(!activeHeader||activeHeader.hidden||!rowCount){return false}e=e||{};direction=direction.toLowerCase();switch(direction){case"right":if(column===lastCol){if(preventWrap||row===rowCount-1){return false}if(!e.ctrlKey){newRow=me.walkRows(row,1);if(newRow!==row){newColumn=0}}}else{if(!e.ctrlKey){newColumn=column+1}else{newColumn=lastCol}}break;case"left":if(column===0){if(preventWrap||row===0){return false}if(!e.ctrlKey){newRow=me.walkRows(row,-1);if(newRow!==row){newColumn=lastCol}}}else{if(!e.ctrlKey){newColumn=column-1}else{newColumn=0}}break;case"up":if(row===0){return false}else{if(!e.ctrlKey){newRow=me.walkRows(row,-1)}else{newRow=me.walkRows(-1,1)}}break;case"down":if(row===rowCount-1){return false}else{if(!e.ctrlKey){newRow=me.walkRows(row,1)}else{newRow=me.walkRows(rowCount,-1)}}break}if(verifierFn&&verifierFn.call(scope||me,{row:newRow,column:newColumn})!==true){return false}else{return new Ext.grid.CellContext(me).setPosition(newRow,newColumn)}},walkRows:function(startRow,distance){var me=this,moved=0,lastValid=startRow,node,last=(me.dataSource.buffered?me.dataSource.getTotalCount():me.dataSource.getCount())-1,limit=distance<0?0:last,increment=limit?1:-1,result=startRow;do{if(limit?result>=limit:result<=0){return lastValid||limit}result+=increment;if((node=Ext.fly(me.getNode(result,true)))&&node.isVisible(true)){moved+=increment;lastValid=result}}while(moved!==distance);return result},walkRecs:function(startRec,distance){var me=this,moved=0,lastValid=startRec,node,last=(me.store.buffered?me.store.getTotalCount():me.store.getCount())-1,limit=distance<0?0:last,increment=limit?1:-1,testIndex=me.store.indexOf(startRec),rec;do{if(limit?testIndex>=limit:testIndex<=0){return lastValid}testIndex+=increment;rec=me.store.getAt(testIndex);if((node=Ext.fly(me.getNodeByRecord(rec,true)))&&node.isVisible(true)){moved+=increment;lastValid=rec}}while(moved!==distance);return lastValid},getFirstVisibleRowIndex:function(){var me=this,count=me.dataSource.buffered?me.dataSource.getTotalCount():me.dataSource.getCount(),result=me.indexOf(me.all.first())-1;do{result+=1;if(result===count){return}}while(!Ext.fly(me.getNode(result,true)).isVisible(true));return result},getLastVisibleRowIndex:function(){var me=this,result=me.indexOf(me.all.last());do{result-=1;if(result===-1){return}}while(!Ext.fly(me.getNode(result,true)).isVisible(true));return result},getHeaderCt:function(){return this.headerCt},getPosition:function(record,header){return new Ext.grid.CellContext(this).setPosition(record,header)},beforeDestroy:function(){var me=this;if(me.rendered){me.el.removeAllListeners()}me.callParent(arguments)},onDestroy:function(){var me=this,features=me.featuresMC,len,i;if(features){for(i=0,len=features.getCount();i<len;++i){features.getAt(i).destroy()}}me.featuresMC=null;this.callParent(arguments)},onAdd:function(ds,records,index){this.callParent(arguments);this.doStripeRows(index)},onRemove:function(ds,records,indexes){this.callParent(arguments);this.doStripeRows(indexes[0])},doStripeRows:function(startRow,endRow){var me=this,rows,rowsLn,i,row;if(me.rendered&&me.stripeRows){rows=me.getNodes(startRow,endRow);for(i=0,rowsLn=rows.length;i<rowsLn;i++){row=rows[i];row.className=row.className.replace(me.rowClsRe," ");startRow++;if(startRow%2===0){row.className+=" "+me.altRowCls}}}},repaintRow:function(rowIdx){var node=this.getNode(rowIdx),tds=node.childNodes,i=tds.length;while(i--){tds[i].className=tds[i].className}},getRowStyleTableEl:function(item){var me=this;if(!item.tagName){item=this.getNode(item)}return(me.isGrouping?Ext.fly(item):this.el).down("table.x-grid-table")},isRowStyleFirst:function(item){var me=this,index;if(item===-1){return false}if(!item.tagName){index=item;item=this.getNode(item)}else{index=me.indexOf(item);
}return!index||me.isGrouping&&Ext.fly(item).hasCls(Ext.baseCSSPrefix+"grid-group-row")},getCellPaddingAfter:function(cell){return Ext.fly(cell).getPadding("r")}});