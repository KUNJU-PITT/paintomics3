Ext.define("Ext.slider.Multi",{extend:"Ext.form.field.Base",alias:"widget.multislider",alternateClassName:"Ext.slider.MultiSlider",requires:["Ext.slider.Thumb","Ext.slider.Tip","Ext.Number","Ext.util.Format","Ext.Template","Ext.layout.component.field.Slider"],childEls:["endEl","innerEl"],fieldSubTpl:['<div id="{id}" class="'+Ext.baseCSSPrefix+"slider {fieldCls} {vertical}","{childElCls}",'" aria-valuemin="{minValue}" aria-valuemax="{maxValue}" aria-valuenow="{value}" aria-valuetext="{value}">','<div id="{cmpId}-endEl" class="'+Ext.baseCSSPrefix+'slider-end" role="presentation">','<div id="{cmpId}-innerEl" class="'+Ext.baseCSSPrefix+'slider-inner" role="presentation">',"{%this.renderThumbs(out, values)%}","</div>","</div>","</div>",{renderThumbs:function(out,values){var me=values.$comp,i=0,thumbs=me.thumbs,len=thumbs.length,thumb,thumbConfig;for(;i<len;i++){thumb=thumbs[i];thumbConfig=thumb.getElConfig();thumbConfig.id=me.id+"-thumb-"+i;Ext.DomHelper.generateMarkup(thumbConfig,out)}},disableFormats:true}],horizontalProp:"left",vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,constrainThumbs:true,componentLayout:"sliderfield",useTips:true,tipText:null,ariaRole:"slider",initValue:function(){var me=this,extValue=Ext.value,values=extValue(me.values,[extValue(me.value,extValue(me.minValue,0))]),i=0,len=values.length;me.originalValue=values;for(;i<len;i++){me.addThumb(values[i])}},initComponent:function(){var me=this,tipPlug,hasTip,p,pLen,plugins;me.thumbs=[];me.keyIncrement=Math.max(me.increment,me.keyIncrement);me.addEvents("beforechange","change","changecomplete","dragstart","drag","dragend");me.callParent();if(me.useTips){if(Ext.isObject(me.useTips)){tipPlug=Ext.apply({},me.useTips)}else{tipPlug=me.tipText?{getText:me.tipText}:{}}plugins=me.plugins=me.plugins||[];pLen=plugins.length;for(p=0;p<pLen;p++){if(plugins[p].isSliderTip){hasTip=true;break}}if(!hasTip){me.plugins.push(new Ext.slider.Tip(tipPlug))}}},addThumb:function(value){var me=this,thumb=new Ext.slider.Thumb({ownerCt:me,ownerLayout:me.getComponentLayout(),value:value,slider:me,index:me.thumbs.length,constrain:me.constrainThumbs,disabled:!!me.readOnly});me.thumbs.push(thumb);if(me.rendered){thumb.render()}return thumb},promoteThumb:function(topThumb){var thumbs=this.thumbs,ln=thumbs.length,zIndex,thumb,i;for(i=0;i<ln;i++){thumb=thumbs[i];if(thumb==topThumb){thumb.bringToFront()}else{thumb.sendToBack()}}},getSubTplData:function(){var me=this;return Ext.apply(me.callParent(),{$comp:me,vertical:me.vertical?Ext.baseCSSPrefix+"slider-vert":Ext.baseCSSPrefix+"slider-horz",minValue:me.minValue,maxValue:me.maxValue,value:me.value,childElCls:""})},onRender:function(){var me=this,thumbs=me.thumbs,len=thumbs.length,i=0,thumb;me.callParent(arguments);for(i=0;i<len;i++){thumb=thumbs[i];thumb.el=me.el.getById(me.id+"-thumb-"+i);thumb.onRender()}},initEvents:function(){var me=this;me.mon(me.el,{scope:me,mousedown:me.onMouseDown,keydown:me.onKeyDown})},onDragStart:Ext.emptyFn,onDragEnd:Ext.emptyFn,getTrackpoint:function(xy){var me=this,vertical=me.vertical,sliderTrack=me.innerEl,trackLength,result,positionProperty;if(vertical){positionProperty="top";trackLength=sliderTrack.getHeight()}else{positionProperty=me.horizontalProp;trackLength=sliderTrack.getWidth()}xy=me.transformTrackPoints(sliderTrack.translatePoints(xy));result=Ext.Number.constrain(xy[positionProperty],0,trackLength);return vertical?trackLength-result:result},transformTrackPoints:Ext.identityFn,onMouseDown:function(e){var me=this,thumbClicked=false,i=0,thumbs=me.thumbs,len=thumbs.length,trackPoint;if(me.disabled){return}for(;i<len;i++){thumbClicked=thumbClicked||e.target==thumbs[i].el.dom}if(me.clickToChange&&!thumbClicked){trackPoint=me.getTrackpoint(e.getXY());if(trackPoint!==undefined){me.onClickChange(trackPoint)}}me.focus()},onClickChange:function(trackPoint){var me=this,thumb,index;thumb=me.getNearest(trackPoint);if(!thumb.disabled){index=thumb.index;me.setValue(index,Ext.util.Format.round(me.reversePixelValue(trackPoint),me.decimalPrecision),undefined,true)}},getNearest:function(trackPoint){var me=this,clickValue=me.reversePixelValue(trackPoint),nearestDistance=me.getRange()+5,nearest=null,thumbs=me.thumbs,i=0,len=thumbs.length,thumb,value,dist;for(;i<len;i++){thumb=me.thumbs[i];value=thumb.value;dist=Math.abs(value-clickValue);if(Math.abs(dist<=nearestDistance)){nearest=thumb;nearestDistance=dist}}return nearest},onKeyDown:function(e){var me=this,k,val;if(me.disabled||me.thumbs.length!==1){e.preventDefault();return}k=e.getKey();switch(k){case e.UP:case e.RIGHT:e.stopEvent();val=e.ctrlKey?me.maxValue:me.getValue(0)+me.keyIncrement;me.setValue(0,val,undefined,true);break;case e.DOWN:case e.LEFT:e.stopEvent();val=e.ctrlKey?me.minValue:me.getValue(0)-me.keyIncrement;me.setValue(0,val,undefined,true);break;default:e.preventDefault()}},normalizeValue:function(v){var me=this,snapFn=me.zeroBasedSnapping?"snap":"snapInRange";v=Ext.Number[snapFn](v,me.increment,me.minValue,me.maxValue);v=Ext.util.Format.round(v,me.decimalPrecision);v=Ext.Number.constrain(v,me.minValue,me.maxValue);return v},setMinValue:function(val){var me=this,thumbs=me.thumbs,len=thumbs.length,thumb,i;me.minValue=val;if(me.rendered){me.inputEl.dom.setAttribute("aria-valuemin",val)}for(i=0;i<len;++i){thumb=thumbs[i];if(thumb.value<val){me.setValue(i,val,false)}}me.syncThumbs()},setMaxValue:function(val){var me=this,thumbs=me.thumbs,len=thumbs.length,thumb,i;me.maxValue=val;if(me.rendered){me.inputEl.dom.setAttribute("aria-valuemax",val)}for(i=0;i<len;++i){thumb=thumbs[i];if(thumb.value>val){me.setValue(i,val,false)}}me.syncThumbs()},setValue:function(index,value,animate,changeComplete){var me=this,thumbs=me.thumbs,thumb,len,i,values;if(Ext.isArray(index)){values=index;animate=value;for(i=0,len=values.length;i<len;++i){thumb=thumbs[i];if(thumb){me.setValue(i,values[i],animate)}}return me}thumb=me.thumbs[index];value=me.normalizeValue(value);if(value!==thumb.value&&me.fireEvent("beforechange",me,value,thumb.value,thumb)!==false){thumb.value=value;if(me.rendered){me.inputEl.set({"aria-valuenow":value,"aria-valuetext":value});thumb.move(me.calculateThumbPosition(value),Ext.isDefined(animate)?animate!==false:me.animate);me.fireEvent("change",me,value,thumb);me.checkDirty();if(changeComplete){me.fireEvent("changecomplete",me,value,thumb)}}}return me},calculateThumbPosition:function(v){var me=this,minValue=me.minValue,pos=(v-minValue)/me.getRange()*100;if(isNaN(pos)){pos=minValue}return pos},getRatio:function(){var me=this,innerEl=me.innerEl,trackLength=me.vertical?innerEl.getHeight():innerEl.getWidth(),valueRange=me.getRange();return valueRange===0?trackLength:trackLength/valueRange},getRange:function(){return this.maxValue-this.minValue},reversePixelValue:function(pos){return this.minValue+pos/this.getRatio()},reversePercentageValue:function(pos){return this.minValue+this.getRange()*(pos/100)},onDisable:function(){var me=this,i=0,thumbs=me.thumbs,len=thumbs.length,thumb,el,xy;me.callParent();for(;i<len;i++){thumb=thumbs[i];el=thumb.el;thumb.disable();if(Ext.isIE){xy=el.getXY();el.hide();me.innerEl.addCls(me.disabledCls).dom.disabled=true;if(!me.thumbHolder){me.thumbHolder=me.endEl.createChild({cls:Ext.baseCSSPrefix+"slider-thumb "+me.disabledCls})}me.thumbHolder.show().setXY(xy)}}},onEnable:function(){var me=this,i=0,thumbs=me.thumbs,len=thumbs.length,thumb,el;this.callParent();for(;i<len;i++){thumb=thumbs[i];el=thumb.el;thumb.enable();if(Ext.isIE){me.innerEl.removeCls(me.disabledCls).dom.disabled=false;if(me.thumbHolder){me.thumbHolder.hide()}el.show();me.syncThumbs()}}},syncThumbs:function(){if(this.rendered){var thumbs=this.thumbs,length=thumbs.length,i=0;for(;i<length;i++){thumbs[i].move(this.calculateThumbPosition(thumbs[i].value))}}},getValue:function(index){return Ext.isNumber(index)?this.thumbs[index].value:this.getValues()},getValues:function(){var values=[],i=0,thumbs=this.thumbs,len=thumbs.length;for(;i<len;i++){values.push(thumbs[i].value)}return values},getSubmitValue:function(){var me=this;return me.disabled||!me.submitValue?null:me.getValue()},reset:function(){var me=this,arr=[].concat(me.originalValue),a=0,aLen=arr.length,val;for(;a<aLen;a++){val=arr[a];me.setValue(a,val)}me.clearInvalid();delete me.wasValid},setReadOnly:function(readOnly){var me=this,thumbs=me.thumbs,len=thumbs.length,i=0;me.callParent(arguments);readOnly=me.readOnly;for(;i<len;++i){if(readOnly){thumbs[i].disable()}else{thumbs[i].enable()}}},beforeDestroy:function(){var me=this,thumbs=me.thumbs,t=0,tLen=thumbs.length,thumb;Ext.destroy(me.innerEl,me.endEl,me.focusEl);for(;t<tLen;t++){thumb=thumbs[t];Ext.destroy(thumb)}me.callParent()}});