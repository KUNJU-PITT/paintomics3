Ext.define("Ext.LoadMask",{extend:"Ext.Component",alias:"widget.loadmask",mixins:{floating:"Ext.util.Floating",bindable:"Ext.util.Bindable"},uses:["Ext.data.StoreManager"],msg:"Loading...",msgCls:Ext.baseCSSPrefix+"mask-loading",maskCls:Ext.baseCSSPrefix+"mask",useMsg:true,useTargetEl:false,baseCls:Ext.baseCSSPrefix+"mask-msg",childEls:["msgEl","msgTextEl"],renderTpl:['<div id="{id}-msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner{childElCls}">','<div id="{id}-msgTextEl" class="',Ext.baseCSSPrefix,"mask-msg-text",'{childElCls}"></div>',"</div>"],floating:{shadow:"frame"},focusOnToFront:false,bringParentToFront:false,constructor:function(config){var me=this,comp;if(arguments.length===2){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.LoadMask: LoadMask now uses a standard 1 arg constructor: use the target config")}comp=config;config=arguments[1]}else{comp=config.target}if(!comp.isComponent){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.LoadMask: LoadMask for elements has been deprecated, use Ext.dom.Element.mask & Ext.dom.Element.unmask")}comp=Ext.get(comp);this.isElement=true}me.ownerCt=comp;if(!this.isElement){me.bindComponent(comp)}me.callParent([config]);if(me.store){me.bindStore(me.store,true)}},bindComponent:function(comp){var me=this,listeners={scope:this,resize:me.sizeMask,added:me.onComponentAdded,removed:me.onComponentRemoved};if(comp.floating){listeners.move=me.sizeMask;me.activeOwner=comp}else if(comp.ownerCt){me.onComponentAdded(comp.ownerCt)}else{me.preventBringToFront=true}me.mon(comp,listeners);me.mon(me.hierarchyEventSource,{show:me.onContainerShow,hide:me.onContainerHide,expand:me.onContainerExpand,collapse:me.onContainerCollapse,scope:me})},onComponentAdded:function(owner){var me=this;delete me.activeOwner;me.floatParent=owner;if(!owner.floating){owner=owner.up("[floating]")}if(owner){me.activeOwner=owner;me.mon(owner,"move",me.sizeMask,me)}else{me.preventBringToFront=true}owner=me.floatParent.ownerCt;if(me.rendered&&me.isVisible()&&owner){me.floatOwner=owner;me.mon(owner,"afterlayout",me.sizeMask,me,{single:true})}},onComponentRemoved:function(owner){var me=this,activeOwner=me.activeOwner,floatOwner=me.floatOwner;if(activeOwner){me.mun(activeOwner,"move",me.sizeMask,me)}if(floatOwner){me.mun(floatOwner,"afterlayout",me.sizeMask,me)}delete me.activeOwner;delete me.floatOwner},afterRender:function(){this.callParent(arguments);this.container=this.floatParent.getContentTarget()},onContainerShow:function(container){if(this.isActiveContainer(container)){this.onComponentShow()}},onContainerHide:function(container){if(this.isActiveContainer(container)){this.onComponentHide()}},onContainerExpand:function(container){if(this.isActiveContainer(container)){this.onComponentShow()}},onContainerCollapse:function(container){if(this.isActiveContainer(container)){this.onComponentHide()}},isActiveContainer:function(container){return this.isDescendantOf(container)},onComponentHide:function(){var me=this;if(me.rendered&&me.isVisible()){me.hide();me.showNext=true}},onComponentShow:function(){if(this.showNext){this.show()}delete this.showNext},sizeMask:function(){var me=this,target;if(me.rendered&&me.isVisible()){me.center();target=me.getMaskTarget();me.getMaskEl().show().setSize(target.getSize()).alignTo(target,"tl-tl")}},bindStore:function(store,initial){var me=this;me.mixins.bindable.bindStore.apply(me,arguments);store=me.store;if(store&&store.isLoading()){me.onBeforeLoad()}},getStoreListeners:function(store){var load=this.onLoad,beforeLoad=this.onBeforeLoad,result={cachemiss:beforeLoad,cachefilled:load};if(!store.proxy.isSynchronous){result.beforeLoad=beforeLoad;result.load=load}return result},onDisable:function(){this.callParent(arguments);if(this.loading){this.onLoad()}},getOwner:function(){return this.ownerCt||this.floatParent},getMaskTarget:function(){var owner=this.getOwner();return this.useTargetEl?owner.getTargetEl():owner.getEl()},onBeforeLoad:function(){var me=this,owner=me.getOwner(),origin;if(!me.disabled){me.loading=true;if(owner.componentLayoutCounter){me.maybeShow()}else{origin=owner.afterComponentLayout;owner.afterComponentLayout=function(){owner.afterComponentLayout=origin;origin.apply(owner,arguments);me.maybeShow()}}}},maybeShow:function(){var me=this,owner=me.getOwner();if(!owner.isVisible(true)){me.showNext=true}else if(me.loading&&owner.rendered){me.show()}},getMaskEl:function(){var me=this;return me.maskEl||(me.maskEl=me.el.insertSibling({cls:me.maskCls,style:{zIndex:me.el.getStyle("zIndex")-2}},"before"))},onShow:function(){var me=this,msgEl=me.msgEl;me.callParent(arguments);me.loading=true;if(me.useMsg){msgEl.show();me.msgTextEl.update(me.msg)}else{msgEl.parent().hide()}},hide:function(){if(this.isElement){this.ownerCt.unmask();this.fireEvent("hide",this);return}delete this.showNext;return this.callParent(arguments)},onHide:function(){this.callParent();this.getMaskEl().hide()},show:function(){if(this.isElement){this.ownerCt.mask(this.useMsg?this.msg:"",this.msgCls);this.fireEvent("show",this);return}return this.callParent(arguments)},afterShow:function(){this.callParent(arguments);this.sizeMask()},setZIndex:function(index){var me=this,owner=me.activeOwner;if(owner){index=parseInt(owner.el.getStyle("zIndex"),10)+1}me.getMaskEl().setStyle("zIndex",index-1);return me.mixins.floating.setZIndex.apply(me,arguments)},onLoad:function(){this.loading=false;this.hide()},onDestroy:function(){var me=this;if(me.isElement){me.ownerCt.unmask()}Ext.destroy(me.maskEl);me.callParent()}});