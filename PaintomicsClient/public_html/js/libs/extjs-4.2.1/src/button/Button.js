Ext.define("Ext.button.Button",{alias:"widget.button",extend:"Ext.Component",requires:["Ext.button.Manager","Ext.menu.Manager","Ext.util.ClickRepeater","Ext.layout.component.Button","Ext.util.TextMetrics","Ext.util.KeyMap"],mixins:{queryable:"Ext.Queryable"},alternateClassName:"Ext.Button",isButton:true,componentLayout:"button",hidden:false,disabled:false,pressed:false,tabIndex:0,enableToggle:false,menuAlign:"tl-bl?",showEmptyMenu:false,textAlign:"center",clickEvent:"click",preventDefault:true,handleMouseEvents:true,tooltipType:"qtip",baseCls:Ext.baseCSSPrefix+"btn",pressedCls:"pressed",overCls:"over",focusCls:"focus",menuActiveCls:"menu-active",hrefTarget:"_blank",childEls:["btnEl","btnWrap","btnInnerEl","btnIconEl"],renderTpl:['<span id="{id}-btnWrap" class="{baseCls}-wrap','<tpl if="splitCls"> {splitCls}</tpl>','{childElCls}" unselectable="on">','<span id="{id}-btnEl" class="{baseCls}-button">','<span id="{id}-btnInnerEl" class="{baseCls}-inner {innerCls}','{childElCls}" unselectable="on">',"{text}","</span>",'<span role="img" id="{id}-btnIconEl" class="{baseCls}-icon-el {iconCls}','{childElCls} {glyphCls}" unselectable="on" style="','<tpl if="iconUrl">background-image:url({iconUrl});</tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>">','<tpl if="glyph">&#{glyph};</tpl><tpl if="iconCls || iconUrl">&#160;</tpl>',"</span>","</span>","</span>",'<tpl if="closable">','<span id="{id}-closeEl" class="{baseCls}-close-btn" title="{closeText}" tabIndex="0"></span>',"</tpl>"],scale:"small",allowedScales:["small","medium","large"],iconAlign:"left",arrowAlign:"right",arrowCls:"arrow",maskOnDisable:false,shrinkWrap:3,frame:true,_triggerRegion:{},initComponent:function(){var me=this;me.autoEl={tag:"a",role:"button",hidefocus:"on",unselectable:"on"};me.addCls("x-unselectable");me.callParent(arguments);me.addEvents("click","toggle","mouseover","mouseout","menushow","menuhide","menutriggerover","menutriggerout","textchange","iconchange","glyphchange");if(me.menu){me.split=true;me.menu=Ext.menu.Manager.get(me.menu);me.menu.ownerButton=me}if(me.url){me.href=me.url}if(me.href&&!me.hasOwnProperty("preventDefault")){me.preventDefault=false}if(Ext.isString(me.toggleGroup)&&me.toggleGroup!==""){me.enableToggle=true}if(me.html&&!me.text){me.text=me.html;delete me.html}me.glyphCls=me.baseCls+"-glyph"},getActionEl:function(){return this.el},getFocusEl:function(){return this.el},onDisable:function(){this.callParent(arguments)},setComponentCls:function(){var me=this,cls=me.getComponentCls();if(!Ext.isEmpty(me.oldCls)){me.removeClsWithUI(me.oldCls);me.removeClsWithUI(me.pressedCls)}me.oldCls=cls;me.addClsWithUI(cls)},getComponentCls:function(){var me=this,cls;if(me.iconCls||me.icon||me.glyph){cls=[me.text?"icon-text-"+me.iconAlign:"icon"]}else if(me.text){cls=["noicon"]}else{cls=[]}if(me.pressed){cls[cls.length]=me.pressedCls}return cls},beforeRender:function(){var me=this,autoEl=me.autoEl,href=me.getHref(),hrefTarget=me.hrefTarget;if(!me.disabled){autoEl.tabIndex=me.tabIndex}if(href){autoEl.href=href;if(hrefTarget){autoEl.target=hrefTarget}}me.callParent();me.oldCls=me.getComponentCls();me.addClsWithUI(me.oldCls);Ext.applyIf(me.renderData,me.getTemplateArgs())},onRender:function(){var me=this,addOnclick,btn,btnListeners;me.doc=Ext.getDoc();me.callParent(arguments);btn=me.el;if(me.tooltip){me.setTooltip(me.tooltip,true)}if(me.handleMouseEvents){btnListeners={scope:me,mouseover:me.onMouseOver,mouseout:me.onMouseOut,mousedown:me.onMouseDown};if(me.split){btnListeners.mousemove=me.onMouseMove}}else{btnListeners={scope:me}}if(me.menu){me.mon(me.menu,{scope:me,show:me.onMenuShow,hide:me.onMenuHide});me.keyMap=new Ext.util.KeyMap({target:me.el,key:Ext.EventObject.DOWN,handler:me.onDownKey,scope:me})}if(me.repeat){me.mon(new Ext.util.ClickRepeater(btn,Ext.isObject(me.repeat)?me.repeat:{}),"click",me.onRepeatClick,me)}else{if(btnListeners[me.clickEvent]){addOnclick=true}else{btnListeners[me.clickEvent]=me.onClick}}me.mon(btn,btnListeners);if(addOnclick){me.mon(btn,me.clickEvent,me.onClick,me)}Ext.button.Manager.register(me)},getTemplateArgs:function(){var me=this,glyph=me.glyph,glyphFontFamily=Ext._glyphFontFamily,glyphParts;if(typeof glyph==="string"){glyphParts=glyph.split("@");glyph=glyphParts[0];glyphFontFamily=glyphParts[1]}return{innerCls:me.getInnerCls(),splitCls:me.getSplitCls(),iconUrl:me.icon,iconCls:me.iconCls,glyph:glyph,glyphCls:glyph?me.glyphCls:"",glyphFontFamily:glyphFontFamily,text:me.text||"&#160;"}},setHref:function(href){this.href=href;this.el.dom.href=this.getHref()},getHref:function(){var me=this,href=me.href;return href?Ext.urlAppend(href,Ext.Object.toQueryString(Ext.apply({},me.params,me.baseParams))):false},setParams:function(params){this.params=params;this.el.dom.href=this.getHref()},getSplitCls:function(){var me=this;return me.split?me.baseCls+"-"+me.arrowCls+" "+(me.baseCls+"-"+me.arrowCls+"-"+me.arrowAlign):""},getInnerCls:function(){return this.textAlign?this.baseCls+"-inner-"+this.textAlign:""},setIcon:function(icon){icon=icon||"";var me=this,btnIconEl=me.btnIconEl,oldIcon=me.icon||"";me.icon=icon;if(icon!=oldIcon){if(btnIconEl){btnIconEl.setStyle("background-image",icon?"url("+icon+")":"");me.setComponentCls();if(me.didIconStateChange(oldIcon,icon)){me.updateLayout()}}me.fireEvent("iconchange",me,oldIcon,icon)}return me},setIconCls:function(cls){cls=cls||"";var me=this,btnIconEl=me.btnIconEl,oldCls=me.iconCls||"";me.iconCls=cls;if(oldCls!=cls){if(btnIconEl){btnIconEl.removeCls(oldCls);btnIconEl.addCls(cls);me.setComponentCls();if(me.didIconStateChange(oldCls,cls)){me.updateLayout()}}me.fireEvent("iconchange",me,oldCls,cls)}return me},setGlyph:function(glyph){glyph=glyph||0;var me=this,btnIconEl=me.btnIconEl,oldGlyph=me.glyph,fontFamily,glyphParts;me.glyph=glyph;if(btnIconEl){if(typeof glyph==="string"){glyphParts=glyph.split("@");glyph=glyphParts[0];fontFamily=glyphParts[1]||Ext._glyphFontFamily}if(!glyph){btnIconEl.dom.innerHTML=""}else if(oldGlyph!=glyph){btnIconEl.dom.innerHTML="&#"+glyph+";"}if(fontFamily){btnIconEl.setStyle("font-family",fontFamily)}}me.fireEvent("glyphchange",me,me.glyph,oldGlyph);return me},setTooltip:function(tooltip,initial){var me=this;if(me.rendered){if(!initial||!tooltip){me.clearTip()}if(tooltip){if(Ext.quickTipsActive&&Ext.isObject(tooltip)){Ext.tip.QuickTipManager.register(Ext.apply({target:me.el.id},tooltip));me.tooltip=tooltip}else{me.el.dom.setAttribute(me.getTipAttr(),tooltip)}}}else{me.tooltip=tooltip}return me},setTextAlign:function(align){var me=this,btnEl=me.btnEl;if(btnEl){btnEl.removeCls(me.baseCls+"-inner-"+me.textAlign);btnEl.addCls(me.baseCls+"-inner-"+align)}me.textAlign=align;return me},getTipAttr:function(){return this.tooltipType=="qtip"?"data-qtip":"title"},getRefItems:function(deep){var menu=this.menu,items;if(menu){items=menu.getRefItems(deep);items.unshift(menu)}return items||[]},clearTip:function(){var me=this,el=me.el;if(Ext.quickTipsActive&&Ext.isObject(me.tooltip)){Ext.tip.QuickTipManager.unregister(el)}else{el.dom.removeAttribute(me.getTipAttr())}},beforeDestroy:function(){var me=this;if(me.rendered){me.clearTip()}if(me.menu&&me.destroyMenu!==false){Ext.destroy(me.menu)}Ext.destroy(me.btnInnerEl,me.repeater);me.callParent()},onDestroy:function(){var me=this;if(me.rendered){me.doc.un("mouseover",me.monitorMouseOver,me);delete me.doc;Ext.destroy(me.keyMap);delete me.keyMap}Ext.button.Manager.unregister(me);me.callParent()},setHandler:function(handler,scope){this.handler=handler;this.scope=scope;return this},setText:function(text){text=text||"";var me=this,oldText=me.text||"";if(text!=oldText){me.text=text;if(me.rendered){me.btnInnerEl.update(text||"&#160;");me.setComponentCls();if(Ext.isStrict&&Ext.isIE8){me.el.repaint()}me.updateLayout()}me.fireEvent("textchange",me,oldText,text)}return me},didIconStateChange:function(old,current){var currentEmpty=Ext.isEmpty(current);return Ext.isEmpty(old)?!currentEmpty:currentEmpty},getText:function(){return this.text},toggle:function(state,suppressEvent){var me=this;state=state===undefined?!me.pressed:!!state;if(state!==me.pressed){if(me.rendered){me[state?"addClsWithUI":"removeClsWithUI"](me.pressedCls)}me.pressed=state;if(!suppressEvent){me.fireEvent("toggle",me,state);Ext.callback(me.toggleHandler,me.scope||me,[me,state])}}return me},maybeShowMenu:function(){var me=this;if(me.menu&&!me.hasVisibleMenu()&&!me.ignoreNextClick){me.showMenu(true)}},showMenu:function(fromEvent){var me=this,menu=me.menu;if(me.rendered){if(me.tooltip&&Ext.quickTipsActive&&me.getTipAttr()!="title"){Ext.tip.QuickTipManager.getQuickTip().cancelShow(me.el)}if(menu.isVisible()){menu.hide()}if(!fromEvent||me.showEmptyMenu||menu.items.getCount()>0){menu.showBy(me.el,me.menuAlign)}}return me},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide()}return this},hasVisibleMenu:function(){var menu=this.menu;return menu&&menu.rendered&&menu.isVisible()},onRepeatClick:function(repeat,e){this.onClick(e)},onClick:function(e){var me=this;if(me.preventDefault||me.disabled&&me.getHref()&&e){e.preventDefault()}if(e.type!=="keydown"&&e.button!==0){return}if(!me.disabled){me.doToggle();me.maybeShowMenu();me.fireHandler(e)}},fireHandler:function(e){var me=this,handler=me.handler;if(me.fireEvent("click",me,e)!==false){if(handler){handler.call(me.scope||me,me,e)}}},doToggle:function(){var me=this;if(me.enableToggle&&(me.allowDepress!==false||!me.pressed)){me.toggle()}},onMouseOver:function(e){var me=this;if(!me.disabled&&!e.within(me.el,true,true)){me.onMouseEnter(e)}},onMouseOut:function(e){var me=this;if(!e.within(me.el,true,true)){if(me.overMenuTrigger){me.onMenuTriggerOut(e)}me.onMouseLeave(e)}},onMouseMove:function(e){var me=this,el=me.el,over=me.overMenuTrigger,overPosition,triggerRegion;if(me.split){overPosition=me.arrowAlign==="right"?e.getX()-me.getX():e.getY()-el.getY();triggerRegion=me.getTriggerRegion();if(overPosition>triggerRegion.begin&&overPosition<triggerRegion.end){if(!over){me.onMenuTriggerOver(e)}}else{if(over){me.onMenuTriggerOut(e)}}}},getTriggerRegion:function(){var me=this,region=me._triggerRegion,triggerSize=me.getTriggerSize(),btnSize=me.arrowAlign==="right"?me.getWidth():me.getHeight();region.begin=btnSize-triggerSize;region.end=btnSize;return region},getTriggerSize:function(){var me=this,size=me.triggerSize,side,sideFirstLetter;if(size==null){side=me.arrowAlign;sideFirstLetter=side.charAt(0);size=me.triggerSize=me.el.getFrameWidth(sideFirstLetter)+me.getBtnWrapFrameWidth(sideFirstLetter);if(me.frameSize){size=me.triggerSize+=me.frameSize[side]}}return size},getBtnWrapFrameWidth:function(side){return this.btnWrap.getFrameWidth(side)},addOverCls:function(){if(!this.disabled){this.addClsWithUI(this.overCls)}},removeOverCls:function(){this.removeClsWithUI(this.overCls)},onMouseEnter:function(e){this.fireEvent("mouseover",this,e)},onMouseLeave:function(e){this.fireEvent("mouseout",this,e)},onMenuTriggerOver:function(e){var me=this,arrowTip=me.arrowTooltip;me.overMenuTrigger=true;if(me.split&&arrowTip){me.btnWrap.dom.setAttribute(me.getTipAttr(),arrowTip)}me.fireEvent("menutriggerover",me,me.menu,e)},onMenuTriggerOut:function(e){var me=this;delete me.overMenuTrigger;if(me.split&&me.arrowTooltip){me.btnWrap.dom.setAttribute(me.getTipAttr(),"")}me.fireEvent("menutriggerout",me,me.menu,e)},enable:function(silent){var me=this;me.callParent(arguments);me.removeClsWithUI("disabled");if(me.rendered){me.el.dom.setAttribute("tabIndex",me.tabIndex)}return me},disable:function(silent){var me=this;me.callParent(arguments);me.addClsWithUI("disabled");me.removeClsWithUI(me.overCls);if(me.rendered){me.el.dom.removeAttribute("tabIndex")}if(me.btnInnerEl&&Ext.isIE7m){me.btnInnerEl.repaint()}return me},setScale:function(scale){var me=this,ui=me.ui.replace("-"+me.scale,"");if(!Ext.Array.contains(me.allowedScales,scale)){throw"#setScale: scale must be an allowed scale ("+me.allowedScales.join(", ")+")"}me.scale=scale;me.setUI(ui)},setUI:function(ui){var me=this;if(me.scale&&!ui.match(me.scale)){ui=ui+"-"+me.scale}me.callParent([ui])},onMouseDown:function(e){var me=this;if(Ext.isIE){me.getFocusEl().focus()}if(!me.disabled&&e.button===0){Ext.button.Manager.onButtonMousedown(me,e);me.addClsWithUI(me.pressedCls)}},onMouseUp:function(e){var me=this;if(e.button===0){if(!me.pressed){me.removeClsWithUI(me.pressedCls)}}},onMenuShow:function(e){var me=this;me.ignoreNextClick=0;me.addClsWithUI(me.menuActiveCls);me.fireEvent("menushow",me,me.menu)},onMenuHide:function(e){var me=this;me.removeClsWithUI(me.menuActiveCls);me.ignoreNextClick=Ext.defer(me.restoreClick,250,me);me.fireEvent("menuhide",me,me.menu);me.focus()},restoreClick:function(){this.ignoreNextClick=0},onDownKey:function(k,e){var me=this;if(me.menu&&!me.disabled){me.showMenu();e.stopEvent();return false}}});