Ext.define("Ext.draw.Sprite",{mixins:{observable:"Ext.util.Observable",animate:"Ext.util.Animate"},requires:["Ext.draw.SpriteDD"],dirty:false,dirtyHidden:false,dirtyTransform:false,dirtyPath:true,dirtyFont:true,zIndexDirty:true,isSprite:true,zIndex:0,fontProperties:["font","font-size","font-weight","font-style","font-family","text-anchor","text"],pathProperties:["x","y","d","path","height","width","radius","r","rx","ry","cx","cy"],constructor:function(config){var me=this;config=Ext.merge({},config||{});me.id=Ext.id(null,"ext-sprite-");me.transformations=[];Ext.copyTo(this,config,"surface,group,type,draggable");me.bbox={};me.attr={zIndex:0,translation:{x:null,y:null},rotation:{degrees:null,x:null,y:null},scaling:{x:null,y:null,cx:null,cy:null}};delete config.surface;delete config.group;delete config.type;delete config.draggable;me.setAttributes(config);me.addEvents("beforedestroy","destroy","render","mousedown","mouseup","mouseover","mouseout","mousemove","click");me.mixins.observable.constructor.apply(this,arguments)},initDraggable:function(){var me=this;if(!me.el){me.surface.createSpriteElement(me)}me.dd=new Ext.draw.SpriteDD(me,Ext.isBoolean(me.draggable)?null:me.draggable);me.on("beforedestroy",me.dd.destroy,me.dd)},setAttributes:function(attrs,redraw){var me=this,fontProps=me.fontProperties,fontPropsLength=fontProps.length,pathProps=me.pathProperties,pathPropsLength=pathProps.length,hasSurface=!!me.surface,custom=hasSurface&&me.surface.customAttributes||{},spriteAttrs=me.attr,dirtyBBox=false,attr,i,newTranslation,translation,newRotate,rotation,newScaling,scaling;attrs=Ext.apply({},attrs);for(attr in custom){if(attrs.hasOwnProperty(attr)&&typeof custom[attr]=="function"){Ext.apply(attrs,custom[attr].apply(me,[].concat(attrs[attr])))}}if(!!attrs.hidden!==!!spriteAttrs.hidden){me.dirtyHidden=true}for(i=0;i<pathPropsLength;i++){attr=pathProps[i];if(attr in attrs&&attrs[attr]!==spriteAttrs[attr]){me.dirtyPath=true;dirtyBBox=true;break}}if("zIndex"in attrs){me.zIndexDirty=true}if("text"in attrs){me.dirtyFont=true;dirtyBBox=true}for(i=0;i<fontPropsLength;i++){attr=fontProps[i];if(attr in attrs&&attrs[attr]!==spriteAttrs[attr]){me.dirtyFont=true;dirtyBBox=true;break}}newTranslation=attrs.translation||attrs.translate;delete attrs.translate;delete attrs.translation;translation=spriteAttrs.translation;if(newTranslation){if("x"in newTranslation&&newTranslation.x!==translation.x||"y"in newTranslation&&newTranslation.y!==translation.y){me.dirtyTransform=true;translation.x=newTranslation.x;translation.y=newTranslation.y}}newRotate=attrs.rotation||attrs.rotate;rotation=spriteAttrs.rotation;delete attrs.rotate;delete attrs.rotation;if(newRotate){if("x"in newRotate&&newRotate.x!==rotation.x||"y"in newRotate&&newRotate.y!==rotation.y||"degrees"in newRotate&&newRotate.degrees!==rotation.degrees){me.dirtyTransform=true;rotation.x=newRotate.x;rotation.y=newRotate.y;rotation.degrees=newRotate.degrees}}newScaling=attrs.scaling||attrs.scale;scaling=spriteAttrs.scaling;delete attrs.scale;delete attrs.scaling;if(newScaling){if("x"in newScaling&&newScaling.x!==scaling.x||"y"in newScaling&&newScaling.y!==scaling.y||"cx"in newScaling&&newScaling.cx!==scaling.cx||"cy"in newScaling&&newScaling.cy!==scaling.cy){me.dirtyTransform=true;scaling.x=newScaling.x;scaling.y=newScaling.y;scaling.cx=newScaling.cx;scaling.cy=newScaling.cy}}if(!me.dirtyTransform&&dirtyBBox){if(spriteAttrs.scaling.x===null||spriteAttrs.scaling.y===null||spriteAttrs.rotation.y===null||spriteAttrs.rotation.y===null){me.dirtyTransform=true}}Ext.apply(spriteAttrs,attrs);me.dirty=true;if(redraw===true&&hasSurface){me.redraw()}return this},getBBox:function(){return this.surface.getBBox(this)},setText:function(text){return this.surface.setText(this,text)},hide:function(redraw){this.setAttributes({hidden:true},redraw);return this},show:function(redraw){this.setAttributes({hidden:false},redraw);return this},remove:function(){if(this.surface){this.surface.remove(this);return true}return false},onRemove:function(){this.surface.onRemove(this)},destroy:function(){var me=this;if(me.fireEvent("beforedestroy",me)!==false){me.remove();me.surface.onDestroy(me);me.clearListeners();me.fireEvent("destroy")}},redraw:function(){this.surface.renderItem(this);return this},setStyle:function(){this.el.setStyle.apply(this.el,arguments);return this},addCls:function(obj){this.surface.addCls(this,obj);return this},removeCls:function(obj){this.surface.removeCls(this,obj);return this}});