Ext.define("Ext.menu.Menu",{extend:"Ext.panel.Panel",alias:"widget.menu",requires:["Ext.layout.container.Fit","Ext.layout.container.VBox","Ext.menu.CheckItem","Ext.menu.Item","Ext.menu.KeyNav","Ext.menu.Manager","Ext.menu.Separator"],enableKeyNav:true,allowOtherMenus:false,ariaRole:"menu",floating:true,constrain:true,hidden:true,hideMode:"visibility",ignoreParentClicks:false,isMenu:true,showSeparator:true,minWidth:undefined,defaultMinWidth:120,initComponent:function(){var me=this,prefix=Ext.baseCSSPrefix,cls=[prefix+"menu"],bodyCls=me.bodyCls?[me.bodyCls]:[],isFloating=me.floating!==false;me.addEvents("click","mouseenter","mouseleave","mouseover");Ext.menu.Manager.register(me);if(me.plain){cls.push(prefix+"menu-plain")}me.cls=cls.join(" ");bodyCls.push(prefix+"menu-body",Ext.dom.Element.unselectableCls);me.bodyCls=bodyCls.join(" ");if(!me.layout){me.layout={type:"vbox",align:"stretchmax",overflowHandler:"Scroller"}}if(isFloating){if(me.minWidth===undefined){me.minWidth=me.defaultMinWidth}}else{me.hidden=!!me.initialConfig.hidden;me.constrain=false}me.callParent(arguments)},registerWithOwnerCt:function(){if(this.floating){this.ownerCt=null;Ext.WindowManager.register(this)}},initHierarchyEvents:Ext.emptyFn,isVisible:function(){return this.callParent()},getHierarchyState:function(){var result=this.callParent();result.hidden=this.hidden;return result},beforeRender:function(){this.callParent(arguments);if(!this.getSizeModel().width.shrinkWrap){this.layout.align="stretch"}},onBoxReady:function(){var me=this;me.callParent(arguments);if(me.showSeparator){me.iconSepEl=me.layout.getElementTarget().insertFirst({cls:Ext.baseCSSPrefix+"menu-icon-separator",html:"&#160;"})}me.mon(me.el,{click:me.onClick,mouseover:me.onMouseOver,scope:me});me.mouseMonitor=me.el.monitorMouseLeave(100,me.onMouseLeave,me);if(me.enableKeyNav){me.keyNav=new Ext.menu.KeyNav({target:me,keyMap:me.getKeyMap()})}},getRefOwner:function(){return this.parentMenu||this.ownerButton||this.callParent(arguments)},canActivateItem:function(item){return item&&!item.isDisabled()&&item.isVisible()&&(item.canActivate||item.getXTypes().indexOf("menuitem")<0)},deactivateActiveItem:function(andBlurFocusedItem){var me=this,activeItem=me.activeItem,focusedItem=me.focusedItem;if(activeItem){activeItem.deactivate();if(!activeItem.activated){delete me.activeItem}}if(focusedItem&&andBlurFocusedItem){focusedItem.blur();delete me.focusedItem}},getFocusEl:function(){return this.focusedItem||this.el},hide:function(){this.deactivateActiveItem(true);this.callParent(arguments)},getItemFromEvent:function(e){return this.getChildByElement(e.getTarget())},lookupComponent:function(cmp){var me=this;if(typeof cmp=="string"){cmp=me.lookupItemFromString(cmp)}else if(Ext.isObject(cmp)){cmp=me.lookupItemFromObject(cmp)}cmp.minWidth=cmp.minWidth||me.minWidth;return cmp},lookupItemFromObject:function(cmp){var me=this,prefix=Ext.baseCSSPrefix,cls;if(!cmp.isComponent){if(!cmp.xtype){cmp=Ext.create("Ext.menu."+(Ext.isBoolean(cmp.checked)?"Check":"")+"Item",cmp)}else{cmp=Ext.ComponentManager.create(cmp,cmp.xtype)}}if(cmp.isMenuItem){cmp.parentMenu=me}if(!cmp.isMenuItem&&!cmp.dock){cls=[prefix+"menu-item-cmp"];if(!me.plain&&(cmp.indent!==false||cmp.iconCls==="no-icon")){cls.push(prefix+"menu-item-indent")}if(cmp.rendered){cmp.el.addCls(cls)}else{cmp.cls=(cmp.cls||"")+" "+cls.join(" ")}}return cmp},lookupItemFromString:function(cmp){return cmp=="separator"||cmp=="-"?new Ext.menu.Separator:new Ext.menu.Item({canActivate:false,hideOnClick:false,plain:true,text:cmp})},onClick:function(e){var me=this,item;if(me.disabled){e.stopEvent();return}item=e.type==="click"?me.getItemFromEvent(e):me.activeItem;if(item&&item.isMenuItem){if(!item.menu||!me.ignoreParentClicks){item.onClick(e)}else{e.stopEvent()}}if(!item||item.disabled){item=undefined}me.fireEvent("click",me,item,e)},onDestroy:function(){var me=this;Ext.menu.Manager.unregister(me);me.parentMenu=me.ownerButton=null;if(me.rendered){me.el.un(me.mouseMonitor);Ext.destroy(me.keyNav);me.keyNav=null}me.callParent(arguments)},onMouseLeave:function(e){var me=this;me.deactivateActiveItem();if(me.disabled){return}me.fireEvent("mouseleave",me,e)},onMouseOver:function(e){var me=this,fromEl=e.getRelatedTarget(),mouseEnter=!me.el.contains(fromEl),item=me.getItemFromEvent(e),parentMenu=me.parentMenu,parentItem=me.parentItem;if(mouseEnter&&parentMenu){parentMenu.setActiveItem(parentItem);parentItem.cancelDeferHide();parentMenu.mouseMonitor.mouseenter()}if(me.disabled){return}if(item&&!item.activated){me.setActiveItem(item);if(item.activated&&item.expandMenu){item.expandMenu()}}if(mouseEnter){me.fireEvent("mouseenter",me,e)}me.fireEvent("mouseover",me,item,e)},setActiveItem:function(item){var me=this;if(item&&item!=me.activeItem){me.deactivateActiveItem();if(me.canActivateItem(item)){if(item.activate){item.activate();if(item.activated){me.activeItem=item;me.focusedItem=item;me.focus()}}else{item.focus();me.focusedItem=item}}item.el.scrollIntoView(me.layout.getRenderTarget())}},showBy:function(cmp,pos,off){var me=this;me.callParent(arguments);if(!me.hidden){me.setVerticalPosition()}return me},beforeShow:function(){var me=this,viewHeight;if(me.floating){me.savedMaxHeight=me.maxHeight;viewHeight=me.container.getViewSize().height;me.maxHeight=Math.min(me.maxHeight||viewHeight,viewHeight)}me.callParent(arguments)},afterShow:function(){var me=this;me.callParent(arguments);if(me.floating){me.maxHeight=me.savedMaxHeight}},setVerticalPosition:function(){var me=this,max,y=me.getY(),returnY=y,height=me.getHeight(),viewportHeight=Ext.Element.getViewportHeight().height,parentEl=me.el.parent(),viewHeight=parentEl.getViewSize().height,normalY=y-parentEl.getScroll().top;parentEl=null;if(me.floating){max=me.maxHeight?me.maxHeight:viewHeight-normalY;if(height>viewHeight){returnY=y-normalY}else if(max<height){returnY=y-(height-max)}else if(y+height>viewportHeight){returnY=viewportHeight-height}}me.setY(returnY)}});