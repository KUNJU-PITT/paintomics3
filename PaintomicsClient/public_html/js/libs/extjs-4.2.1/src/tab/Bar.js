Ext.define("Ext.tab.Bar",{extend:"Ext.panel.Header",alias:"widget.tabbar",baseCls:Ext.baseCSSPrefix+"tab-bar",requires:["Ext.tab.Tab","Ext.util.Point"],isTabBar:true,defaultType:"tab",plain:false,childEls:["body","strip"],renderTpl:['<div id="{id}-body" class="{baseCls}-body {bodyCls} {bodyTargetCls}{childElCls}<tpl if="ui"> {baseCls}-body-{ui}<tpl for="uiCls"> {parent.baseCls}-body-{parent.ui}-{.}</tpl></tpl>"<tpl if="bodyStyle"> style="{bodyStyle}"</tpl>>',"{%this.renderContainer(out,values)%}","</div>",'<div id="{id}-strip" class="{baseCls}-strip {baseCls}-strip-{dock}{childElCls}','<tpl if="ui"> {baseCls}-strip-{ui}','<tpl for="uiCls"> {parent.baseCls}-strip-{parent.ui}-{.}</tpl>','</tpl>">',"</div>"],_reverseDockNames:{left:"right",right:"left"},initComponent:function(){var me=this;if(me.plain){me.addCls(me.baseCls+"-plain")}me.addClsWithUI(me.orientation);me.addEvents("change");me.callParent(arguments);Ext.merge(me.layout,me.initialConfig.layout);me.layout.align=me.orientation=="vertical"?"left":"top";me.layout.overflowHandler=new Ext.layout.container.boxOverflow.Scroller(me.layout);me.remove(me.titleCmp);delete me.titleCmp;Ext.apply(me.renderData,{bodyCls:me.bodyCls,dock:me.dock})},onRender:function(){var me=this;me.callParent();if(me.orientation==="vertical"&&(Ext.isIE8||Ext.isIE9)&&Ext.isStrict){me.el.on({mousemove:me.onMouseMove,scope:me})}},afterRender:function(){var layout=this.layout;this.callParent();if(Ext.isIE9&&Ext.isStrict&&this.orientation==="vertical"){layout.innerCt.on("scroll",function(){layout.innerCt.dom.scrollLeft=0})}},afterLayout:function(){this.adjustTabPositions();this.callParent(arguments)},adjustTabPositions:function(){var items=this.items.items,i=items.length,tab;if(!Ext.isIE9m){if(this.dock==="right"){while(i--){tab=items[i];if(tab.isVisible()){tab.el.setStyle("left",tab.lastBox.width+"px")}}}else if(this.dock==="left"){while(i--){tab=items[i];if(tab.isVisible()){tab.el.setStyle("left",-tab.lastBox.height+"px")}}}}},getLayout:function(){var me=this;me.layout.type=me.orientation==="horizontal"?"hbox":"vbox";return me.callParent(arguments)},onAdd:function(tab){tab.position=this.dock;this.callParent(arguments)},onRemove:function(tab){var me=this;if(tab===me.previousTab){me.previousTab=null}me.callParent(arguments)},afterComponentLayout:function(width){var me=this,needsScroll=me.needsScroll;me.callParent(arguments);if(needsScroll){me.layout.overflowHandler.scrollToItem(me.activeTab)}delete me.needsScroll},onClick:function(e,target){var me=this,tabPanel=me.tabPanel,tabEl,tab,isCloseClick,tabInfo;if(e.getTarget("."+Ext.baseCSSPrefix+"box-scroller")){return}if(me.orientation==="vertical"&&(Ext.isIE8||Ext.isIE9)&&Ext.isStrict){tabInfo=me.getTabInfoFromPoint(e.getXY());tab=tabInfo.tab;isCloseClick=tabInfo.close}else{tabEl=e.getTarget("."+Ext.tab.Tab.prototype.baseCls);tab=tabEl&&Ext.getCmp(tabEl.id);isCloseClick=tab&&tab.closeEl&&target===tab.closeEl.dom}if(isCloseClick){e.preventDefault()}if(tab&&tab.isDisabled&&!tab.isDisabled()){if(tab.closable&&isCloseClick){tab.onCloseClick()}else{if(tabPanel){tabPanel.setActiveTab(tab.card)}else{me.setActiveTab(tab)}tab.focus()}}},onMouseMove:function(e){var me=this,overTab=me._overTab,tabInfo,tab;if(e.getTarget("."+Ext.baseCSSPrefix+"box-scroller")){return}tabInfo=me.getTabInfoFromPoint(e.getXY());tab=tabInfo.tab;if(tab!==overTab){if(overTab&&overTab.rendered){overTab.onMouseLeave(e);me._overTab=null}if(tab){tab.onMouseEnter(e);me._overTab=tab;if(!tab.disabled){me.el.setStyle("cursor","pointer")}}else{me.el.setStyle("cursor","default")}}},onMouseLeave:function(e){var overTab=this._overTab;if(overTab&&overTab.rendered){overTab.onMouseLeave(e)}},getTabInfoFromPoint:function(xy){var me=this,tabs=me.items.items,length=tabs.length,innerCt=me.layout.innerCt,innerCtXY=innerCt.getXY(),point=new Ext.util.Point(xy[0],xy[1]),i=0,lastBox,tabRegion,closeEl,close,closeXY,closeX,closeY,closeWidth,closeHeight,tabX,tabY,tabWidth,tabHeight,closeRegion,isTabReversed,direction,tab;for(;i<length;i++){lastBox=tabs[i].lastBox;tabX=innerCtXY[0]+lastBox.x;tabY=innerCtXY[1]-innerCt.dom.scrollTop+lastBox.y;tabWidth=lastBox.width;tabHeight=lastBox.height;tabRegion=new Ext.util.Region(tabY,tabX+tabWidth,tabY+tabHeight,tabX);if(tabRegion.contains(point)){tab=tabs[i];closeEl=tab.closeEl;if(closeEl){closeXY=closeEl.getXY();closeWidth=closeEl.getWidth();closeHeight=closeEl.getHeight();if(me._isTabReversed===undefined){me._isTabReversed=isTabReversed=tab.btnWrap.dom.currentStyle.filter.indexOf("rotation=2")!==-1}direction=isTabReversed?this._reverseDockNames[me.dock]:me.dock;if(direction==="right"){closeX=tabX+tabWidth-(closeXY[1]-tabY+closeEl.getHeight());closeY=tabY+(closeXY[0]-tabX)}else{closeX=tabX+(closeXY[1]-tabY);closeY=tabY+tabX+tabHeight-closeXY[0]-closeEl.getWidth()}closeRegion=new Ext.util.Region(closeY,closeX+closeWidth,closeY+closeHeight,closeX);close=closeRegion.contains(point)}break}}return{tab:tab,close:close}},closeTab:function(toClose){var me=this,card=toClose.card,tabPanel=me.tabPanel,toActivate;if(card&&card.fireEvent("beforeclose",card)===false){return false}toActivate=me.findNextActivatable(toClose);Ext.suspendLayouts();if(tabPanel&&card){delete toClose.ownerCt;card.fireEvent("close",card);tabPanel.remove(card);if(!tabPanel.getComponent(card)){toClose.fireClose();me.remove(toClose)}else{toClose.ownerCt=me;Ext.resumeLayouts(true);return false}}if(toActivate){if(tabPanel){tabPanel.setActiveTab(toActivate.card)}else{me.setActiveTab(toActivate)}toActivate.focus()}Ext.resumeLayouts(true)},findNextActivatable:function(toClose){var me=this;if(toClose.active&&me.items.getCount()>1){return me.previousTab&&me.previousTab!==toClose&&!me.previousTab.disabled?me.previousTab:toClose.next("tab[disabled=false]")||toClose.prev("tab[disabled=false]")}},setActiveTab:function(tab,initial){var me=this;if(!tab.disabled&&tab!==me.activeTab){if(me.activeTab){if(me.activeTab.isDestroyed){me.previousTab=null}else{me.previousTab=me.activeTab;me.activeTab.deactivate()}}tab.activate();me.activeTab=tab;me.needsScroll=true;if(!initial){me.fireEvent("change",me,tab,tab.card);me.updateLayout()}}}});